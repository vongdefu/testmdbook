<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>spring</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/pagetoc.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<p>title: Springé¢è¯•é¢˜ï¼Œ41é“Springå…«è‚¡æ–‡ï¼ˆ1.3ä¸‡å­—63å¼ æ‰‹ç»˜å›¾ï¼‰ï¼Œé¢æ¸£é€†è¢­å¿…çœ‹ğŸ‘
shortTitle: é¢æ¸£é€†è¢­-Spring
description: ä¸‹è½½æ¬¡æ•°è¶… 1 ä¸‡æ¬¡ï¼Œ1.3 ä¸‡å­— 63 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 41 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Spring å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚
author: ä¸‰åˆ†æ¶
date: 2024-11-05
category:</p>
<ul>
<li>é¢æ¸£é€†è¢­
tag:</li>
<li>é¢æ¸£é€†è¢­
head:</li>
<li>
<ul>
<li>meta</li>
<li>name: keywords
content: Springé¢è¯•é¢˜,Spring,é¢è¯•é¢˜,å…«è‚¡æ–‡,java,springå…¨å®¶æ¡¶</li>
</ul>
</li>
</ul>
<hr />
<p>1.3 ä¸‡å­— 63 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 41 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Spring å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/EQge6DmgIqYITM3mAxkatg">è½¬è½½é“¾æ¥</a>ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/Y17S85ntHm_MLTZMJdtjQQ">åŸæ–‡é“¾æ¥</a>ã€‚</p>
<h2 id="åŸºç¡€"><a class="header" href="#åŸºç¡€">åŸºç¡€</a></h2>
<h3 id="1spring-æ˜¯ä»€ä¹ˆç‰¹æ€§æœ‰å“ªäº›æ¨¡å—"><a class="header" href="#1spring-æ˜¯ä»€ä¹ˆç‰¹æ€§æœ‰å“ªäº›æ¨¡å—">1.Spring æ˜¯ä»€ä¹ˆï¼Ÿç‰¹æ€§ï¼Ÿæœ‰å“ªäº›æ¨¡å—ï¼Ÿ</a></h3>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-165c27b4-2ea0-409a-8fa5-389c105db0fa.png" alt="Spring Logo" /></p>
<p>ä¸€å¥è¯æ¦‚æ‹¬ï¼š<strong>Spring æ˜¯ä¸€ä¸ªè½»é‡çº§ã€éå…¥ä¾µå¼çš„æ§åˆ¶åè½¬ (IoC) å’Œé¢å‘åˆ‡é¢ (AOP) çš„æ¡†æ¶ã€‚</strong></p>
<p>2003 å¹´ï¼Œä¸€ä¸ªéŸ³ä¹å®¶ Rod Johnson å†³å®šå‘å±•ä¸€ä¸ªè½»é‡çº§çš„ Java å¼€å‘æ¡†æ¶ï¼Œ<code>Spring</code>ä½œä¸º Java æˆ˜åœºçš„é¾™éª‘å…µæ¸æ¸å´›èµ·ï¼Œå¹¶æ·˜æ±°äº†<code>EJB</code>è¿™ä¸ªä¼ ç»Ÿçš„é‡è£…éª‘å…µã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-5d9efb93-03a5-400c-8429-3be7c5eeddfb.png" alt="Springé‡è¦ç‰ˆæœ¬" /></p>
<p>åˆ°äº†ç°åœ¨ï¼Œä¼ä¸šçº§å¼€å‘çš„æ ‡é…åŸºæœ¬å°±æ˜¯ <strong>Spring5</strong> + <strong>Spring Boot 2</strong> + <strong>JDK 8</strong></p>
<h4 id="spring-æœ‰å“ªäº›ç‰¹æ€§å‘¢"><a class="header" href="#spring-æœ‰å“ªäº›ç‰¹æ€§å‘¢">Spring æœ‰å“ªäº›ç‰¹æ€§å‘¢ï¼Ÿ</a></h4>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a0f0ef9d-3289-41ea-94c2-34b7e37ef854.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringç‰¹æ€§" /></p>
<ol>
<li><strong>IoC</strong> å’Œ <strong>DI</strong> çš„æ”¯æŒ</li>
</ol>
<p>Spring çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªå¤§çš„å·¥å‚å®¹å™¨ï¼Œå¯ä»¥ç»´æŠ¤æ‰€æœ‰å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ï¼ŒSpring å·¥å‚ç”¨äºç”Ÿæˆ Beanï¼Œå¹¶ä¸”ç®¡ç† Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ç°<strong>é«˜å†…èšä½è€¦åˆ</strong>çš„è®¾è®¡ç†å¿µã€‚</p>
<ol start="2">
<li>AOP ç¼–ç¨‹çš„æ”¯æŒ</li>
</ol>
<p>Spring æä¾›äº†<strong>é¢å‘åˆ‡é¢ç¼–ç¨‹</strong>ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°å¯¹ç¨‹åºè¿›è¡Œæƒé™æ‹¦æˆªã€è¿è¡Œç›‘æ§ç­‰åˆ‡é¢åŠŸèƒ½ã€‚</p>
<ol start="3">
<li>å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ</li>
</ol>
<p>æ”¯æŒé€šè¿‡é…ç½®å°±æ¥å®Œæˆå¯¹äº‹åŠ¡çš„ç®¡ç†ï¼Œè€Œä¸éœ€è¦é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼ï¼Œä»¥å‰é‡å¤çš„ä¸€äº›äº‹åŠ¡æäº¤ã€å›æ»šçš„ JDBC ä»£ç ï¼Œéƒ½å¯ä»¥ä¸ç”¨è‡ªå·±å†™äº†ã€‚</p>
<ol start="4">
<li>å¿«æ·æµ‹è¯•çš„æ”¯æŒ</li>
</ol>
<p>Spring å¯¹ Junit æä¾›æ”¯æŒï¼Œå¯ä»¥é€šè¿‡<strong>æ³¨è§£</strong>å¿«æ·åœ°æµ‹è¯• Spring ç¨‹åºã€‚</p>
<ol start="5">
<li>å¿«é€Ÿé›†æˆåŠŸèƒ½</li>
</ol>
<p>æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶ï¼ŒSpring ä¸æ’æ–¥å„ç§ä¼˜ç§€çš„å¼€æºæ¡†æ¶ï¼Œå…¶å†…éƒ¨æä¾›äº†å¯¹å„ç§ä¼˜ç§€æ¡†æ¶ï¼ˆå¦‚ï¼šStrutsã€Hibernateã€MyBatisã€Quartz ç­‰ï¼‰çš„ç›´æ¥æ”¯æŒã€‚</p>
<ol start="6">
<li>å¤æ‚ API æ¨¡æ¿å°è£…</li>
</ol>
<p>Spring å¯¹ JavaEE å¼€å‘ä¸­éå¸¸éš¾ç”¨çš„ä¸€äº› APIï¼ˆJDBCã€JavaMailã€è¿œç¨‹è°ƒç”¨ç­‰ï¼‰éƒ½æä¾›äº†æ¨¡æ¿åŒ–çš„å°è£…ï¼Œè¿™äº›å°è£… API çš„æä¾›ä½¿å¾—åº”ç”¨éš¾åº¦å¤§å¤§é™ä½ã€‚</p>
<h4 id="ç®€å•è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯aop-å’Œ-ioc"><a class="header" href="#ç®€å•è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯aop-å’Œ-ioc">ç®€å•è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯AOP å’Œ IoCï¼Ÿ</a></h4>
<p><strong>AOP</strong>ï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†é‚£äº›ä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ— å…³ï¼Œä½†æ˜¯å¯¹å¤šä¸ªå¯¹è±¡äº§ç”Ÿå½±å“çš„å…¬å…±è¡Œä¸ºå°è£…èµ·æ¥ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç»Ÿè®¡ã€äº‹åŠ¡ç­‰ã€‚</p>
<p><strong>IoC</strong>ï¼šæ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡ä¹‹é—´çš„è°ƒç”¨è¿‡ç¨‹äº¤ç»™ Spring å®¹å™¨æ¥ç®¡ç†ã€‚</p>
<h4 id="springæºç çœ‹è¿‡å—"><a class="header" href="#springæºç çœ‹è¿‡å—">Springæºç çœ‹è¿‡å—ï¼Ÿ</a></h4>
<p>çœ‹è¿‡ä¸€äº›ï¼Œä¸»è¦å°±æ˜¯é’ˆå¯¹ Spring å¾ªç¯ä¾èµ–ã€Bean å£°æ˜å‘¨æœŸã€AOPã€äº‹åŠ¡ã€IOC è¿™äº”éƒ¨åˆ†ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241207102105.png" alt="æ˜Ÿçƒå˜‰å®¾æ¥¼ä»”ï¼šSpring æºç è§£æ" /></p>
<p>PSï¼šå…³äºè¿™ä»½å°å†Œçš„ PDF ç‰ˆæœ¬ï¼Œç›®å‰åªæœ‰<a href="https://javabetter.cn/zhishixingqiu/">æ˜Ÿçƒ</a>çš„ç”¨æˆ·å¯ä»¥è·å–ï¼Œåç»­ä¼šè€ƒè™‘å¼€æ”¾ç»™å¤§å®¶ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241207101910.png" alt="æ¥¼ä»”çš„ Spring æºç è§£ææ‰‹å†Œ" /></p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šIOCä¸AOP</li>
</ol>
</blockquote>
<h3 id="2spring-æœ‰å“ªäº›æ¨¡å—å‘¢"><a class="header" href="#2spring-æœ‰å“ªäº›æ¨¡å—å‘¢">2.Spring æœ‰å“ªäº›æ¨¡å—å‘¢ï¼Ÿ</a></h3>
<p>Spring æ¡†æ¶æ˜¯åˆ†æ¨¡å—å­˜åœ¨ï¼Œé™¤äº†æœ€æ ¸å¿ƒçš„<code>Spring Core Container</code>æ˜¯å¿…è¦æ¨¡å—ä¹‹å¤–ï¼Œå…¶ä»–æ¨¡å—éƒ½æ˜¯<code>å¯é€‰</code>ï¼Œå¤§çº¦æœ‰ 20 å¤šä¸ªæ¨¡å—ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-bb7c13ea-3174-4b32-84b8-821849ddc377.png" alt="Springæ¨¡å—åˆ’åˆ†" /></p>
<p>æœ€ä¸»è¦çš„ä¸ƒå¤§æ¨¡å—ï¼š</p>
<ol>
<li><strong>Spring Core</strong>ï¼šSpring æ ¸å¿ƒï¼Œå®ƒæ˜¯æ¡†æ¶æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œæä¾› IoC å’Œä¾èµ–æ³¨å…¥ DI ç‰¹æ€§ã€‚</li>
<li><strong>Spring Context</strong>ï¼šSpring ä¸Šä¸‹æ–‡å®¹å™¨ï¼Œå®ƒæ˜¯ BeanFactory åŠŸèƒ½åŠ å¼ºçš„ä¸€ä¸ªå­æ¥å£ã€‚</li>
<li><strong>Spring Web</strong>ï¼šå®ƒæä¾› Web åº”ç”¨å¼€å‘çš„æ”¯æŒã€‚</li>
<li><strong>Spring MVC</strong>ï¼šå®ƒé’ˆå¯¹ Web åº”ç”¨ä¸­ MVC æ€æƒ³çš„å®ç°ã€‚</li>
<li><strong>Spring DAO</strong>ï¼šæä¾›å¯¹ JDBC æŠ½è±¡å±‚ï¼Œç®€åŒ–äº† JDBC ç¼–ç ï¼ŒåŒæ—¶ï¼Œç¼–ç æ›´å…·æœ‰å¥å£®æ€§ã€‚</li>
<li><strong>Spring ORM</strong>ï¼šå®ƒæ”¯æŒç”¨äºæµè¡Œçš„ ORM æ¡†æ¶çš„æ•´åˆï¼Œæ¯”å¦‚ï¼šSpring + Hibernateã€Spring + iBatisã€Spring + JDO çš„æ•´åˆç­‰ã€‚</li>
<li><strong>Spring AOP</strong>ï¼šå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ƒæä¾›äº†ä¸ AOP è”ç›Ÿå…¼å®¹çš„ç¼–ç¨‹å®ç°ã€‚</li>
</ol>
<h3 id="3spring-æœ‰å“ªäº›å¸¸ç”¨æ³¨è§£å‘¢"><a class="header" href="#3spring-æœ‰å“ªäº›å¸¸ç”¨æ³¨è§£å‘¢">3.Spring æœ‰å“ªäº›å¸¸ç”¨æ³¨è§£å‘¢ï¼Ÿ</a></h3>
<p>Spring æä¾›äº†å¤§é‡çš„æ³¨è§£æ¥ç®€åŒ– Java åº”ç”¨çš„å¼€å‘å’Œé…ç½®ï¼Œä¸»è¦ç”¨äº Web å¼€å‘ã€å¾€å®¹å™¨æ³¨å…¥ Beanã€AOPã€äº‹åŠ¡æ§åˆ¶ç­‰ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-8d0a1518-a425-4887-9735-45321095d927.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå¸¸ç”¨æ³¨è§£" /></p>
<h4 id="web-å¼€å‘æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢"><a class="header" href="#web-å¼€å‘æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢">Web å¼€å‘æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢ï¼Ÿ</a></h4>
<p>â‘ ã€<code>@Controller</code>ï¼šç”¨äºæ ‡æ³¨æ§åˆ¶å±‚ç»„ä»¶ã€‚</p>
<p>â‘¡ã€<code>@RestController</code>ï¼šæ˜¯<code>@Controller</code> å’Œ <code>@ResponseBody</code> çš„ç»“åˆä½“ï¼Œè¿”å› JSON æ•°æ®æ—¶ä½¿ç”¨ã€‚</p>
<p>â‘¢ã€<code>@RequestMapping</code>ï¼šç”¨äºæ˜ å°„è¯·æ±‚ URL åˆ°å…·ä½“çš„æ–¹æ³•ä¸Šï¼Œè¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼š</p>
<ul>
<li><code>@GetMapping</code>ï¼šåªèƒ½ç”¨äºå¤„ç† GET è¯·æ±‚</li>
<li><code>@PostMapping</code>ï¼šåªèƒ½ç”¨äºå¤„ç† POST è¯·æ±‚</li>
<li><code>@DeleteMapping</code>ï¼šåªèƒ½ç”¨äºå¤„ç† DELETE è¯·æ±‚</li>
</ul>
<p>â‘£ã€<code>@ResponseBody</code>ï¼šç›´æ¥å°†è¿”å›çš„æ•°æ®æ”¾å…¥ HTTP å“åº”æ­£æ–‡ä¸­ï¼Œä¸€èˆ¬ç”¨äºè¿”å› JSON æ•°æ®ã€‚</p>
<p>â‘¤ã€<code>@RequestBody</code>ï¼šè¡¨ç¤ºä¸€ä¸ªæ–¹æ³•å‚æ•°åº”è¯¥ç»‘å®šåˆ° Web è¯·æ±‚ä½“ã€‚</p>
<p>â‘¥ã€<code>@PathVariable</code>ï¼šç”¨äºæ¥æ”¶è·¯å¾„å‚æ•°ï¼Œæ¯”å¦‚ <code>@RequestMapping(â€œ/hello/{name}â€)</code>ï¼Œè¿™é‡Œçš„ name å°±æ˜¯è·¯å¾„å‚æ•°ã€‚</p>
<p>â‘¦ã€<code>@RequestParam</code>ï¼šç”¨äºæ¥æ”¶è¯·æ±‚å‚æ•°ã€‚æ¯”å¦‚ <code>@RequestParam(name = "key") String key</code>ï¼Œè¿™é‡Œçš„ key å°±æ˜¯è¯·æ±‚å‚æ•°ã€‚</p>
<h4 id="å®¹å™¨ç±»æ³¨è§£æœ‰å“ªäº›å‘¢"><a class="header" href="#å®¹å™¨ç±»æ³¨è§£æœ‰å“ªäº›å‘¢">å®¹å™¨ç±»æ³¨è§£æœ‰å“ªäº›å‘¢ï¼Ÿ</a></h4>
<ul>
<li><code>@Component</code>ï¼šæ ‡è¯†ä¸€ä¸ªç±»ä¸º Spring ç»„ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿè¢« Spring å®¹å™¨è‡ªåŠ¨æ‰«æå’Œç®¡ç†ã€‚</li>
<li><code>@Service</code>ï¼šæ ‡è¯†ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ç»„ä»¶ï¼ˆæœåŠ¡å±‚ï¼‰ã€‚æ¯”å¦‚ <code>@Service("userService")</code>ï¼Œè¿™é‡Œçš„ userService å°±æ˜¯ Bean çš„åç§°ã€‚</li>
<li><code>@Repository</code>ï¼šæ ‡è¯†ä¸€ä¸ªæ•°æ®è®¿é—®ç»„ä»¶ï¼ˆæŒä¹…å±‚ï¼‰ã€‚</li>
<li><code>@Autowired</code>ï¼šæŒ‰ç±»å‹è‡ªåŠ¨æ³¨å…¥ä¾èµ–ã€‚</li>
<li><code>@Configuration</code>ï¼šç”¨äºå®šä¹‰é…ç½®ç±»ï¼Œå¯æ›¿æ¢ XML é…ç½®æ–‡ä»¶ã€‚</li>
<li><code>@Value</code>ï¼šç”¨äºå°† Spring Boot ä¸­ application.properties é…ç½®çš„å±æ€§å€¼èµ‹å€¼ç»™å˜é‡ã€‚</li>
</ul>
<h4 id="aop-æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢"><a class="header" href="#aop-æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢">AOP æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢ï¼Ÿ</a></h4>
<p><code>@Aspect</code> ç”¨äºå£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼Œå¯ä»¥é…åˆå…¶ä»–æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><code>@After</code>ï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œã€‚</li>
<li><code>@Before</code>ï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚</li>
<li><code>@Around</code>ï¼šæ–¹æ³•å‰åå‡æ‰§è¡Œã€‚</li>
<li><code>@PointCut</code>ï¼šå®šä¹‰åˆ‡ç‚¹ï¼ŒæŒ‡å®šéœ€è¦æ‹¦æˆªçš„æ–¹æ³•ã€‚</li>
</ul>
<h4 id="äº‹åŠ¡æ³¨è§£æœ‰å“ªäº›"><a class="header" href="#äº‹åŠ¡æ³¨è§£æœ‰å“ªäº›">äº‹åŠ¡æ³¨è§£æœ‰å“ªäº›ï¼Ÿ</a></h4>
<p>ä¸»è¦å°±æ˜¯ <code>@Transactional</code>ï¼Œç”¨äºå£°æ˜ä¸€ä¸ªæ–¹æ³•éœ€è¦äº‹åŠ¡æ”¯æŒã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šè¯´è¯´ Spring å¸¸è§çš„æ³¨è§£ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="4spring-ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼å‘¢"><a class="header" href="#4spring-ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼å‘¢">4.Spring ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼å‘¢ï¼Ÿ</a></h3>
<p>Spring æ¡†æ¶ä¸­ç”¨äº†è›®å¤šè®¾è®¡æ¨¡å¼çš„ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-ee1c5cee-8462-4bae-93ea-ec936cc77640.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼" /></p>
<p>â‘ ã€æ¯”å¦‚è¯´å·¥å‚æ¨¡å¼ç”¨äº BeanFactory å’Œ ApplicationContextï¼Œå®ç° Bean çš„åˆ›å»ºå’Œç®¡ç†ã€‚</p>
<pre><code class="language-java">ApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
MyBean myBean = context.getBean(MyBean.class);
</code></pre>
<p>â‘¡ã€æ¯”å¦‚è¯´å•ä¾‹æ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ Bean çš„å”¯ä¸€æ€§ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ã€‚</p>
<pre><code class="language-java">ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);
MyService myService1 = context.getBean(MyService.class);
MyService myService2 = context.getBean(MyService.class);

// This will print "true" because both references point to the same instance
System.out.println(myService1 == myService2);
</code></pre>
<p>â‘¢ã€æ¯”å¦‚è¯´ AOP ä½¿ç”¨äº†ä»£ç†æ¨¡å¼æ¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚äº‹åŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ã€æƒé™æ§åˆ¶ç­‰ï¼‰ã€‚</p>
<pre><code class="language-java">@Transactional
public void myTransactionalMethod() {
    // æ–¹æ³•å®ç°
}
</code></pre>
<h4 id="springå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼"><a class="header" href="#springå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼">Springå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼Ÿ</a></h4>
<p>Spring é€šè¿‡ IOC å®¹å™¨å®ç°å•ä¾‹æ¨¡å¼ï¼Œå…·ä½“æ­¥éª¤æ˜¯ï¼š</p>
<p>å•ä¾‹ Bean åœ¨å®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºå¹¶ä½¿ç”¨ DefaultSingletonBeanRegistry æä¾›çš„ singletonObjects è¿›è¡Œç¼“å­˜ã€‚</p>
<pre><code class="language-java">// å•ä¾‹ç¼“å­˜
private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;();

public Object getSingleton(String beanName) {
    return this.singletonObjects.get(beanName);
}

protected void addSingleton(String beanName, Object singletonObject) {
    this.singletonObjects.put(beanName, singletonObject);
}
</code></pre>
<p>åœ¨è¯·æ±‚ Bean æ—¶ï¼ŒSpring ä¼šå…ˆä»ç¼“å­˜ä¸­è·å–ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æºç¨‹é¢ç»åŒå­¦ 10 Java æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring IoC çš„è®¾è®¡æ¨¡å¼ï¼ŒAOP çš„è®¾è®¡æ¨¡å¼</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šSpring æ¡†æ¶ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŒå­¦ 1 è´å£³æ‰¾æˆ¿åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpringç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šSpringä¸­ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Œä»¥å…¶ä¸­ä¸€ç§æ¨¡å¼ä¸¾ä¾‹è¯´æ˜ï¼ŸSpringå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="39spring-å®¹å™¨web-å®¹å™¨ä¹‹é—´çš„åŒºåˆ«è¡¥å……"><a class="header" href="#39spring-å®¹å™¨web-å®¹å™¨ä¹‹é—´çš„åŒºåˆ«è¡¥å……">39.Spring å®¹å™¨ã€Web å®¹å™¨ä¹‹é—´çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰</a></h3>
<blockquote>
<p>2024 å¹´ 7 æœˆ 11 æ—¥å¢è¡¥</p>
</blockquote>
<p>Spring å®¹å™¨æ˜¯ Spring æ¡†æ¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–æ³¨å…¥ã€‚</p>
<p>Web å®¹å™¨ï¼ˆä¹Ÿç§° Servlet å®¹å™¨ï¼‰ï¼Œæ˜¯ç”¨äºè¿è¡Œ Java Web åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ç¯å¢ƒï¼Œæ”¯æŒ Servletã€JSP ç­‰ Web ç»„ä»¶ã€‚å¸¸è§çš„ Web å®¹å™¨åŒ…æ‹¬ Apache Tomcatã€Jettyç­‰ã€‚</p>
<p>Spring MVC æ˜¯ Spring æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºå¤„ç† Web è¯·æ±‚ï¼ŒåŸºäº MVCï¼ˆModel-View-Controllerï¼‰è®¾è®¡æ¨¡å¼ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å»å“ªå„¿åŒå­¦ 1 æŠ€æœ¯äºŒé¢åŸé¢˜ï¼šspringçš„å®¹å™¨ã€webå®¹å™¨ã€springmvcçš„å®¹å™¨ä¹‹é—´çš„åŒºåˆ«</li>
</ol>
</blockquote>
<p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p>
<p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" /></p>
<h2 id="ioc"><a class="header" href="#ioc">IoC</a></h2>
<h3 id="5è¯´ä¸€è¯´ä»€ä¹ˆæ˜¯-iocdi"><a class="header" href="#5è¯´ä¸€è¯´ä»€ä¹ˆæ˜¯-iocdi">5.è¯´ä¸€è¯´ä»€ä¹ˆæ˜¯ IoCã€DIï¼Ÿ</a></h3>
<p>æ¨èé˜…è¯»ï¼š<a href="https://javabetter.cn/springboot/ioc.html">IoC æ‰«ç›²</a></p>
<p>æ‰€è°“çš„<strong>IoC</strong>ï¼Œå°±æ˜¯ç”±å®¹å™¨æ¥æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚æ§åˆ¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸å†æ˜¯å¼•ç”¨å®ƒçš„å¯¹è±¡ï¼Œè€Œæ˜¯å®¹å™¨ï¼Œè¿™å°±å«<strong>æ§åˆ¶åè½¬</strong>ï¼ˆInversion of Controlï¼‰ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-440f5d0e-f4db-462c-97fb-d54407a354d5.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ§åˆ¶åè½¬ç¤ºæ„å›¾" /></p>
<p>ä»¥å‰æ˜¯æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆå°±è‡ªå·±åˆ›å»ºä»€ä¹ˆï¼Œç°åœ¨æ˜¯æˆ‘ä»¬éœ€è¦ä»€ä¹ˆå®¹å™¨å°±å¸®æˆ‘ä»¬é€æ¥ä»€ä¹ˆã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-619da277-c15e-4dd7-9f2b-dbd809a9aaa0.png" alt="å¼•å…¥IoCä¹‹å‰å’Œå¼•å…¥IoCä¹‹å" /></p>
<p>æ²¡æœ‰ IoC ä¹‹å‰ï¼š</p>
<blockquote>
<p>æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œåˆšå¥½å¤§è¡—ä¸Šçªç„¶çœ‹åˆ°äº†ä¸€ä¸ªå°å§å§ï¼Œäººå¾ˆå¥½çœ‹ï¼Œäºæ˜¯æˆ‘å°±è‡ªå·±ä¸»åŠ¨ä¸Šå»æ­è®ªï¼Œè¦å¥¹çš„å¾®ä¿¡å·ï¼Œæ‰¾æœºä¼šèŠå¤©å…³å¿ƒå¥¹ï¼Œç„¶åçº¦å¥¹å‡ºæ¥åƒé¥­ï¼Œæ‰“å¬å¥¹çš„çˆ±å¥½ï¼Œä¸‰è§‚ã€‚ã€‚ã€‚</p>
</blockquote>
<p>æœ‰äº† IoC ä¹‹åï¼š</p>
<blockquote>
<p>æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œäºæ˜¯æˆ‘å°±å»æ‰¾å©šä»‹æ‰€ï¼Œå‘Šè¯‰å©šä»‹æ‰€ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªé•¿çš„åƒèµµéœ²æ€çš„ï¼Œä¼šæ‰“ Dota2 çš„ï¼Œäºæ˜¯å©šä»‹æ‰€åœ¨å®ƒçš„äººæ‰åº“é‡Œå¼€å§‹æ‰¾ï¼Œæ‰¾ä¸åˆ°å®ƒå°±ç›´æ¥è¯´æ²¡æœ‰ï¼Œæ‰¾åˆ°å®ƒå°±ç›´æ¥ä»‹ç»ç»™æˆ‘ã€‚</p>
</blockquote>
<p>å©šä»‹æ‰€å°±ç›¸å½“äºä¸€ä¸ª IoC å®¹å™¨ï¼Œæˆ‘å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘éœ€è¦çš„å¥³æœ‹å‹å°±æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä¸ç”¨å…³å¿ƒå¥³æœ‹å‹æ˜¯æ€ä¹ˆæ¥çš„ï¼Œæˆ‘åªéœ€è¦å‘Šè¯‰å©šä»‹æ‰€æˆ‘éœ€è¦ä»€ä¹ˆæ ·çš„å¥³æœ‹å‹ï¼Œå©šä»‹æ‰€å°±å¸®æˆ‘å»æ‰¾ã€‚</p>
<p>Spring å€¡å¯¼çš„å¼€å‘æ–¹å¼å°±æ˜¯è¿™æ ·ï¼Œæ‰€æœ‰ç±»çš„åˆ›å»ºå’Œé”€æ¯éƒ½é€šè¿‡ Spring å®¹å™¨æ¥ï¼Œä¸å†æ˜¯å¼€å‘è€…å» newï¼Œå» <code>= null</code>ï¼Œè¿™æ ·å°±å®ç°äº†å¯¹è±¡çš„è§£è€¦ã€‚</p>
<p>äºæ˜¯ï¼Œå¯¹äºæŸä¸ªå¯¹è±¡æ¥è¯´ï¼Œä»¥å‰æ˜¯å®ƒæ§åˆ¶å®ƒä¾èµ–çš„å¯¹è±¡ï¼Œç°åœ¨æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½è¢« Spring æ§åˆ¶ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240310191630.png" alt="å›¾ç‰‡æ¥æºäºç½‘ç»œ" /></p>
<h4 id="è¯´è¯´ä»€ä¹ˆæ˜¯-di"><a class="header" href="#è¯´è¯´ä»€ä¹ˆæ˜¯-di">è¯´è¯´ä»€ä¹ˆæ˜¯ DIï¼Ÿ</a></h4>
<p>IOC æ˜¯ä¸€ç§æ€æƒ³ï¼ŒDI æ˜¯å®ç° IOC çš„å…·ä½“æ–¹å¼ï¼Œæ¯”å¦‚è¯´åˆ©ç”¨æ³¨å…¥æœºåˆ¶ï¼ˆå¦‚æ„é€ å™¨æ³¨å…¥ã€Setter æ³¨å…¥ï¼‰å°†ä¾èµ–ä¼ é€’ç»™ç›®æ ‡å¯¹è±¡ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241117132929.png" alt="Martin Fowlerâ€™s Definition" /></p>
<p>2004 å¹´ï¼ŒMartin Fowler åœ¨ä»–çš„æ–‡ç« ã€Šæ§åˆ¶åè½¬å®¹å™¨&amp;ä¾èµ–æ³¨å…¥æ¨¡å¼ã€‹é¦–æ¬¡æå‡ºäº† <strong>DIï¼ˆä¾èµ–æ³¨å…¥ï¼ŒDependency Injectionï¼‰</strong> è¿™ä¸ªåè¯ã€‚</p>
<p>æ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ç°åœ¨æƒ³åƒéŸ­èœé¦…çš„é¥ºå­ï¼Œè¿™æ—¶å€™å°±æœ‰äººç”¨é’ˆç®¡å¾€ä½ åƒçš„é¥ºå­é‡Œæ³¨å…¥éŸ­èœé¸¡è›‹é¦…ã€‚å°±å¥½åƒ A ç±»éœ€è¦ B ç±»ï¼Œä»¥å‰æ˜¯ A ç±»è‡ªå·± new ä¸€ä¸ª B ç±»ï¼Œç°åœ¨æ˜¯æœ‰äººæŠŠ B ç±»æ³¨å…¥åˆ° A ç±»é‡Œã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-ioc-å‘¢"><a class="header" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-ioc-å‘¢">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IoC å‘¢ï¼Ÿ</a></h4>
<p>åœ¨å¹³æ—¶çš„ Java å¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦å®ç°æŸä¸€ä¸ªåŠŸèƒ½ï¼Œå¯èƒ½è‡³å°‘éœ€è¦ä¸¤ä¸ªä»¥ä¸Šçš„å¯¹è±¡æ¥ååŠ©å®Œæˆï¼Œåœ¨æ²¡æœ‰ Spring ä¹‹å‰ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨éœ€è¦å®ƒçš„åˆä½œå¯¹è±¡æ—¶ï¼Œéœ€è¦è‡ªå·± new ä¸€ä¸ªï¼Œæ¯”å¦‚è¯´ A è¦ä½¿ç”¨ Bï¼ŒA å°±å¯¹ B äº§ç”Ÿäº†ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ A å’Œ B ä¹‹é—´å­˜åœ¨äº†ä¸€ç§è€¦åˆå…³ç³»ã€‚</p>
<p>æœ‰äº† Spring ä¹‹åï¼Œå°±ä¸ä¸€æ ·äº†ï¼Œåˆ›å»º B çš„å·¥ä½œäº¤ç»™äº† Spring æ¥å®Œæˆï¼ŒSpring åˆ›å»ºå¥½äº† B å¯¹è±¡åå°±æ”¾åˆ°å®¹å™¨ä¸­ï¼ŒA å‘Šè¯‰ Spring æˆ‘éœ€è¦ Bï¼ŒSpring å°±ä»å®¹å™¨ä¸­å–å‡º B äº¤ç»™ A æ¥ä½¿ç”¨ã€‚</p>
<p>è‡³äº B æ˜¯æ€ä¹ˆæ¥çš„ï¼ŒA å°±ä¸å†å…³å¿ƒäº†ï¼ŒSpring å®¹å™¨æƒ³é€šè¿‡ newnew åˆ›å»º B è¿˜æ˜¯ new åˆ›å»º Bï¼Œæ— æ‰€è°“ã€‚</p>
<p>è¿™å°±æ˜¯ IoC çš„å¥½å¤„ï¼Œå®ƒé™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—ç¨‹åºæ›´åŠ çµæ´»ï¼Œæ›´åŠ æ˜“äºç»´æŠ¤ã€‚</p>
<p>æ¨èé˜…è¯»ï¼š<a href="https://www.cnblogs.com/xdp-gacl/p/4249939.html">å­¤å‚²è‹ç‹¼ï¼šè°ˆè°ˆå¯¹ Spring IOC çš„ç†è§£</a></p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ä½ å¯¹ AOP å’Œ IoC çš„ç†è§£ã€‚</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šä»‹ç» Spring IoC å’Œ AOP?</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŸé¢˜ï¼šSpringBootæ¡†æ¶çš„AOPã€IOC/DIï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 8 é¢è¯•åŸé¢˜ï¼šIOCï¼ŒAOP</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šè§£é‡Šä¸‹ä»€ä¹ˆæ˜¯IOCå’ŒAOPï¼Ÿåˆ†åˆ«è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼ŸIOCå’ŒDIçš„åŒºåˆ«ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="6èƒ½ç®€å•è¯´ä¸€ä¸‹-spring-ioc-çš„å®ç°æœºåˆ¶å—"><a class="header" href="#6èƒ½ç®€å•è¯´ä¸€ä¸‹-spring-ioc-çš„å®ç°æœºåˆ¶å—">6.èƒ½ç®€å•è¯´ä¸€ä¸‹ Spring IoC çš„å®ç°æœºåˆ¶å—ï¼Ÿ</a></h3>
<p>PS:è¿™é“é¢˜è€ä¸‰åœ¨é¢è¯•ä¸­è¢«é—®åˆ°è¿‡ï¼Œé—®æ³•æ˜¯â€œ<strong>ä½ æœ‰è‡ªå·±å®ç°è¿‡ç®€å•çš„ Spring å—ï¼Ÿ</strong>â€</p>
<p>Spring çš„ IoC æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¤§å·¥å‚ï¼Œæˆ‘ä»¬æƒ³æƒ³ä¸€ä¸ªå·¥å‚æ˜¯æ€ä¹ˆè¿è¡Œçš„å‘¢ï¼Ÿ</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-7678c40f-a48d-4bd5-80f8-e902ad688e11.png" alt="å·¥å‚è¿è¡Œ" /></p>
<ul>
<li>
<p><strong>ç”Ÿäº§äº§å“</strong>ï¼šä¸€ä¸ªå·¥å‚æœ€æ ¸å¿ƒçš„åŠŸèƒ½å°±æ˜¯ç”Ÿäº§äº§å“ã€‚åœ¨ Spring é‡Œï¼Œä¸ç”¨ Bean è‡ªå·±æ¥å®ä¾‹åŒ–ï¼Œè€Œæ˜¯äº¤ç»™ Springï¼Œåº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆæ¯«æ— ç–‘é—®ï¼Œ<strong>åå°„</strong>ã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªå‚å­çš„ç”Ÿäº§ç®¡ç†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä½ åº”è¯¥ä¹ŸçŸ¥é“â€”â€”<strong>å·¥å‚æ¨¡å¼</strong>ã€‚</p>
</li>
<li>
<p><strong>åº“å­˜äº§å“</strong>ï¼šå·¥å‚ä¸€èˆ¬éƒ½æ˜¯æœ‰åº“æˆ¿çš„ï¼Œç”¨æ¥åº“å­˜äº§å“ï¼Œæ¯•ç«Ÿç”Ÿäº§çš„äº§å“ä¸èƒ½ç«‹é©¬å°±æ‹‰èµ°ã€‚Spring æˆ‘ä»¬éƒ½çŸ¥é“æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨é‡Œå­˜çš„å°±æ˜¯å¯¹è±¡ï¼Œä¸èƒ½æ¯æ¬¡æ¥å–å¯¹è±¡ï¼Œéƒ½å¾—ç°åœºæ¥åå°„åˆ›å»ºå¯¹è±¡ï¼Œå¾—æŠŠåˆ›å»ºå‡ºçš„å¯¹è±¡å­˜èµ·æ¥ã€‚</p>
</li>
<li>
<p><strong>è®¢å•å¤„ç†</strong>ï¼šè¿˜æœ‰æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œå·¥å‚æ ¹æ®ä»€ä¹ˆæ¥æä¾›äº§å“å‘¢ï¼Ÿè®¢å•ã€‚è¿™äº›è®¢å•å¯èƒ½äº”èŠ±å…«é—¨ï¼Œæœ‰çº¿ä¸Šç­¾ç­¾çš„ã€æœ‰åˆ°å·¥å‚ç­¾çš„ã€è¿˜æœ‰å·¥å‚é”€å”®ä¸Šé—¨ç­¾çš„â€¦â€¦æœ€åç»è¿‡å¤„ç†ï¼ŒæŒ‡å¯¼å·¥å‚çš„å‡ºè´§ã€‚</p>
<p>åœ¨ Spring é‡Œï¼Œä¹Ÿæœ‰è¿™æ ·çš„è®¢å•ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬ bean çš„å®šä¹‰å’Œä¾èµ–å…³ç³»ï¼Œå¯ä»¥æ˜¯ xml å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„æ³¨è§£å½¢å¼ã€‚</p>
</li>
</ul>
<p>æˆ‘ä»¬ç®€å•åœ°å®ç°ä¸€ä¸ª mini ç‰ˆçš„ Spring IoCï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-1d55c63d-2d12-43b1-9f43-428f5f4a1413.png" alt="miniç‰ˆæœ¬Spring IoC" /></p>
<p><strong>Bean å®šä¹‰ï¼š</strong></p>
<p>Bean é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰ï¼ŒæŠŠå®ƒè§£ææˆä¸€ä¸ªç±»å‹ã€‚</p>
<ul>
<li>
<p>beans.properties</p>
<p>å·æ‡’ï¼Œè¿™é‡Œç›´æ¥ç”¨äº†æœ€æ–¹ä¾¿è§£æçš„ propertiesï¼Œè¿™é‡Œç›´æ¥ç”¨ä¸€ä¸ª<code>&lt;key,value&gt;</code>ç±»å‹çš„é…ç½®æ¥ä»£è¡¨ Bean çš„å®šä¹‰ï¼Œå…¶ä¸­ key æ˜¯ beanNameï¼Œvalue æ˜¯ class</p>
<pre><code class="language-java">userDao:cn.fighter3.bean.UserDao
</code></pre>
</li>
<li>
<p>BeanDefinition.java</p>
<p>bean å®šä¹‰ç±»ï¼Œé…ç½®æ–‡ä»¶ä¸­ bean å®šä¹‰å¯¹åº”çš„å®ä½“</p>
<pre><code class="language-java">public class BeanDefinition {

    private String beanName;

    private Class beanClass;
     //çœç•¥getterã€setter
 }
</code></pre>
</li>
<li>
<p>ResourceLoader.java</p>
<p>èµ„æºåŠ è½½å™¨ï¼Œç”¨æ¥å®Œæˆé…ç½®æ–‡ä»¶ä¸­é…ç½®çš„åŠ è½½</p>
<pre><code class="language-java">public class ResourceLoader {

    public static Map&lt;String, BeanDefinition&gt; getResource() {
        Map&lt;String, BeanDefinition&gt; beanDefinitionMap = new HashMap&lt;&gt;(16);
        Properties properties = new Properties();
        try {
            InputStream inputStream = ResourceLoader.class.getResourceAsStream("/beans.properties");
            properties.load(inputStream);
            Iterator&lt;String&gt; it = properties.stringPropertyNames().iterator();
            while (it.hasNext()) {
                String key = it.next();
                String className = properties.getProperty(key);
                BeanDefinition beanDefinition = new BeanDefinition();
                beanDefinition.setBeanName(key);
                Class clazz = Class.forName(className);
                beanDefinition.setBeanClass(clazz);
                beanDefinitionMap.put(key, beanDefinition);
            }
            inputStream.close();
        } catch (IOException | ClassNotFoundException e) {
            e.printStackTrace();
        }
        return beanDefinitionMap;
    }

}
</code></pre>
</li>
<li>
<p>BeanRegister.java</p>
<p>å¯¹è±¡æ³¨å†Œå™¨ï¼Œè¿™é‡Œç”¨äºå•ä¾‹ bean çš„ç¼“å­˜ï¼Œæˆ‘ä»¬å¤§å¹…ç®€åŒ–ï¼Œé»˜è®¤æ‰€æœ‰ bean éƒ½æ˜¯å•ä¾‹çš„ã€‚å¯ä»¥çœ‹åˆ°æ‰€è°“å•ä¾‹æ³¨å†Œï¼Œä¹Ÿå¾ˆç®€å•ï¼Œä¸è¿‡æ˜¯å¾€ HashMap é‡Œå­˜å¯¹è±¡ã€‚</p>
<pre><code class="language-java">public class BeanRegister {

    //å•ä¾‹Beanç¼“å­˜
    private Map&lt;String, Object&gt; singletonMap = new HashMap&lt;&gt;(32);

    /**
     * è·å–å•ä¾‹Bean
     *
     * @param beanName beanåç§°
     * @return
     */
    public Object getSingletonBean(String beanName) {
        return singletonMap.get(beanName);
    }

    /**
     * æ³¨å†Œå•ä¾‹bean
     *
     * @param beanName
     * @param bean
     */
    public void registerSingletonBean(String beanName, Object bean) {
        if (singletonMap.containsKey(beanName)) {
            return;
        }
        singletonMap.put(beanName, bean);
    }

}
</code></pre>
</li>
<li>
<p><strong>BeanFactory.java</strong></p>
</li>
</ul>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-c6b3b707-cf53-4c7c-a6f9-8560950806fc.png" alt="BeanFactory" /></p>
<ul>
<li>
<p>å¯¹è±¡å·¥å‚ï¼Œæˆ‘ä»¬æœ€<strong>æ ¸å¿ƒ</strong>çš„ä¸€ä¸ªç±»ï¼Œåœ¨å®ƒåˆå§‹åŒ–çš„æ—¶å€™ï¼Œåˆ›å»ºäº† bean æ³¨å†Œå™¨ï¼Œå®Œæˆäº†èµ„æºçš„åŠ è½½ã€‚</p>
</li>
<li>
<p>è·å– bean çš„æ—¶å€™ï¼Œå…ˆä»å•ä¾‹ç¼“å­˜ä¸­å–ï¼Œå¦‚æœæ²¡æœ‰å–åˆ°ï¼Œå°±åˆ›å»ºå¹¶æ³¨å†Œä¸€ä¸ª bean</p>
<pre><code class="language-java">public class BeanFactory {

    private Map&lt;String, BeanDefinition&gt; beanDefinitionMap = new HashMap&lt;&gt;();

    private BeanRegister beanRegister;

    public BeanFactory() {
        //åˆ›å»ºbeanæ³¨å†Œå™¨
        beanRegister = new BeanRegister();
        //åŠ è½½èµ„æº
        this.beanDefinitionMap = new ResourceLoader().getResource();
    }

    /**
     * è·å–bean
     *
     * @param beanName beanåç§°
     * @return
     */
    public Object getBean(String beanName) {
        //ä»beanç¼“å­˜ä¸­å–
        Object bean = beanRegister.getSingletonBean(beanName);
        if (bean != null) {
            return bean;
        }
        //æ ¹æ®beanå®šä¹‰ï¼Œåˆ›å»ºbean
        return createBean(beanDefinitionMap.get(beanName));
    }

    /**
     * åˆ›å»ºBean
     *
     * @param beanDefinition beanå®šä¹‰
     * @return
     */
    private Object createBean(BeanDefinition beanDefinition) {
        try {
            Object bean = beanDefinition.getBeanClass().newInstance();
            //ç¼“å­˜bean
            beanRegister.registerSingletonBean(beanDefinition.getBeanName(), bean);
            return bean;
        } catch (InstantiationException | IllegalAccessException e) {
            e.printStackTrace();
        }
        return null;
    }
}
</code></pre>
</li>
<li>
<p>æµ‹è¯•</p>
<ul>
<li>
<p>UserDao.java</p>
<p>æˆ‘ä»¬çš„ Bean ç±»ï¼Œå¾ˆç®€å•</p>
<pre><code class="language-java">public class UserDao {

    public void queryUserInfo(){
        System.out.println("A good man.");
    }
}
</code></pre>
</li>
<li>
<p>å•å…ƒæµ‹è¯•</p>
<pre><code class="language-java">public class ApiTest {
    @Test
    public void test_BeanFactory() {
        //1.åˆ›å»ºbeanå·¥å‚(åŒæ—¶å®Œæˆäº†åŠ è½½èµ„æºã€åˆ›å»ºæ³¨å†Œå•ä¾‹beanæ³¨å†Œå™¨çš„æ“ä½œ)
        BeanFactory beanFactory = new BeanFactory();

        //2.ç¬¬ä¸€æ¬¡è·å–beanï¼ˆé€šè¿‡åå°„åˆ›å»ºbeanï¼Œç¼“å­˜beanï¼‰
        UserDao userDao1 = (UserDao) beanFactory.getBean("userDao");
        userDao1.queryUserInfo();

        //3.ç¬¬äºŒæ¬¡è·å–beanï¼ˆä»ç¼“å­˜ä¸­è·å–beanï¼‰
        UserDao userDao2 = (UserDao) beanFactory.getBean("userDao");
        userDao2.queryUserInfo();
    }
}
</code></pre>
</li>
<li>
<p>è¿è¡Œç»“æœ</p>
<pre><code class="language-java">A good man.
A good man.
</code></pre>
</li>
</ul>
</li>
</ul>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¹ä¸+ç ´èˆ¹ç‰ˆçš„ Spring å°±å®Œæˆäº†ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒå®Œæ•´ï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥è·‘ä¸€ä¸‹ã€‚</p>
<p>PS:å› ä¸ºæ—¶é—´+ç¯‡å¹…çš„é™åˆ¶ï¼Œè¿™ä¸ª demo æ¯”è¾ƒç®€é™‹ï¼Œæ²¡æœ‰é¢å‘æ¥å£ã€æ²¡æœ‰è§£è€¦ã€è¾¹ç•Œæ£€æŸ¥ã€å¼‚å¸¸å¤„ç†â€¦â€¦å¥å£®æ€§ã€æ‰©å±•æ€§éƒ½æœ‰å¾ˆå¤§çš„ä¸è¶³ï¼Œæ„Ÿå…´è¶£å¯ä»¥å­¦ä¹ å‚è€ƒ[15]ã€‚</p>
<h3 id="7è¯´è¯´-beanfactory-å’Œ-applicantcontext"><a class="header" href="#7è¯´è¯´-beanfactory-å’Œ-applicantcontext">7.è¯´è¯´ BeanFactory å’Œ ApplicantContext?</a></h3>
<p>å¯ä»¥è¿™ä¹ˆæ¯”å–»ï¼ŒBeanFactory æ˜¯ Spring çš„â€œå¿ƒè„â€ï¼Œè€Œ ApplicantContext æ˜¯ Spring çš„å®Œæ•´â€œèº«èº¯â€ã€‚</p>
<ul>
<li>BeanFactory ä¸»è¦è´Ÿè´£é…ç½®ã€åˆ›å»ºå’Œç®¡ç† beanï¼Œä¸º Spring æä¾›äº†åŸºæœ¬çš„ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ”¯æŒã€‚</li>
<li>ApplicationContext æ˜¯ BeanFactory çš„å­æ¥å£ï¼Œåœ¨ BeanFactory çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¼ä¸šçº§çš„åŠŸèƒ½æ”¯æŒã€‚</li>
</ul>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-66328446-f89f-4b7a-8d9f-0e1145dd9b2f.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanFactoryå’ŒApplicantContext" /></p>
<h4 id="è¯¦ç»†è¯´è¯´-beanfactory"><a class="header" href="#è¯¦ç»†è¯´è¯´-beanfactory">è¯¦ç»†è¯´è¯´ BeanFactory</a></h4>
<p>BeanFactory ä½äºæ•´ä¸ª Spring IoC å®¹å™¨çš„é¡¶ç«¯ï¼ŒApplicationContext ç®—æ˜¯ BeanFactory çš„å­æ¥å£ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-6e6d4b69-f36c-41e6-b8ba-9277be147c9b.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring5 BeanFactoryç»§æ‰¿ä½“ç³»" /></p>
<p>å®ƒæœ€ä¸»è¦çš„æ–¹æ³•å°±æ˜¯ <code>getBean()</code>ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£ä»å®¹å™¨ä¸­è¿”å›ç‰¹å®šåç§°æˆ–è€…ç±»å‹çš„ Bean å®ä¾‹ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸ª XMLBeanFactoryï¼ˆå·²è¿‡æ—¶ï¼‰ è·å– bean çš„ä¾‹å­ï¼š</p>
<pre><code class="language-java">class HelloWorldApp{
   public static void main(String[] args) {
      BeanFactory factory = new XmlBeanFactory (new ClassPathResource("beans.xml"));
      HelloWorld obj = (HelloWorld) factory.getBean("itwanger");
      obj.getMessage();
   }
}
</code></pre>
<h4 id="è¯·è¯¦ç»†è¯´è¯´-applicationcontext"><a class="header" href="#è¯·è¯¦ç»†è¯´è¯´-applicationcontext">è¯·è¯¦ç»†è¯´è¯´ ApplicationContext</a></h4>
<p>ApplicationContext ç»§æ‰¿äº† HierachicalBeanFactory å’Œ ListableBeanFactory æ¥å£ï¼Œç®—æ˜¯ BeanFactory çš„è‡ªåŠ¨æŒ¡ç‰ˆæœ¬ï¼Œæ˜¯ Spring åº”ç”¨çš„é»˜è®¤æ–¹å¼ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e201c9a3-f23c-4768-b844-ac7e0ba4bcec.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring5 ApplicationContextéƒ¨åˆ†ä½“ç³»ç±»å›¾" /></p>
<p>ApplicationContext ä¼šåœ¨å¯åŠ¨æ—¶é¢„å…ˆåˆ›å»ºå’Œé…ç½®æ‰€æœ‰çš„å•ä¾‹ beanï¼Œå¹¶æ”¯æŒå¦‚ JDBCã€ORM æ¡†æ¶çš„é›†æˆï¼Œå†…ç½®é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„æ”¯æŒï¼Œå¯ä»¥é…ç½®å£°æ˜å¼äº‹åŠ¡ç®¡ç†ç­‰ã€‚</p>
<p>è¿™æ˜¯ ApplicationContext çš„ä½¿ç”¨ä¾‹å­ï¼š</p>
<pre><code class="language-java">class MainApp {
    public static void main(String[] args) {
        // ä½¿ç”¨ AppConfig é…ç½®ç±»åˆå§‹åŒ– ApplicationContext
        ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);

        // ä» ApplicationContext è·å– messageService çš„ bean
        MessageService service = context.getBean(MessageService.class);

        // ä½¿ç”¨ bean
        service.printMessage();
    }
}
</code></pre>
<p>é€šè¿‡ AnnotationConfigApplicationContext ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Java é…ç½®ç±»æ¥åˆå§‹åŒ– ApplicationContextï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ Java ä»£ç æ¥é…ç½® Spring å®¹å™¨ã€‚</p>
<pre><code class="language-java">@Configuration
@ComponentScan(basePackages = "com.github.paicoding.forum.test.javabetter.spring1") // æ›¿æ¢ä¸ºä½ çš„åŒ…å
public class AppConfig {
}
</code></pre>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢åŒå­¦ 2 ä¼˜é€‰ç‰©æµè°ƒåº¦æŠ€æœ¯ 2 é¢é¢è¯•åŸé¢˜ï¼šBeanFactoryå’ŒApplicationContext</li>
</ol>
</blockquote>
<h3 id="8ä½ çŸ¥é“-spring-å®¹å™¨å¯åŠ¨é˜¶æ®µä¼šå¹²ä»€ä¹ˆå—"><a class="header" href="#8ä½ çŸ¥é“-spring-å®¹å™¨å¯åŠ¨é˜¶æ®µä¼šå¹²ä»€ä¹ˆå—">8.ä½ çŸ¥é“ Spring å®¹å™¨å¯åŠ¨é˜¶æ®µä¼šå¹²ä»€ä¹ˆå—ï¼Ÿ</a></h3>
<p>Spring çš„ IoC å®¹å™¨å·¥ä½œçš„è¿‡ç¨‹ï¼Œå…¶å®å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š<strong>å®¹å™¨å¯åŠ¨é˜¶æ®µ</strong>å’Œ<strong>Bean å®ä¾‹åŒ–é˜¶æ®µ</strong>ã€‚</p>
<p>å…¶ä¸­å®¹å™¨å¯åŠ¨é˜¶æ®µä¸»è¦åšçš„å·¥ä½œæ˜¯åŠ è½½å’Œè§£æé…ç½®æ–‡ä»¶ï¼Œä¿å­˜åˆ°å¯¹åº”çš„ Bean å®šä¹‰ä¸­ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-8f8103f7-2a51-4858-856e-96a4ac400d76.png" alt="å®¹å™¨å¯åŠ¨å’ŒBeanå®ä¾‹åŒ–é˜¶æ®µ" /></p>
<p>å®¹å™¨å¯åŠ¨å¼€å§‹ï¼Œé¦–å…ˆä¼šé€šè¿‡æŸç§é€”å¾„åŠ è½½ Configuration MetaDataï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®¹å™¨éœ€è¦ä¾èµ–æŸäº›å·¥å…·ç±»ï¼ˆBeanDefinitionReaderï¼‰å¯¹åŠ è½½çš„ Configuration MetaData è¿›è¡Œè§£æå’Œåˆ†æï¼Œå¹¶å°†åˆ†æåçš„ä¿¡æ¯ç»„ä¸ºç›¸åº”çš„ BeanDefinitionã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-dfb3d8c4-ba8d-4a2c-aef2-4ad425f7180c.png" alt="xmlé…ç½®ä¿¡æ¯æ˜ å°„æ³¨å†Œè¿‡ç¨‹" /></p>
<p>æœ€åæŠŠè¿™äº›ä¿å­˜äº† Bean å®šä¹‰å¿…è¦ä¿¡æ¯çš„ BeanDefinitionï¼Œæ³¨å†Œåˆ°ç›¸åº”çš„ BeanDefinitionRegistryï¼Œè¿™æ ·å®¹å™¨å¯åŠ¨å°±å®Œæˆäº†ã€‚</p>
<h4 id="è¯´è¯´-spring-çš„-bean-å®ä¾‹åŒ–æ–¹å¼"><a class="header" href="#è¯´è¯´-spring-çš„-bean-å®ä¾‹åŒ–æ–¹å¼">è¯´è¯´ Spring çš„ Bean å®ä¾‹åŒ–æ–¹å¼</a></h4>
<p>Spring æä¾›äº† 4 ç§ä¸åŒçš„æ–¹å¼æ¥å®ä¾‹åŒ– Beanï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚</p>
<h4 id="è¯´è¯´æ„é€ æ–¹æ³•çš„æ–¹å¼"><a class="header" href="#è¯´è¯´æ„é€ æ–¹æ³•çš„æ–¹å¼">è¯´è¯´æ„é€ æ–¹æ³•çš„æ–¹å¼</a></h4>
<p>åœ¨ç±»ä¸Šä½¿ç”¨@Componentï¼ˆæˆ–@Serviceã€@Repository ç­‰ç‰¹å®šäºåœºæ™¯çš„æ³¨è§£ï¼‰æ ‡æ³¨ç±»ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ä¾èµ–ã€‚</p>
<pre><code class="language-java">@Component
public class ExampleBean {
    private DependencyBean dependency;

    @Autowired
    public ExampleBean(DependencyBean dependency) {
        this.dependency = dependency;
    }
}
</code></pre>
<h4 id="è¯´è¯´é™æ€å·¥å‚çš„æ–¹å¼"><a class="header" href="#è¯´è¯´é™æ€å·¥å‚çš„æ–¹å¼">è¯´è¯´é™æ€å·¥å‚çš„æ–¹å¼</a></h4>
<p>åœ¨è¿™ç§æ–¹å¼ä¸­ï¼ŒBean æ˜¯ç”±ä¸€ä¸ªé™æ€æ–¹æ³•åˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯ç›´æ¥é€šè¿‡æ„é€ æ–¹æ³•ã€‚</p>
<pre><code class="language-java">public class ClientService {
    private static ClientService clientService = new ClientService();

    private ClientService() {}

    public static ClientService createInstance() {
        return clientService;
    }
}
</code></pre>
<h4 id="è¯´è¯´å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–çš„æ–¹å¼"><a class="header" href="#è¯´è¯´å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–çš„æ–¹å¼">è¯´è¯´å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–çš„æ–¹å¼</a></h4>
<p>ä¸é™æ€å·¥å‚æ–¹æ³•ç›¸æ¯”ï¼Œå®ä¾‹å·¥å‚æ–¹æ³•ä¾èµ–äºæŸä¸ªç±»çš„å®ä¾‹æ¥åˆ›å»º Beanã€‚è¿™é€šå¸¸ç”¨åœ¨éœ€è¦é€šè¿‡å·¥å‚å¯¹è±¡çš„éé™æ€æ–¹æ³•æ¥åˆ›å»º Bean çš„åœºæ™¯ã€‚</p>
<pre><code class="language-java">public class ServiceLocator {
    public ClientService createClientServiceInstance() {
        return new ClientService();
    }
}
</code></pre>
<h4 id="è¯´è¯´-factorybean-æ¥å£å®ä¾‹åŒ–æ–¹å¼"><a class="header" href="#è¯´è¯´-factorybean-æ¥å£å®ä¾‹åŒ–æ–¹å¼">è¯´è¯´ FactoryBean æ¥å£å®ä¾‹åŒ–æ–¹å¼</a></h4>
<p>FactoryBean æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Bean ç±»å‹ï¼Œå¯ä»¥åœ¨ Spring å®¹å™¨ä¸­è¿”å›å…¶ä»–å¯¹è±¡çš„å®ä¾‹ã€‚é€šè¿‡å®ç° FactoryBean æ¥å£ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ä¾‹åŒ–é€»è¾‘ï¼Œè¿™å¯¹äºæ„å»ºå¤æ‚çš„åˆå§‹åŒ–é€»è¾‘éå¸¸æœ‰ç”¨ã€‚</p>
<pre><code class="language-java">public class ToolFactoryBean implements FactoryBean&lt;Tool&gt; {
    private int factoryId;
    private int toolId;

    @Override
    public Tool getObject() throws Exception {
        return new Tool(toolId);
    }

    @Override
    public Class&lt;?&gt; getObjectType() {
        return Tool.class;
    }

    @Override
    public boolean isSingleton() {
        return true;
    }

    // setter and getter methods for factoryId and toolId
}
</code></pre>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šè¯´è¯´ Spring çš„ Bean å®ä¾‹åŒ–æ–¹å¼</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢åŒå­¦ 2 ä¼˜é€‰ç‰©æµè°ƒåº¦æŠ€æœ¯ 2 é¢é¢è¯•åŸé¢˜ï¼šbeanåŠ å·¥æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="9ä½ æ˜¯æ€ä¹ˆç†è§£-bean-çš„"><a class="header" href="#9ä½ æ˜¯æ€ä¹ˆç†è§£-bean-çš„">9.ä½ æ˜¯æ€ä¹ˆç†è§£ Bean çš„ï¼Ÿ</a></h3>
<p>Bean æ˜¯æŒ‡ç”± Spring å®¹å™¨ç®¡ç†çš„å¯¹è±¡ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸç”±å®¹å™¨æ§åˆ¶ï¼ŒåŒ…æ‹¬åˆ›å»ºã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œé”€æ¯ã€‚ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼å£°æ˜ï¼š<strong>æ³¨è§£æ–¹å¼</strong>ã€<strong>XML é…ç½®</strong>ã€<strong>Java é…ç½®</strong>ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241224163146.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šBean çš„å£°æ˜æ–¹å¼" /></p>
<p>â‘ ã€ä½¿ç”¨ <code>@Component</code>ã€<code>@Service</code>ã€<code>@Repository</code>ã€<code>@Controller</code> ç­‰æ³¨è§£å®šä¹‰ï¼Œä¸»æµã€‚</p>
<p>â‘¡ã€åŸºäº XML é…ç½®ï¼ŒSpring Boot é¡¹ç›®å·²ç»ä¸æ€ä¹ˆç”¨äº†ã€‚</p>
<p>â‘¢ã€ä½¿ç”¨ Java é…ç½®ç±»åˆ›å»º Beanï¼š</p>
<pre><code class="language-java">@Configuration
public class AppConfig {
    @Bean
    public UserService userService() {
        return new UserService();
    }
}
</code></pre>
<h4 id="component-å’Œ-bean-çš„åŒºåˆ«"><a class="header" href="#component-å’Œ-bean-çš„åŒºåˆ«">@Component å’Œ @Bean çš„åŒºåˆ«</a></h4>
<p><code>@Component</code> æ˜¯ Spring æä¾›çš„ä¸€ä¸ªç±»çº§åˆ«æ³¨è§£ï¼Œç”± Spring è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚</p>
<p><code>@Bean</code> æ˜¯ä¸€ä¸ªæ–¹æ³•çº§åˆ«çš„æ³¨è§£ï¼Œç”¨äºæ˜¾å¼åœ°å£°æ˜ä¸€ä¸ª Beanï¼Œå½“æˆ‘ä»¬éœ€è¦ç¬¬ä¸‰æ–¹åº“æˆ–è€…æ— æ³•ä½¿ç”¨ <code>@Component</code> æ³¨è§£ç±»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>@Bean</code> æ¥å°†å…¶å®ä¾‹æ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šæ€ä¹ˆç†è§£springçš„beanï¼Œ@Component å’Œ @Bean çš„åŒºåˆ«</li>
</ol>
</blockquote>
<h3 id="10èƒ½è¯´ä¸€ä¸‹-bean-çš„ç”Ÿå‘½å‘¨æœŸå—"><a class="header" href="#10èƒ½è¯´ä¸€ä¸‹-bean-çš„ç”Ÿå‘½å‘¨æœŸå—">10.èƒ½è¯´ä¸€ä¸‹ Bean çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ</a></h3>
<p>æ¨èé˜…è¯»ï¼š<a href="https://mp.weixin.qq.com/s/zb6eA3Se0gQoqL8PylCPLw">ä¸‰åˆ†æ¶ï¼šSpring Bean ç”Ÿå‘½å‘¨æœŸï¼Œå¥½åƒäººçš„ä¸€ç”Ÿ</a></p>
<p>Bean çš„ç”Ÿå‘½å‘¨æœŸå¤§è‡´åˆ†ä¸ºäº”ä¸ªé˜¶æ®µï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-595fce5b-36cb-4dcb-b08c-8205a1e98d8a.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanç”Ÿå‘½å‘¨æœŸäº”ä¸ªé˜¶æ®µ" /></p>
<ul>
<li><strong>å®ä¾‹åŒ–</strong>ï¼šSpring é¦–å…ˆä½¿ç”¨æ„é€ æ–¹æ³•æˆ–è€…å·¥å‚æ–¹æ³•åˆ›å»ºä¸€ä¸ª Bean çš„å®ä¾‹ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒBean åªæ˜¯ä¸€ä¸ªç©ºçš„ Java å¯¹è±¡ï¼Œè¿˜æœªè®¾ç½®ä»»ä½•å±æ€§ã€‚</li>
<li><strong>å±æ€§èµ‹å€¼</strong>ï¼šSpring å°†é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼æˆ–ä¾èµ–çš„ Bean æ³¨å…¥åˆ°è¯¥ Bean ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºä¾èµ–æ³¨å…¥ï¼Œç¡®ä¿ Bean æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–éƒ½è¢«æ³¨å…¥ã€‚</li>
<li><strong>åˆå§‹åŒ–</strong>ï¼šSpring è°ƒç”¨ afterPropertiesSet æ–¹æ³•ï¼Œæˆ–é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šçš„ init-method æ–¹æ³•ï¼Œå®Œæˆåˆå§‹åŒ–ã€‚</li>
<li><strong>ä½¿ç”¨ä¸­</strong>ï¼šBean å‡†å¤‡å¥½å¯ä»¥ä½¿ç”¨äº†ã€‚</li>
<li><strong>é”€æ¯</strong>ï¼šåœ¨å®¹å™¨å…³é—­æ—¶ï¼ŒSpring ä¼šè°ƒç”¨ destroy æ–¹æ³•ï¼Œå®Œæˆ Bean çš„æ¸…ç†å·¥ä½œã€‚</li>
</ul>
<h4 id="å¯ä»¥ä»æºç è§’åº¦è®²ä¸€ä¸‹å—"><a class="header" href="#å¯ä»¥ä»æºç è§’åº¦è®²ä¸€ä¸‹å—">å¯ä»¥ä»æºç è§’åº¦è®²ä¸€ä¸‹å—ï¼Ÿ</a></h4>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanç”Ÿå‘½å‘¨æœŸ" /></p>
<ul>
<li><strong>å®ä¾‹åŒ–</strong>ï¼šSpring å®¹å™¨æ ¹æ® Bean çš„å®šä¹‰åˆ›å»º Bean çš„å®ä¾‹ï¼Œç›¸å½“äºæ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ new ä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li><strong>å±æ€§èµ‹å€¼</strong>ï¼šç›¸å½“äºæ‰§è¡Œ setter æ–¹æ³•ä¸ºå­—æ®µèµ‹å€¼ã€‚</li>
<li><strong>åˆå§‹åŒ–</strong>ï¼šåˆå§‹åŒ–é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„é€»è¾‘ï¼Œæ¯”å¦‚è®¾ç½®æŸäº›å¿…è¦çš„å±æ€§å€¼ã€å¼€å¯èµ„æºã€æ‰§è¡Œé¢„åŠ è½½æ“ä½œç­‰ï¼Œä»¥ç¡®ä¿ Bean åœ¨ä½¿ç”¨ä¹‹å‰æ˜¯å®Œå…¨é…ç½®å¥½çš„ã€‚</li>
<li><strong>é”€æ¯</strong>ï¼šç›¸å½“äºæ‰§è¡Œ <code>= null</code>ï¼Œé‡Šæ”¾èµ„æºã€‚</li>
</ul>
<p>å¯ä»¥åœ¨æºç  <code>AbstractAutowireCapableBeanFactory</code> ä¸­çš„ <code>doCreateBean</code> æ–¹æ³•ä¸­ï¼Œçœ‹åˆ° Bean çš„å‰ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼š</p>
<pre><code class="language-java">protected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) throws BeanCreationException {
    BeanWrapper instanceWrapper = null;
    if (mbd.isSingleton()) {
        instanceWrapper = (BeanWrapper)this.factoryBeanInstanceCache.remove(beanName);
    }

    if (instanceWrapper == null) {
        // å®ä¾‹åŒ–é˜¶æ®µ
        instanceWrapper = this.createBeanInstance(beanName, mbd, args);
    }

    ...

    Object exposedObject = bean;

    try {
        // å±æ€§èµ‹å€¼é˜¶æ®µ
        this.populateBean(beanName, mbd, instanceWrapper);
        // åˆå§‹åŒ–é˜¶æ®µ
        exposedObject = this.initializeBean(beanName, exposedObject, mbd);
    } catch (Throwable var18) {
        ...
    }

    ...
}
</code></pre>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d2da20a3-08d0-4648-b9a3-2fff8512b159.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanç”Ÿå‘½å‘¨æœŸæºç è¿½è¸ª" /></p>
<p>æºç ä½ç½®ï¼Œè§ä¸‹å›¾ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240311101430.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šdoCreateBean æ–¹æ³•æºç " /></p>
<p>è‡³äºé”€æ¯ï¼Œæ˜¯åœ¨å®¹å™¨å…³é—­çš„æ—¶å€™è°ƒç”¨çš„ï¼Œè¯¦è§ <code>ConfigurableApplicationContext</code> çš„ <code>close</code> æ–¹æ³•ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240311101658.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šclose æºç " /></p>
<h4 id="è¯·åœ¨ä¸€ä¸ªå·²æœ‰çš„-spring-boot-é¡¹ç›®ä¸­é€šè¿‡å•å…ƒæµ‹è¯•çš„å½¢å¼æ¥å±•ç¤º-spring-bean-çš„ç”Ÿå‘½å‘¨æœŸ"><a class="header" href="#è¯·åœ¨ä¸€ä¸ªå·²æœ‰çš„-spring-boot-é¡¹ç›®ä¸­é€šè¿‡å•å…ƒæµ‹è¯•çš„å½¢å¼æ¥å±•ç¤º-spring-bean-çš„ç”Ÿå‘½å‘¨æœŸ">è¯·åœ¨ä¸€ä¸ªå·²æœ‰çš„ Spring Boot é¡¹ç›®ä¸­é€šè¿‡å•å…ƒæµ‹è¯•çš„å½¢å¼æ¥å±•ç¤º Spring Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</a></h4>
<p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ª LifecycleDemoBean ç±»ï¼š</p>
<pre><code class="language-java">public class LifecycleDemoBean implements InitializingBean, DisposableBean {

    // ä½¿ç”¨@Valueæ³¨è§£æ³¨å…¥å±æ€§å€¼ï¼Œè¿™é‡Œæ¼”ç¤ºäº†å¦‚ä½•ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å€¼
    // å¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰å®šä¹‰lifecycle.demo.bean.nameï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼"default name"
    @Value("${lifecycle.demo.bean.name:default name}")
    private String name;

    // æ„é€ æ–¹æ³•ï¼šåœ¨Beanå®ä¾‹åŒ–æ—¶è°ƒç”¨
    public LifecycleDemoBean() {
        System.out.println("LifecycleDemoBean: å®ä¾‹åŒ–");
    }

    // å±æ€§èµ‹å€¼ï¼šSpringé€šè¿‡åå°„è°ƒç”¨setteræ–¹æ³•ä¸ºBeançš„å±æ€§æ³¨å…¥å€¼
    public void setName(String name) {
        System.out.println("LifecycleDemoBean: å±æ€§èµ‹å€¼");
        this.name = name;
    }

    // ä½¿ç”¨@PostConstructæ³¨è§£çš„æ–¹æ³•ï¼šåœ¨Beançš„å±æ€§èµ‹å€¼å®Œæˆåè°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘
    @PostConstruct
    public void postConstruct() {
        System.out.println("LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰");
    }

    // å®ç°InitializingBeanæ¥å£ï¼šafterPropertiesSetæ–¹æ³•åœ¨@PostConstructæ³¨è§£çš„æ–¹æ³•ä¹‹åè°ƒç”¨
    // ç”¨äºæ‰§è¡Œæ›´å¤šçš„åˆå§‹åŒ–é€»è¾‘
    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println("LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰");
    }

    // è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼šåœ¨XMLé…ç½®æˆ–Javaé…ç½®ä¸­æŒ‡å®šï¼Œæ‰§è¡Œç‰¹å®šçš„åˆå§‹åŒ–é€»è¾‘
    public void customInit() {
        System.out.println("LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰");
    }

    // ä½¿ç”¨@PreDestroyæ³¨è§£çš„æ–¹æ³•ï¼šåœ¨å®¹å™¨é”€æ¯Beanä¹‹å‰è°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œæ¸…ç†å·¥ä½œ
    @PreDestroy
    public void preDestroy() {
        System.out.println("LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰");
    }

    // å®ç°DisposableBeanæ¥å£ï¼šdestroyæ–¹æ³•åœ¨@PreDestroyæ³¨è§£çš„æ–¹æ³•ä¹‹åè°ƒç”¨
    // ç”¨äºæ‰§è¡Œæ¸…ç†èµ„æºç­‰é”€æ¯é€»è¾‘
    @Override
    public void destroy() throws Exception {
        System.out.println("LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰");
    }

    // è‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼šåœ¨XMLé…ç½®æˆ–Javaé…ç½®ä¸­æŒ‡å®šï¼Œæ‰§è¡Œç‰¹å®šçš„æ¸…ç†é€»è¾‘
    public void customDestroy() {
        System.out.println("LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰");
    }
}
</code></pre>
<p><strong>â‘ ã€å®ä¾‹åŒ–</strong></p>
<p>å®ä¾‹åŒ–æ˜¯åˆ›å»º Bean å®ä¾‹çš„è¿‡ç¨‹ï¼Œå³åœ¨å†…å­˜ä¸­ä¸º Bean å¯¹è±¡åˆ†é…ç©ºé—´ã€‚è¿™ä¸€æ­¥æ˜¯é€šè¿‡è°ƒç”¨ Bean çš„æ„é€ æ–¹æ³•å®Œæˆçš„ã€‚</p>
<pre><code class="language-java">public LifecycleDemoBean() {
    System.out.println("LifecycleDemoBean: å®ä¾‹åŒ–");
}
</code></pre>
<p>åœ¨è¿™é‡Œï¼Œå½“ Spring åˆ›å»º LifecycleDemoBean çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨å…¶æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å®ä¾‹åŒ–ã€‚</p>
<p><strong>â‘¡ã€å±æ€§èµ‹å€¼</strong></p>
<p>åœ¨å®ä¾‹åŒ–ä¹‹åï¼ŒSpring å°†æ ¹æ® Bean å®šä¹‰ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œé€šè¿‡åå°„æœºåˆ¶ä¸º Bean çš„å±æ€§èµ‹å€¼ã€‚</p>
<pre><code class="language-java">@Value("${lifecycle.demo.bean.name:default name}")
private String name;

public void setName(String name) {
    System.out.println("LifecycleDemoBean: å±æ€§èµ‹å€¼");
    this.name = name;
}
</code></pre>
<p><code>@Value</code>æ³¨è§£å’Œ setter æ–¹æ³•ä½“ç°äº†å±æ€§èµ‹å€¼çš„è¿‡ç¨‹ã€‚<code>@Value</code>æ³¨è§£è®© Spring æ³¨å…¥é…ç½®å€¼ï¼ˆæˆ–é»˜è®¤å€¼ï¼‰ï¼Œsetter æ–¹æ³•åˆ™æ˜¯å±æ€§èµ‹å€¼çš„å…·ä½“æ“ä½œã€‚</p>
<p><strong>â‘¢ã€åˆå§‹åŒ–</strong></p>
<p>åˆå§‹åŒ–é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘ï¼Œæ¯”å¦‚æ£€æŸ¥å¿…è¦çš„å±æ€§æ˜¯å¦å·²ç»è®¾ç½®ã€å¼€å¯èµ„æºç­‰ã€‚Spring æä¾›äº†å¤šç§æ–¹å¼æ¥é…ç½®åˆå§‹åŒ–é€»è¾‘ã€‚</p>
<p>1ã€ä½¿ç”¨ <code>@PostConstruct</code> æ³¨è§£çš„æ–¹æ³•</p>
<pre><code class="language-java">@PostConstruct
public void postConstruct() {
    System.out.println("LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰");
}
</code></pre>
<p><code>@PostConstruct</code>æ³¨è§£çš„æ–¹æ³•åœ¨ Bean çš„æ‰€æœ‰å±æ€§éƒ½è¢«èµ‹å€¼åï¼Œä¸”ç”¨æˆ·è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚</p>
<p>2ã€å®ç° <code>InitializingBean</code> æ¥å£çš„ <code>afterPropertiesSet</code> æ–¹æ³•</p>
<pre><code class="language-java">@Override
public void afterPropertiesSet() throws Exception {
    System.out.println("LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰");
}
</code></pre>
<p>afterPropertiesSet æ–¹æ³•æä¾›äº†å¦ä¸€ç§åˆå§‹åŒ– Bean çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨æ‰€æœ‰å±æ€§èµ‹å€¼åè°ƒç”¨ã€‚</p>
<p>3ã€è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•</p>
<pre><code class="language-java">public void customInit() {
    System.out.println("LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰");
}
</code></pre>
<p>éœ€è¦åœ¨é…ç½®ç±»ä¸­æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<pre><code class="language-java">@Bean(initMethod = "customInit")
public LifecycleDemoBean lifecycleDemoBean() {
    return new LifecycleDemoBean();
}
</code></pre>
<p><strong>â‘£ã€é”€æ¯</strong></p>
<p>é”€æ¯é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„é”€æ¯é€»è¾‘ï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºã€‚ç±»ä¼¼äºåˆå§‹åŒ–é˜¶æ®µï¼ŒSpring ä¹Ÿæä¾›äº†å¤šç§æ–¹å¼æ¥é…ç½®é”€æ¯é€»è¾‘ã€‚</p>
<p>1ã€ä½¿ç”¨ <code>@PreDestroy</code> æ³¨è§£çš„æ–¹æ³•</p>
<pre><code class="language-java">@PreDestroy
public void preDestroy() {
    System.out.println("LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰");
}
</code></pre>
<p><code>@PreDestroy</code>æ³¨è§£çš„æ–¹æ³•åœ¨ Bean è¢«é”€æ¯å‰è°ƒç”¨ã€‚</p>
<p>2ã€å®ç° <code>DisposableBean</code> æ¥å£çš„ <code>destroy</code> æ–¹æ³•</p>
<pre><code class="language-java">@Override
public void destroy() throws Exception {
    System.out.println("LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰");
}
</code></pre>
<p>destroy æ–¹æ³•æä¾›äº†å¦ä¸€ç§é”€æ¯ Bean çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨ Bean è¢«é”€æ¯å‰è°ƒç”¨ã€‚</p>
<p>3ã€è‡ªå®šä¹‰é”€æ¯æ–¹æ³•</p>
<pre><code class="language-java">public void customDestroy() {
    System.out.println("LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰");
}
</code></pre>
<p>éœ€è¦åœ¨é…ç½®ç±»ä¸­æŒ‡å®šé”€æ¯æ–¹æ³•ï¼š</p>
<pre><code class="language-java">@Bean(destroyMethod = "customDestroy")
public LifecycleDemoBean lifecycleDemoBean() {
    return new LifecycleDemoBean();
}
</code></pre>
<p>ç¬¬äºŒæ­¥ï¼Œæ³¨å†Œ Bean å¹¶æŒ‡å®šè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³•ï¼š</p>
<pre><code class="language-java">@Configuration
public class LifecycleDemoConfig {

    @Bean(initMethod = "customInit", destroyMethod = "customDestroy")
    public LifecycleDemoBean lifecycleDemoBean() {
        return new LifecycleDemoBean();
    }
}
</code></pre>
<p>ç¬¬ä¸‰æ­¥ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š</p>
<pre><code class="language-java">@SpringBootTest
public class LifecycleDemoTest {

    @Autowired
    private ApplicationContext context;

    @Test
    public void testBeanLifecycle() {
        System.out.println("è·å–LifecycleDemoBeanå®ä¾‹...");
        LifecycleDemoBean bean = context.getBean(LifecycleDemoBean.class);
    }
}
</code></pre>
<p>è¿è¡Œå•å…ƒæµ‹è¯•ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š</p>
<pre><code class="language-java">LifecycleDemoBean: å®ä¾‹åŒ–
LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰
LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰
LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰
è·å–LifecycleDemoBeanå®ä¾‹...
LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰
LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰
LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰
</code></pre>
<h4 id="aware-ç±»å‹çš„æ¥å£æœ‰ä»€ä¹ˆä½œç”¨"><a class="header" href="#aware-ç±»å‹çš„æ¥å£æœ‰ä»€ä¹ˆä½œç”¨">Aware ç±»å‹çš„æ¥å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</a></h4>
<p>é€šè¿‡å®ç° Aware æ¥å£ï¼ŒBean å¯ä»¥è·å– Spring å®¹å™¨çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ BeanFactoryã€ApplicationContext ç­‰ã€‚</p>
<p>å¸¸è§ Aware æ¥å£æœ‰ï¼š
æ¥å£|	ä½œç”¨
---|---
BeanNameAware|	è·å–å½“å‰ Bean çš„åç§°ã€‚
BeanFactoryAware|	è·å–å½“å‰ Bean æ‰€åœ¨çš„ BeanFactory å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥æ“ä½œå®¹å™¨ã€‚
ApplicationContextAware|	è·å–å½“å‰ Bean æ‰€åœ¨çš„ ApplicationContext å®ä¾‹ã€‚
EnvironmentAware|	è·å– Environment å¯¹è±¡ï¼Œç”¨äºè·å–é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§æˆ–ç¯å¢ƒå˜é‡ã€‚
ServletContextAware|	åœ¨ Web ç¯å¢ƒä¸‹è·å– ServletContext å®ä¾‹ï¼Œè®¿é—® Web åº”ç”¨ä¸Šä¸‹æ–‡ã€‚
ResourceLoaderAware|	è·å– ResourceLoader å¯¹è±¡ï¼Œç”¨äºåŠ è½½èµ„æºæ–‡ä»¶ï¼ˆå¦‚ç±»è·¯å¾„æ–‡ä»¶æˆ– URLï¼‰ã€‚</p>
<h4 id="å¦‚æœé…ç½®äº†-init-method-å’Œ-destroy-methodspring-ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•"><a class="header" href="#å¦‚æœé…ç½®äº†-init-method-å’Œ-destroy-methodspring-ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•">å¦‚æœé…ç½®äº† init-method å’Œ destroy-methodï¼ŒSpring ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ</a></h4>
<p>init-method åœ¨ Bean åˆå§‹åŒ–é˜¶æ®µè°ƒç”¨ï¼Œä¾èµ–æ³¨å…¥å®Œæˆåä¸” postProcessBeforeInitialization è°ƒç”¨ä¹‹åæ‰§è¡Œã€‚</p>
<p>destroy-method åœ¨ Bean é”€æ¯é˜¶æ®µè°ƒç”¨ï¼Œå®¹å™¨å…³é—­æ—¶è°ƒç”¨ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241117135852.png" alt="äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šinit-method å’Œ destroy-method" /></p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ Bean çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringä¸­beanç”Ÿå‘½å‘¨æœŸ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„8 åç«¯å¼€å‘ç§‹æ‹›ä¸€é¢é¢è¯•åŸé¢˜ï¼šè®²ä¸€ä¸‹Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŒå­¦ 1 è´å£³æ‰¾æˆ¿åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šbeanç”Ÿå‘½å‘¨æœŸ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šä»‹ç»ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸï¼ŸAwareç±»å‹æ¥å£çš„ä½œç”¨ï¼Ÿå¦‚æœé…ç½®äº†init-methodå’Œdestroy-methodï¼ŒSpringä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="11ä¸ºä»€ä¹ˆ-idea-ä¸æ¨èä½¿ç”¨-autowired-æ³¨è§£æ³¨å…¥-bean"><a class="header" href="#11ä¸ºä»€ä¹ˆ-idea-ä¸æ¨èä½¿ç”¨-autowired-æ³¨è§£æ³¨å…¥-bean">11.ä¸ºä»€ä¹ˆ IDEA ä¸æ¨èä½¿ç”¨ @Autowired æ³¨è§£æ³¨å…¥ Beanï¼Ÿ</a></h3>
<p>å½“ä½¿ç”¨ <code>@Autowired</code> æ³¨è§£æ³¨å…¥ Bean æ—¶ï¼ŒIDEA ä¼šæç¤ºâ€œField injection is not recommendedâ€ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241224164722.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼š@Autowired" /></p>
<p>è¿™æ˜¯å› ä¸ºå­—æ®µæ³¨å…¥çš„æ–¹å¼ï¼š</p>
<ul>
<li>ä¸èƒ½åƒæ„é€ æ–¹æ³•é‚£æ ·ä½¿ç”¨ final æ³¨å…¥ä¸å¯å˜å¯¹è±¡</li>
<li>éšè—äº†ä¾èµ–å…³ç³»ï¼Œè°ƒç”¨è€…å¯ä»¥çœ‹åˆ°æ„é€ æ–¹æ³•æ³¨å…¥æˆ–è€… setter æ³¨å…¥ï¼Œä½†æ— æ³•çœ‹åˆ°ç§æœ‰å­—æ®µçš„æ³¨å…¥</li>
</ul>
<p>åœ¨ Spring 4.3 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼ŒSpring ä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥æ„é€ æ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œæ— éœ€ä½¿ç”¨ <code>@Autowired</code> æ³¨è§£ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241224165628.png" alt="æŠ€æœ¯æ´¾ï¼šæ„é€ æ–¹æ³•æ³¨å…¥" /></p>
<h4 id="autowired-å’Œ-resource-æ³¨è§£çš„åŒºåˆ«"><a class="header" href="#autowired-å’Œ-resource-æ³¨è§£çš„åŒºåˆ«">@Autowired å’Œ @Resource æ³¨è§£çš„åŒºåˆ«ï¼Ÿ</a></h4>
<ul>
<li><code>@Autowired</code> æ˜¯ Spring æä¾›çš„æ³¨è§£ï¼ŒæŒ‰ç±»å‹ï¼ˆbyTypeï¼‰æ³¨å…¥ã€‚</li>
<li><code>@Resource</code> æ˜¯ Java EE æä¾›çš„æ³¨è§£ï¼ŒæŒ‰åç§°ï¼ˆbyNameï¼‰æ³¨å…¥ã€‚</li>
</ul>
<p>è™½ç„¶ IDEA ä¸æ¨èä½¿ç”¨ <code>@Autowired</code>ï¼Œä½†å¯¹ <code>@Resource</code> æ³¨è§£å´æ²¡æœ‰ä»»ä½•æç¤ºã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241224170055.png" alt="æŠ€æœ¯æ´¾ï¼š@Resource" /></p>
<p>è¿™æ˜¯å› ä¸º <code>@Resource</code> å±äº Java EE æ ‡å‡†çš„æ³¨è§£ï¼Œå¦‚æœä½¿ç”¨å…¶ä»– IOC å®¹å™¨è€Œä¸æ˜¯ Spring ä¹Ÿæ˜¯å¯ä»¥å…¼å®¹çš„ã€‚</p>
<h4 id="æåˆ°äº†bytypeå¦‚æœä¸¤ä¸ªç±»å‹ä¸€è‡´çš„å‘ç”Ÿäº†å†²çªåº”è¯¥æ€ä¹ˆå¤„ç†"><a class="header" href="#æåˆ°äº†bytypeå¦‚æœä¸¤ä¸ªç±»å‹ä¸€è‡´çš„å‘ç”Ÿäº†å†²çªåº”è¯¥æ€ä¹ˆå¤„ç†">æåˆ°äº†byTypeï¼Œå¦‚æœä¸¤ä¸ªç±»å‹ä¸€è‡´çš„å‘ç”Ÿäº†å†²çªï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†</a></h4>
<p>å½“å®¹å™¨ä¸­å­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„ beanï¼Œç¼–è¯‘å™¨ä¼šæç¤º <code>Could not autowire. There is more than one bean of 'UserRepository2' type.</code></p>
<pre><code class="language-java">@Component
public class UserRepository21 implements UserRepository2 {}

@Component
public class UserRepository22 implements UserRepository2 {}

@Component
public class UserService2 {
    @Autowired
    private UserRepository2 userRepository; // å†²çª
}
</code></pre>
<p>è¿™æ—¶å€™ï¼Œå°±å¯ä»¥é…åˆ <code>@Qualifier</code> æ³¨è§£æ¥æŒ‡å®šå…·ä½“çš„ bean åç§°ï¼š</p>
<pre><code class="language-java">@Component("userRepository21")
public class UserRepository21 implements UserRepository2 {
}
@Component("userRepository22")
public class UserRepository22 implements UserRepository2 {
}
@Autowired
@Qualifier("userRepository22")
private UserRepository2 userRepository22;
</code></pre>
<p>æˆ–è€…ä½¿ç”¨ <code>@Resource</code> æ³¨è§£æŒ‰åç§°è¿›è¡Œæ³¨å…¥ï¼ŒæŒ‡å®š name å±æ€§ã€‚</p>
<pre><code class="language-java">@Resource(name = "userRepository21")
private UserRepository2 userRepository21;
</code></pre>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šä¾èµ–æ³¨å…¥çš„æ—¶å€™ï¼Œç›´æ¥Autowiredæ¯”è¾ƒç›´æ¥ï¼Œä¸ºä»€ä¹ˆæ¨èæ„é€ æ–¹æ³•æ³¨å…¥å‘¢</li>
</ol>
</blockquote>
<h3 id="12spring-æœ‰å“ªäº›è‡ªåŠ¨è£…é…çš„æ–¹å¼"><a class="header" href="#12spring-æœ‰å“ªäº›è‡ªåŠ¨è£…é…çš„æ–¹å¼">12.Spring æœ‰å“ªäº›è‡ªåŠ¨è£…é…çš„æ–¹å¼ï¼Ÿ</a></h3>
<blockquote>
<p><strong>ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…ï¼Ÿ</strong></p>
</blockquote>
<p>Spring IoC å®¹å™¨çŸ¥é“æ‰€æœ‰ Bean çš„é…ç½®ä¿¡æ¯ï¼Œæ­¤å¤–ï¼Œé€šè¿‡ Java åå°„æœºåˆ¶è¿˜å¯ä»¥è·çŸ¥å®ç°ç±»çš„ç»“æ„ä¿¡æ¯ï¼Œå¦‚æ„é€ æ–¹æ³•çš„ç»“æ„ã€å±æ€§ç­‰ä¿¡æ¯ã€‚æŒæ¡æ‰€æœ‰ Bean çš„è¿™äº›ä¿¡æ¯åï¼ŒSpring IoC å®¹å™¨å°±å¯ä»¥æŒ‰ç…§æŸç§è§„åˆ™å¯¹å®¹å™¨ä¸­çš„ Bean è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œè€Œæ— é¡»é€šè¿‡æ˜¾å¼çš„æ–¹å¼è¿›è¡Œä¾èµ–é…ç½®ã€‚</p>
<p>Spring æä¾›çš„è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æŒ‰ç…§æŸäº›è§„åˆ™è¿›è¡Œ Bean çš„è‡ªåŠ¨è£…é…ï¼Œ<code>&lt;bean&gt;</code>å…ƒç´ æä¾›äº†ä¸€ä¸ªæŒ‡å®šè‡ªåŠ¨è£…é…ç±»å‹çš„å±æ€§ï¼š<code>autowire="&lt;è‡ªåŠ¨è£…é…ç±»å‹&gt;"</code></p>
<blockquote>
<p><strong>Spring æä¾›äº†å“ªå‡ ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼Ÿ</strong></p>
</blockquote>
<p>Spring æä¾›äº† 4 ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-034120d9-88c7-490b-af07-7d48f3b6b7bc.png" alt="Springå››ç§è‡ªåŠ¨è£…é…ç±»å‹" /></p>
<ul>
<li><strong>byName</strong>ï¼šæ ¹æ®åç§°è¿›è¡Œè‡ªåŠ¨åŒ¹é…ï¼Œå‡è®¾ Boss æœ‰ä¸€ä¸ªåä¸º car çš„å±æ€§ï¼Œå¦‚æœå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ªåä¸º car çš„ beanï¼ŒSpring å°±ä¼šè‡ªåŠ¨å°†å…¶è£…é…ç»™ Boss çš„ car å±æ€§</li>
<li><strong>byType</strong>ï¼šæ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨åŒ¹é…ï¼Œå‡è®¾ Boss æœ‰ä¸€ä¸ª Car ç±»å‹çš„å±æ€§ï¼Œå¦‚æœå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ª Car ç±»å‹çš„ Beanï¼ŒSpring å°±ä¼šè‡ªåŠ¨å°†å…¶è£…é…ç»™ Boss è¿™ä¸ªå±æ€§</li>
<li><strong>constructor</strong>ï¼šä¸ byType ç±»ä¼¼ï¼Œ åªä¸è¿‡å®ƒæ˜¯é’ˆå¯¹æ„é€ å‡½æ•°æ³¨å…¥è€Œè¨€çš„ã€‚å¦‚æœ Boss æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°åŒ…å«ä¸€ä¸ª Car ç±»å‹çš„å…¥å‚ï¼Œå¦‚æœå®¹å™¨ä¸­æœ‰ä¸€ä¸ª Car ç±»å‹çš„ Beanï¼Œåˆ™ Spring å°†è‡ªåŠ¨æŠŠè¿™ä¸ª Bean ä½œä¸º Boss æ„é€ å‡½æ•°çš„å…¥å‚ï¼›å¦‚æœå®¹å™¨ä¸­æ²¡æœ‰æ‰¾åˆ°å’Œæ„é€ å‡½æ•°å…¥å‚åŒ¹é…ç±»å‹çš„ Beanï¼Œåˆ™ Spring å°†æŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li><strong>autodetect</strong>ï¼šæ ¹æ® Bean çš„è‡ªçœæœºåˆ¶å†³å®šé‡‡ç”¨ byType è¿˜æ˜¯ constructor è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œå¦‚æœ Bean æä¾›äº†é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œåˆ™é‡‡ç”¨ byTypeï¼Œå¦åˆ™é‡‡ç”¨ constructorã€‚</li>
</ul>
<h3 id="13bean-çš„ä½œç”¨åŸŸæœ‰å“ªäº›"><a class="header" href="#13bean-çš„ä½œç”¨åŸŸæœ‰å“ªäº›">13.Bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›?</a></h3>
<p>åœ¨ Spring ä¸­ï¼ŒBean é»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œå³åœ¨æ•´ä¸ª Spring å®¹å™¨ä¸­ï¼Œæ¯ä¸ª Bean åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>å¯ä»¥é€šè¿‡åœ¨é…ç½®ä¸­æŒ‡å®š scope å±æ€§ï¼Œå°† Bean æ”¹ä¸ºå¤šä¾‹ï¼ˆPrototypeï¼‰æ¨¡å¼ï¼Œè¿™æ ·æ¯æ¬¡è·å–çš„éƒ½æ˜¯æ–°çš„å®ä¾‹ã€‚</p>
<pre><code class="language-java">@Bean
@Scope("prototype")  // æ¯æ¬¡è·å–éƒ½æ˜¯æ–°çš„å®ä¾‹
public MyBean myBean() {
    return new MyBean();
}
</code></pre>
<p>é™¤äº†å•ä¾‹å’Œå¤šä¾‹ï¼ŒSpring è¿˜æ”¯æŒå…¶ä»–ä½œç”¨åŸŸï¼Œå¦‚è¯·æ±‚ä½œç”¨åŸŸï¼ˆRequestï¼‰ã€ä¼šè¯ä½œç”¨åŸŸï¼ˆSessionï¼‰ç­‰ï¼Œé€‚åˆ Web åº”ç”¨ä¸­ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-08a9cb31-5a4f-4224-94cd-0c0f643a57ea.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanæ”¯æŒä½œç”¨åŸŸ" /></p>
<ul>
<li><strong>request</strong>ï¼šæ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Beanï¼Œè¯¥ Bean ä»…åœ¨å½“å‰ HTTP Request å†…æœ‰æ•ˆã€‚</li>
<li><strong>session</strong>ï¼šåŒä¸€ä¸ª Session å…±äº«ä¸€ä¸ª Beanï¼Œä¸åŒçš„ Session ä½¿ç”¨ä¸åŒçš„ Beanã€‚</li>
<li><strong>globalSession</strong>ï¼šåŒä¸€ä¸ªå…¨å±€ Session å…±äº«ä¸€ä¸ª Beanï¼Œåªç”¨äºåŸºäº Protlet çš„ Web åº”ç”¨ï¼ŒSpring5 ä¸­å·²ç»ç§»é™¤ã€‚</li>
</ul>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åŒå­¦ 1 è´å£³æ‰¾æˆ¿åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šbeanæ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹çš„ï¼Œå…·ä½“æ€ä¹ˆä¿®æ”¹</li>
</ol>
</blockquote>
<h3 id="14spring-ä¸­çš„å•ä¾‹-bean-ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜å—"><a class="header" href="#14spring-ä¸­çš„å•ä¾‹-bean-ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜å—">14.Spring ä¸­çš„å•ä¾‹ Bean ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜å—ï¼Ÿ</a></h3>
<p>Spring Bean çš„é»˜è®¤ä½œç”¨åŸŸæ˜¯å•ä¾‹ï¼ˆSingletonï¼‰ï¼Œè¿™æ„å‘³ç€ Spring å®¹å™¨ä¸­åªä¼šå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ï¼Œå¹¶ä¸”è¯¥å®ä¾‹ä¼šè¢«å¤šä¸ªçº¿ç¨‹å…±äº«ã€‚</p>
<p>å¦‚æœå•ä¾‹ Bean æ˜¯æ— çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚ Spring MVC ä¸­çš„ Controllerã€Serviceã€Dao ç­‰ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æ— çŠ¶æ€çš„ã€‚</p>
<p>ä½†å¦‚æœ Bean çš„å†…éƒ¨çŠ¶æ€æ˜¯å¯å˜çš„ï¼Œä¸”æ²¡æœ‰è¿›è¡Œé€‚å½“çš„åŒæ­¥å¤„ç†ï¼Œå°±å¯èƒ½å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-35dacef4-1a9e-45e1-b3f2-5a91227eb244.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå•ä¾‹Beançº¿ç¨‹å®‰å…¨é—®é¢˜" /></p>
<h4 id="å•ä¾‹-bean-çº¿ç¨‹å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³å‘¢"><a class="header" href="#å•ä¾‹-bean-çº¿ç¨‹å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³å‘¢">å•ä¾‹ Bean çº¿ç¨‹å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</a></h4>
<p>ç¬¬ä¸€ï¼Œä½¿ç”¨å±€éƒ¨å˜é‡ã€‚å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡å‰¯æœ¬ã€‚å°½é‡ä½¿ç”¨å±€éƒ¨å˜é‡è€Œä¸æ˜¯å…±äº«çš„æˆå‘˜å˜é‡ã€‚</p>
<pre><code class="language-java">public class MyService {
    public void process() {
        int localVar = 0;
        // ä½¿ç”¨å±€éƒ¨å˜é‡è¿›è¡Œæ“ä½œ
    }
}
</code></pre>
<p>ç¬¬äºŒï¼Œå°½é‡ä½¿ç”¨æ— çŠ¶æ€çš„ Beanï¼Œå³ä¸åœ¨ Bean ä¸­ä¿å­˜ä»»ä½•å¯å˜çš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<pre><code class="language-java">public class MyStatelessService {
    public void process() {
        // æ— çŠ¶æ€å¤„ç†
    }
}
</code></pre>
<p>ç¬¬ä¸‰ï¼ŒåŒæ­¥è®¿é—®ã€‚å¦‚æœ Bean ä¸­ç¡®å®éœ€è¦ä¿å­˜å¯å˜çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ <a href="https://javabetter.cn/thread/synchronized-1.html">synchronized å…³é”®å­—</a>æˆ–è€… <a href="https://javabetter.cn/thread/reentrantLock.html">Lock æ¥å£</a>æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<pre><code class="language-java">public class MyService {
    private int sharedVar;

    public synchronized void increment() {
        sharedVar++;
    }
}
</code></pre>
<p>æˆ–è€…å°† Bean ä¸­çš„æˆå‘˜å˜é‡ä¿å­˜åˆ° ThreadLocal ä¸­ï¼Œ<a href="https://javabetter.cn/thread/ThreadLocal.html">ThreadLocal</a> å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å˜é‡çš„éš”ç¦»ã€‚</p>
<pre><code class="language-java">public class MyService {
    private ThreadLocal&lt;Integer&gt; localVar = ThreadLocal.withInitial(() -&gt; 0);

    public void process() {
        localVar.set(localVar.get() + 1);
    }
}
</code></pre>
<p>å†æˆ–è€…ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»ï¼Œæ¯”å¦‚è¯´ <a href="https://javabetter.cn/thread/atomic.html">AtomicInteger</a>ã€<a href="https://javabetter.cn/thread/ConcurrentHashMap.html">ConcurrentHashMap</a>ã€<a href="https://javabetter.cn/thread/CopyOnWriteArrayList.html">CopyOnWriteArrayList</a> ç­‰ã€‚</p>
<pre><code class="language-java">public class MyService {
    private ConcurrentHashMap&lt;String, String&gt; map = new ConcurrentHashMap&lt;&gt;();

    public void putValue(String key, String value) {
        map.put(key, value);
    }
}
</code></pre>
<p>ç¬¬å››ï¼Œå°† Bean å®šä¹‰ä¸ºåŸå‹ä½œç”¨åŸŸï¼ˆPrototypeï¼‰ã€‚åŸå‹ä½œç”¨åŸŸçš„ Bean æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå› æ­¤ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<pre><code class="language-java">@Component
@Scope("prototype")
public class MyService {
    // å®ä¾‹å˜é‡
}
</code></pre>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œé¢ç»åŒå­¦ 1 é—²é±¼åç«¯ä¸€é¢çš„åŸé¢˜ï¼šspringçš„beançš„å¹¶å‘å®‰å…¨é—®é¢˜</li>
</ol>
</blockquote>
<h3 id="15è¯´è¯´å¾ªç¯ä¾èµ–"><a class="header" href="#15è¯´è¯´å¾ªç¯ä¾èµ–">15.è¯´è¯´å¾ªç¯ä¾èµ–?</a></h3>
<p>A ä¾èµ– Bï¼ŒB ä¾èµ– Aï¼Œæˆ–è€… C ä¾èµ– Cï¼Œå°±æˆäº†å¾ªç¯ä¾èµ–ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-f8fea53f-56fa-4cca-9199-ec7f648da625.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå¾ªç¯ä¾èµ–" /></p>
<blockquote>
<p>å¾ªç¯ä¾èµ–åªå‘ç”Ÿåœ¨ Singleton ä½œç”¨åŸŸçš„ Bean ä¹‹é—´ï¼Œå› ä¸ºå¦‚æœæ˜¯ Prototype ä½œç”¨åŸŸçš„ Beanï¼ŒSpring ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p>
</blockquote>
<p>åŸå› å¾ˆç®€å•ï¼ŒAB å¾ªç¯ä¾èµ–ï¼ŒA å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå‘ç°ä¾èµ– Bï¼Œåˆ›å»º B å®ä¾‹ï¼Œåˆ›å»º B çš„æ—¶å€™å‘ç°éœ€è¦ Aï¼Œåˆ›å»º A1 å®ä¾‹â€¦â€¦æ— é™å¥—å¨ƒã€‚ã€‚ã€‚ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼Œå…ˆæ˜¯ PrototypeBeanAï¼š</p>
<pre><code class="language-java">@Component
@Scope("prototype")
public class PrototypeBeanA {
    private final PrototypeBeanB prototypeBeanB;

    @Autowired
    public PrototypeBeanA(PrototypeBeanB prototypeBeanB) {
        this.prototypeBeanB = prototypeBeanB;
    }
}
</code></pre>
<p>ç„¶åæ˜¯ PrototypeBeanBï¼š</p>
<pre><code class="language-java">@Component
@Scope("prototype")
public class PrototypeBeanB {
    private final PrototypeBeanA prototypeBeanA;

    @Autowired
    public PrototypeBeanB(PrototypeBeanA prototypeBeanA) {
        this.prototypeBeanA = prototypeBeanA;
    }
}
</code></pre>
<p>å†ç„¶åæ˜¯æµ‹è¯•ï¼š</p>
<pre><code class="language-java">@SpringBootApplication
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

    @Bean
    CommandLineRunner commandLineRunner(ApplicationContext ctx) {
        return args -&gt; {
            // å°è¯•è·å–PrototypeBeanAçš„å®ä¾‹
            PrototypeBeanA beanA = ctx.getBean(PrototypeBeanA.class);
        };
    }
}
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240310202703.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¾ªç¯ä¾èµ–" /></p>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½“ Spring åº”ç”¨å¯åŠ¨å¹¶å°è¯•è·å– PrototypeBeanA æˆ– PrototypeBeanB çš„å®ä¾‹æ—¶ï¼Œå°†ä¼šé‡åˆ°é—®é¢˜ã€‚å› ä¸ºå®ƒä»¬äº’ç›¸ä¾èµ–ï¼Œè€Œ Spring æ— æ³•è§£å†³ Prototype ä½œç”¨åŸŸ bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p>
<h4 id="spring-å¯ä»¥è§£å†³å“ªäº›æƒ…å†µçš„å¾ªç¯ä¾èµ–"><a class="header" href="#spring-å¯ä»¥è§£å†³å“ªäº›æƒ…å†µçš„å¾ªç¯ä¾èµ–">Spring å¯ä»¥è§£å†³å“ªäº›æƒ…å†µçš„å¾ªç¯ä¾èµ–ï¼Ÿ</a></h4>
<p>çœ‹çœ‹è¿™å‡ ç§æƒ…å½¢ï¼ˆAB å¾ªç¯ä¾èµ–ï¼‰ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-37bb576d-b4af-42ed-91f4-d846ceb012b6.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¾ªç¯ä¾èµ–çš„å‡ ç§æƒ…å½¢" /></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li>AB å‡é‡‡ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œä¸æ”¯æŒ</li>
<li>AB å‡é‡‡ç”¨ setter æ³¨å…¥ï¼Œæ”¯æŒ</li>
<li>AB å‡é‡‡ç”¨å±æ€§è‡ªåŠ¨æ³¨å…¥ï¼Œæ”¯æŒ</li>
<li>A ä¸­æ³¨å…¥çš„ B ä¸º setter æ³¨å…¥ï¼ŒB ä¸­æ³¨å…¥çš„ A ä¸ºæ„é€ å™¨æ³¨å…¥ï¼Œæ”¯æŒ</li>
<li>B ä¸­æ³¨å…¥çš„ A ä¸º setter æ³¨å…¥ï¼ŒA ä¸­æ³¨å…¥çš„ B ä¸ºæ„é€ å™¨æ³¨å…¥ï¼Œä¸æ”¯æŒ</li>
</ul>
<p>ç¬¬å››ç§å¯ä»¥ï¼Œç¬¬äº”ç§ä¸å¯ä»¥çš„åŸå› æ˜¯ Spring åœ¨åˆ›å»º Bean æ—¶é»˜è®¤ä¼šæ ¹æ®è‡ªç„¶æ’åºè¿›è¡Œåˆ›å»ºï¼Œæ‰€ä»¥ A ä¼šå…ˆäº B è¿›è¡Œåˆ›å»ºã€‚</p>
<p>ç®€å•æ€»ç»“ä¸‹ï¼Œå½“å¾ªç¯ä¾èµ–çš„å®ä¾‹éƒ½é‡‡ç”¨ setter æ–¹æ³•æ³¨å…¥æ—¶ï¼ŒSpring æ”¯æŒï¼Œéƒ½é‡‡ç”¨æ„é€ å™¨æ³¨å…¥çš„æ—¶å€™ï¼Œä¸æ”¯æŒï¼›æ„é€ å™¨æ³¨å…¥å’Œ setter æ³¨å…¥åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œçœ‹å¤©ï¼ˆğŸ˜‚ï¼‰ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="16spring-æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–å‘¢"><a class="header" href="#16spring-æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–å‘¢">16.Spring æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–å‘¢ï¼Ÿ</a></h3>
<p>Spring é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶æ¥è§£å†³å¾ªç¯ä¾èµ–ï¼š</p>
<ol>
<li>ä¸€çº§ç¼“å­˜ï¼šå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„å•ä¾‹ Beanã€‚</li>
<li>äºŒçº§ç¼“å­˜ï¼šå­˜æ”¾æ­£åœ¨åˆ›å»ºä½†æœªå®Œå…¨åˆå§‹åŒ–çš„ Bean å®ä¾‹ã€‚</li>
<li>ä¸‰çº§ç¼“å­˜ï¼šå­˜æ”¾ Bean å·¥å‚å¯¹è±¡ï¼Œç”¨äºæå‰æš´éœ² Beanã€‚</li>
</ol>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-01d92863-a2cb-4f61-8d8d-30ecf0279b28.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸‰çº§ç¼“å­˜" /></p>
<h4 id="ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„"><a class="header" href="#ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„">ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</a></h4>
<ol>
<li>å®ä¾‹åŒ– Bean æ—¶ï¼Œå°†å…¶æ—©æœŸå¼•ç”¨æ”¾å…¥ä¸‰çº§ç¼“å­˜ã€‚</li>
<li>å…¶ä»–ä¾èµ–è¯¥ Bean çš„å¯¹è±¡ï¼Œå¯ä»¥ä»ç¼“å­˜ä¸­è·å–å…¶å¼•ç”¨ã€‚</li>
<li>åˆå§‹åŒ–å®Œæˆåï¼Œå°† Bean ç§»å…¥ä¸€çº§ç¼“å­˜ã€‚</li>
</ol>
<p>å‡å¦‚ Aã€B ä¸¤ä¸ªç±»å‘ç”Ÿå¾ªç¯ä¾èµ–ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-cfc09f84-f8e1-4702-80b6-d115843e81fe.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¾ªç¯ä¾èµ–" /></p>
<p>A å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š</p>
<p>â‘ ã€åˆ›å»º A å®ä¾‹ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™æŠŠ A çš„å¯¹è±¡â¼¯â¼šæ”¾â¼Šä¸‰çº§ç¼“å­˜ï¼Œè¡¨ç¤º A å¼€å§‹å®ä¾‹åŒ–äº†ï¼Œè™½ç„¶è¿™ä¸ªå¯¹è±¡è¿˜ä¸å®Œæ•´ï¼Œä½†æ˜¯å…ˆæ›å…‰å‡ºæ¥è®©å¤§å®¶çŸ¥é“ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-1a8bdc29-ff43-4ff4-9b61-3eedd9da59b3.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šA å¯¹è±¡å·¥å‚" /></p>
<p>â‘¡ã€A æ³¨â¼Šå±æ€§æ—¶ï¼Œå‘ç°ä¾èµ– Bï¼Œæ­¤æ—¶ B è¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ï¼Œæ‰€ä»¥å»å®ä¾‹åŒ– Bã€‚</p>
<p>â‘¢ã€åŒæ ·ï¼ŒB æ³¨â¼Šå±æ€§æ—¶å‘ç°ä¾èµ– Aï¼Œå®ƒå°±ä»ç¼“å­˜é‡Œæ‰¾ A å¯¹è±¡ã€‚ä¾æ¬¡ä»â¼€çº§åˆ°ä¸‰çº§ç¼“å­˜æŸ¥è¯¢ Aã€‚</p>
<p>å‘ç°å¯ä»¥ä»ä¸‰çº§ç¼“å­˜ä¸­é€šè¿‡å¯¹è±¡â¼¯â¼šæ‹¿åˆ° Aï¼Œè™½ç„¶ A ä¸å¤ªå®Œå–„ï¼Œä½†æ˜¯å­˜åœ¨ï¼Œå°±æŠŠ A æ”¾â¼Šâ¼†çº§ç¼“å­˜ï¼ŒåŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„ Aï¼Œæ­¤æ—¶ï¼ŒB å·²ç»å®ä¾‹åŒ–å¹¶ä¸”åˆå§‹åŒ–å®Œæˆäº†ï¼ŒæŠŠ B æ”¾å…¥â¼€çº§ç¼“å­˜ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-bf2507bf-96aa-4b88-a58b-7ec41d11bc70.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ”¾å…¥ä¸€çº§ç¼“å­˜" /></p>
<p>â‘£ã€æ¥ç€ A ç»§ç»­å±æ€§èµ‹å€¼ï¼Œé¡ºåˆ©ä»â¼€çº§ç¼“å­˜æ‹¿åˆ°å®ä¾‹åŒ–ä¸”åˆå§‹åŒ–å®Œæˆçš„ B å¯¹è±¡ï¼ŒA å¯¹è±¡åˆ›å»ºä¹Ÿå®Œæˆï¼Œåˆ é™¤â¼†çº§ç¼“å­˜ä¸­çš„ Aï¼ŒåŒæ—¶æŠŠ A æ”¾â¼Šâ¼€çº§ç¼“å­˜</p>
<p>â‘¤ã€æœ€åï¼Œâ¼€çº§ç¼“å­˜ä¸­ä¿å­˜ç€å®ä¾‹åŒ–ã€åˆå§‹åŒ–éƒ½å®Œæˆçš„ Aã€B å¯¹è±¡ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-022f7cb9-2c83-4fe9-b252-b02bd0fb2435.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAB éƒ½å¥½äº†" /></p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 9 é¢è¯•é¢˜ç›®åŸé¢˜ï¼šSpringæºç çœ‹è¿‡å—ï¼ŸSpringçš„ä¸‰çº§ç¼“å­˜çŸ¥é“å—ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šspringä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</li>
</ol>
</blockquote>
<h3 id="17ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜çº§ä¸å—"><a class="header" href="#17ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜çº§ä¸å—">17.ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼Ÿâ¼†çº§ä¸â¾å—ï¼Ÿ</a></h3>
<p>ä¸è¡Œï¼Œä¸»è¦æ˜¯ä¸ºäº† <strong>â½£æˆä»£ç†å¯¹è±¡</strong>ã€‚å¦‚æœæ˜¯æ²¡æœ‰ä»£ç†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ä¹Ÿæ˜¯ OK çš„ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨ä»£ç†ï¼Œä¸‰çº§æ²¡æœ‰é—®é¢˜ï¼ŒäºŒçº§å°±ä¸è¡Œäº†ã€‚</p>
<p>å› ä¸ºä¸‰çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¯â½£æˆå…·ä½“å¯¹è±¡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œè·å– Object çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥â½£æˆä»£ç†å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¿”å›æ™®é€šå¯¹è±¡ã€‚ä½¿â½¤ä¸‰çº§ç¼“å­˜ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ä½¿â½¤çš„éƒ½æ˜¯â¼€ä¸ªå¯¹è±¡ã€‚</p>
<p>å‡è®¾åªæœ‰â¼†çº§ç¼“å­˜çš„æƒ…å†µï¼Œå¾€â¼†çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¾ç¤ºâ¼€ä¸ªæ™®é€šçš„ Bean å¯¹è±¡ï¼ŒBean åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ BeanPostProcessor å»â½£æˆä»£ç†å¯¹è±¡ä¹‹åï¼Œè¦†ç›–æ‰â¼†çº§ç¼“å­˜ä¸­çš„æ™®é€š Bean å¯¹è±¡ï¼Œé‚£ä¹ˆå¯èƒ½å°±å¯¼è‡´å–åˆ°çš„ Bean å¯¹è±¡ä¸ä¸€è‡´äº†ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-6ece8a46-25b1-459b-8cfa-19fc696dd7d6.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šäºŒçº§ç¼“å­˜ä¸è¡Œçš„åŸå› " /></p>
<h4 id="å¦‚æœç¼ºå°‘ç¬¬äºŒçº§ç¼“å­˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜"><a class="header" href="#å¦‚æœç¼ºå°‘ç¬¬äºŒçº§ç¼“å­˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜">å¦‚æœç¼ºå°‘ç¬¬äºŒçº§ç¼“å­˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</a></h4>
<p>å¦‚æœæ²¡æœ‰äºŒçº§ç¼“å­˜ï¼ŒSpring æ— æ³•åœ¨æœªå®Œæˆåˆå§‹åŒ–çš„æƒ…å†µä¸‹æš´éœ² Beanã€‚ä¼šå¯¼è‡´ä»£ç† Bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå› ä¸ºæŸäº›ä»£ç†é€»è¾‘æ— æ³•åœ¨ä¸‰çº§ç¼“å­˜ä¸­æå‰æš´éœ²ã€‚æœ€ç»ˆå¯èƒ½æŠ›å‡º BeanCurrentlyInCreationExceptionã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šå¾ªç¯ä¾èµ–æœ‰äº†è§£è¿‡å—ï¼Ÿå‡ºç°å¾ªç¯ä¾èµ–çš„åŸå› ï¼Ÿä¸‰å¤§ç¼“å­˜å­˜å‚¨å†…å®¹çš„åŒºåˆ«ï¼Ÿå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿå¦‚æœç¼ºå°‘ç¬¬äºŒçº§ç¼“å­˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="18autowired-çš„å®ç°åŸç†"><a class="header" href="#18autowired-çš„å®ç°åŸç†">18.@Autowired çš„å®ç°åŸç†ï¼Ÿ</a></h3>
<p>å®ç°@Autowired çš„å…³é”®æ˜¯ï¼š<strong>AutowiredAnnotationBeanPostProcessor</strong></p>
<p>åœ¨ Bean çš„åˆå§‹åŒ–é˜¶æ®µï¼Œä¼šé€šè¿‡ Bean åç½®å¤„ç†å™¨æ¥è¿›è¡Œä¸€äº›å‰ç½®å’Œåç½®çš„å¤„ç†ã€‚</p>
<p>å®ç°@Autowired çš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯é€šè¿‡åç½®å¤„ç†å™¨æ¥å®Œæˆçš„ã€‚è¿™ä¸ªåç½®å¤„ç†å™¨å°±æ˜¯ AutowiredAnnotationBeanPostProcessorã€‚</p>
<ul>
<li>
<p>Spring åœ¨åˆ›å»º bean çš„è¿‡ç¨‹ä¸­ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° doCreateBean()æ–¹æ³•ï¼Œåœ¨ doCreateBean()æ–¹æ³•ä¸­ä¼šè°ƒç”¨ populateBean()æ–¹æ³•ï¼Œæ¥ä¸º bean è¿›è¡Œå±æ€§å¡«å……ï¼Œå®Œæˆè‡ªåŠ¨è£…é…ç­‰å·¥ä½œã€‚</p>
</li>
<li>
<p>åœ¨ populateBean()æ–¹æ³•ä¸­ä¸€å…±è°ƒç”¨äº†ä¸¤æ¬¡åç½®å¤„ç†å™¨ï¼Œç¬¬ä¸€æ¬¡æ˜¯ä¸ºäº†åˆ¤æ–­æ˜¯å¦éœ€è¦å±æ€§å¡«å……ï¼Œå¦‚æœä¸éœ€è¦è¿›è¡Œå±æ€§å¡«å……ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿›è¡Œ returnï¼Œå¦‚æœéœ€è¦è¿›è¡Œå±æ€§å¡«å……ï¼Œé‚£ä¹ˆæ–¹æ³•å°±ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œåé¢ä¼šè¿›è¡Œç¬¬äºŒæ¬¡åç½®å¤„ç†å™¨çš„è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨åˆ° AutowiredAnnotationBeanPostProcessor çš„ postProcessPropertyValues()æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å°±ä¼šè¿›è¡Œ@Autowired æ³¨è§£çš„è§£æï¼Œç„¶åå®ç°è‡ªåŠ¨è£…é…ã€‚</p>
</li>
</ul>
<pre><code class="language-java">/**
* å±æ€§èµ‹å€¼
**/
protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {
          //â€¦â€¦â€¦â€¦
          if (hasInstAwareBpps) {
              if (pvs == null) {
                  pvs = mbd.getPropertyValues();
              }

              PropertyValues pvsToUse;
              for(Iterator var9 = this.getBeanPostProcessorCache().instantiationAware.iterator(); var9.hasNext(); pvs = pvsToUse) {
                  InstantiationAwareBeanPostProcessor bp = (InstantiationAwareBeanPostProcessor)var9.next();
                  pvsToUse = bp.postProcessProperties((PropertyValues)pvs, bw.getWrappedInstance(), beanName);
                  if (pvsToUse == null) {
                      if (filteredPds == null) {
                          filteredPds = this.filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);
                      }
                      //æ‰§è¡Œåå¤„ç†å™¨ï¼Œå¡«å……å±æ€§ï¼Œå®Œæˆè‡ªåŠ¨è£…é…
                      //è°ƒç”¨InstantiationAwareBeanPostProcessorçš„postProcessPropertyValues()æ–¹æ³•
                      pvsToUse = bp.postProcessPropertyValues((PropertyValues)pvs, filteredPds, bw.getWrappedInstance(), beanName);
                      if (pvsToUse == null) {
                          return;
                      }
                  }
              }
          }
         //â€¦â€¦â€¦â€¦
  }
</code></pre>
<ul>
<li>postProcessorPropertyValues()æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šå…ˆè°ƒç”¨ findAutowiringMetadata()æ–¹æ³•è§£æå‡º bean ä¸­å¸¦æœ‰@Autowired æ³¨è§£ã€@Inject å’Œ@Value æ³¨è§£çš„å±æ€§å’Œæ–¹æ³•ã€‚ç„¶åè°ƒç”¨ metadata.inject()æ–¹æ³•ï¼Œè¿›è¡Œå±æ€§å¡«å……ã€‚</li>
</ul>
<pre><code class="language-java">  public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) {
      //@Autowiredæ³¨è§£ã€@Injectå’Œ@Valueæ³¨è§£çš„å±æ€§å’Œæ–¹æ³•
      InjectionMetadata metadata = this.findAutowiringMetadata(beanName, bean.getClass(), pvs);

      try {
          //å±æ€§å¡«å……
          metadata.inject(bean, beanName, pvs);
          return pvs;
      } catch (BeanCreationException var6) {
          throw var6;
      } catch (Throwable var7) {
          throw new BeanCreationException(beanName, "Injection of autowired dependencies failed", var7);
      }
  }
</code></pre>
<p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p>
<p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" /></p>
<h2 id="aop"><a class="header" href="#aop">AOP</a></h2>
<h3 id="19è¯´è¯´ä»€ä¹ˆæ˜¯-aop"><a class="header" href="#19è¯´è¯´ä»€ä¹ˆæ˜¯-aop">19.è¯´è¯´ä»€ä¹ˆæ˜¯ AOPï¼Ÿ</a></h3>
<p>AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç®€å•ç‚¹è¯´ï¼ŒAOP å°±æ˜¯æŠŠä¸€äº›ä¸šåŠ¡é€»è¾‘ä¸­çš„ç›¸åŒä»£ç æŠ½å–åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œè®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…çˆ½ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-09dbcda4-7c1b-42d6-8520-1a5fc84abbde.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ¨ªå‘æŠ½å–" /></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦åœ¨ä¸šåŠ¡ä»£ç å¼€å§‹å‰è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œåœ¨ç»“æŸåæ‰“å°æ—¥å¿—ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ<code>æ—¥å¿—è®°å½•</code>å’Œ<code>æ•°æ®æ ¡éªŒ</code>è¿™ä¸¤ä¸ªåŠŸèƒ½æŠ½å–å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªåˆ‡é¢ï¼Œç„¶ååœ¨ä¸šåŠ¡ä»£ç ä¸­å¼•å…¥è¿™ä¸ªåˆ‡é¢ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨é€»è¾‘çš„åˆ†ç¦»ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-4754b4c0-0356-4077-a2f9-55e246cf8ba0.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAOPåº”ç”¨ç¤ºä¾‹" /></p>
<p>ä¸šåŠ¡ä»£ç ä¸å†å…³å¿ƒè¿™äº›é€šç”¨é€»è¾‘ï¼Œåªéœ€è¦å…³å¿ƒè‡ªå·±çš„ä¸šåŠ¡å®ç°ï¼Œè¿™æ ·å°±å®ç°äº†ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨é€»è¾‘çš„åˆ†ç¦»ã€‚</p>
<h4 id="aop-æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µ"><a class="header" href="#aop-æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µ">AOP æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ</a></h4>
<ul>
<li><strong>åˆ‡é¢</strong>ï¼ˆAspectï¼‰ï¼šç±»æ˜¯å¯¹ç‰©ä½“ç‰¹å¾çš„æŠ½è±¡ï¼Œåˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡</li>
<li><strong>è¿æ¥ç‚¹</strong>ï¼ˆJoin Pointï¼‰ï¼šè¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œå› ä¸º Spring åªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ï¼Œæ‰€ä»¥åœ¨ Spring ä¸­ï¼Œè¿æ¥ç‚¹æŒ‡çš„æ˜¯è¢«æ‹¦æˆªåˆ°çš„æ–¹æ³•ï¼Œå®é™…ä¸Šè¿æ¥ç‚¹è¿˜å¯ä»¥æ˜¯å­—æ®µæˆ–è€…æ„é€ æ–¹æ³•</li>
<li><strong>åˆ‡ç‚¹</strong>ï¼ˆPointcutï¼‰ï¼šå¯¹è¿æ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä½</li>
<li><strong>é€šçŸ¥</strong>ï¼ˆAdviceï¼‰ï¼šæŒ‡æ‹¦æˆªåˆ°è¿æ¥ç‚¹ä¹‹åè¦æ‰§è¡Œçš„ä»£ç ï¼Œä¹Ÿå¯ä»¥ç§°ä½œ<strong>å¢å¼º</strong></li>
<li><strong>ç›®æ ‡å¯¹è±¡</strong> ï¼ˆTargetï¼‰ï¼šä»£ç†çš„ç›®æ ‡å¯¹è±¡</li>
<li><strong>å¼•ä»‹</strong>ï¼ˆintroductionï¼‰ï¼šä¸€ç§ç‰¹æ®Šçš„å¢å¼ºï¼Œå¯ä»¥åŠ¨æ€åœ°ä¸ºç±»æ·»åŠ ä¸€äº›å±æ€§å’Œæ–¹æ³•</li>
<li><strong>ç»‡å…¥</strong>ï¼ˆWeabingï¼‰ï¼šç»‡å…¥æ˜¯å°†å¢å¼ºæ·»åŠ åˆ°ç›®æ ‡ç±»çš„å…·ä½“è¿æ¥ç‚¹ä¸Šçš„è¿‡ç¨‹ã€‚</li>
</ul>
<h4 id="ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼"><a class="header" href="#ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼">ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</a></h4>
<p>â‘ ã€ç¼–è¯‘æœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»ç¼–è¯‘æ—¶è¢«ç»‡å…¥ã€‚</p>
<p>â‘¡ã€ç±»åŠ è½½æœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»åŠ è½½åˆ° JVM æ—¶è¢«ç»‡å…¥ã€‚éœ€è¦ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œå®ƒå¯ä»¥åœ¨ç›®æ ‡ç±»è¢«å¼•å…¥åº”ç”¨ä¹‹å‰å¢å¼ºè¯¥ç›®æ ‡ç±»çš„å­—èŠ‚ç ã€‚</p>
<p>â‘¢ã€è¿è¡ŒæœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨åº”ç”¨è¿è¡Œçš„æŸä¸ªæ—¶åˆ»è¢«ç»‡å…¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç»‡å…¥åˆ‡é¢æ—¶ï¼ŒAOP å®¹å™¨ä¼šä¸ºç›®æ ‡å¯¹è±¡åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p>
<p>Spring AOP é‡‡ç”¨è¿è¡ŒæœŸç»‡å…¥ï¼Œè€Œ AspectJ å¯ä»¥åœ¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»åŠ è½½æ—¶ç»‡å…¥ã€‚</p>
<h4 id="aspectj-æ˜¯ä»€ä¹ˆ"><a class="header" href="#aspectj-æ˜¯ä»€ä¹ˆ">AspectJ æ˜¯ä»€ä¹ˆï¼Ÿ</a></h4>
<p>AspectJ æ˜¯ä¸€ä¸ª AOP æ¡†æ¶ï¼Œå®ƒå¯ä»¥åšå¾ˆå¤š Spring AOP å¹²ä¸äº†çš„äº‹æƒ…ï¼Œæ¯”å¦‚è¯´æ”¯æŒç¼–è¯‘æ—¶ã€ç¼–è¯‘åå’Œç±»åŠ è½½æ—¶ç»‡å…¥åˆ‡é¢ã€‚å¹¶ä¸”æä¾›æ›´å¤æ‚çš„åˆ‡ç‚¹è¡¨è¾¾å¼å’Œé€šçŸ¥ç±»å‹ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240806100537.png" alt="AspectJ å®˜ç½‘" /></p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ AspectJ ç¤ºä¾‹ï¼š</p>
<pre><code class="language-java">// å®šä¹‰ä¸€ä¸ªåˆ‡é¢
@Aspect
public class LoggingAspect {

    // å®šä¹‰ä¸€ä¸ªåˆ‡ç‚¹ï¼ŒåŒ¹é… com.example åŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³•
    @Pointcut("execution(* com.example..*(..))")
    private void selectAll() {}

    // å®šä¹‰ä¸€ä¸ªå‰ç½®é€šçŸ¥ï¼Œåœ¨åŒ¹é…çš„æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ
    @Before("selectAll()")
    public void beforeAdvice() {
        System.out.println("A method is about to be executed.");
    }
}
</code></pre>
<h4 id="aop-æœ‰å“ªäº›ç¯ç»•æ–¹å¼"><a class="header" href="#aop-æœ‰å“ªäº›ç¯ç»•æ–¹å¼">AOP æœ‰å“ªäº›ç¯ç»•æ–¹å¼ï¼Ÿ</a></h4>
<p>AOP ä¸€èˆ¬æœ‰ <strong>5 ç§</strong>ç¯ç»•æ–¹å¼ï¼š</p>
<ul>
<li>å‰ç½®é€šçŸ¥ (@Before)</li>
<li>è¿”å›é€šçŸ¥ (@AfterReturning)</li>
<li>å¼‚å¸¸é€šçŸ¥ (@AfterThrowing)</li>
<li>åç½®é€šçŸ¥ (@After)</li>
<li>ç¯ç»•é€šçŸ¥ (@Around)</li>
</ul>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-320fa34f-6620-419c-b17a-4f516a83caeb.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¯ç»•æ–¹å¼" /></p>
<p>å¤šä¸ªåˆ‡é¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ <code>@Order</code> æŒ‡å®šå…ˆåé¡ºåºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Aspect
@Component
public class WebLogAspect {

    private final static Logger logger = LoggerFactory.getLogger(WebLogAspect.class);

    @Pointcut("@annotation(cn.fighter3.spring.aop_demo.WebLog)")
    public void webLog() {}

    @Before("webLog()")
    public void doBefore(JoinPoint joinPoint) throws Throwable {
        // å¼€å§‹æ‰“å°è¯·æ±‚æ—¥å¿—
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes.getRequest();
        // æ‰“å°è¯·æ±‚ç›¸å…³å‚æ•°
        logger.info("========================================== Start ==========================================");
        // æ‰“å°è¯·æ±‚ url
        logger.info("URL            : {}", request.getRequestURL().toString());
        // æ‰“å° Http method
        logger.info("HTTP Method    : {}", request.getMethod());
        // æ‰“å°è°ƒç”¨ controller çš„å…¨è·¯å¾„ä»¥åŠæ‰§è¡Œæ–¹æ³•
        logger.info("Class Method   : {}.{}", joinPoint.getSignature().getDeclaringTypeName(), joinPoint.getSignature().getName());
        // æ‰“å°è¯·æ±‚çš„ IP
        logger.info("IP             : {}", request.getRemoteAddr());
        // æ‰“å°è¯·æ±‚å…¥å‚
        logger.info("Request Args   : {}",new ObjectMapper().writeValueAsString(joinPoint.getArgs()));
    }

    @After("webLog()")
    public void doAfter() throws Throwable {
        // ç»“æŸåæ‰“ä¸ªåˆ†éš”çº¿ï¼Œæ–¹ä¾¿æŸ¥çœ‹
        logger.info("=========================================== End ===========================================");
    }

    @Around("webLog()")
    public Object doAround(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
        //å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        Object result = proceedingJoinPoint.proceed();
        // æ‰“å°å‡ºå‚
        logger.info("Response Args  : {}", new ObjectMapper().writeValueAsString(result));
        // æ‰§è¡Œè€—æ—¶
        logger.info("Time-Consuming : {} ms", System.currentTimeMillis() - startTime);
        return result;
    }
}
</code></pre>
<h4 id="spring-aop-å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™"><a class="header" href="#spring-aop-å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™">Spring AOP å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼Ÿ</a></h4>
<p>Spring AOP åŸºäºè¿è¡Œæ—¶ä»£ç†æœºåˆ¶ï¼Œè¿™æ„å‘³ç€ Spring AOP æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶æˆ–ç±»åŠ è½½æ—¶ç”Ÿæˆçš„ã€‚</p>
<p>åœ¨ Spring å®¹å™¨åˆå§‹åŒ– Bean çš„è¿‡ç¨‹ä¸­ï¼ŒSpring AOP ä¼šæ£€æŸ¥ Bean æ˜¯å¦éœ€è¦åº”ç”¨åˆ‡é¢ã€‚å¦‚æœéœ€è¦ï¼ŒSpring ä¼šä¸ºè¯¥ Bean åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶åœ¨ä»£ç†å¯¹è±¡ä¸­ç»‡å…¥åˆ‡é¢é€»è¾‘ã€‚è¿™ä¸€è¿‡ç¨‹å‘ç”Ÿåœ¨ Spring å®¹å™¨çš„åå¤„ç†å™¨ï¼ˆBeanPostProcessorï¼‰é˜¶æ®µã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240806102547.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šBeanPostProcessor" /></p>
<h4 id="ç®€å•æ€»ç»“ä¸€ä¸‹-aop"><a class="header" href="#ç®€å•æ€»ç»“ä¸€ä¸‹-aop">ç®€å•æ€»ç»“ä¸€ä¸‹ AOP</a></h4>
<p>AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨æé«˜ä»£ç çš„æ¨¡å—åŒ–ã€‚æ¯”å¦‚è¯´å¯ä»¥å°†æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰åˆ†ç¦»å‡ºæ¥ï¼Œæ¥æé«˜ä»£ç çš„å¯é‡ç”¨æ€§ã€‚</p>
<p>AOP çš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬åˆ‡é¢ï¼ˆAspectï¼‰ã€è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰ã€é€šçŸ¥ï¼ˆAdviceï¼‰ã€åˆ‡ç‚¹ï¼ˆPointcutï¼‰å’Œç»‡å…¥ï¼ˆWeavingï¼‰ç­‰ã€‚</p>
<p>â‘  åƒæ—¥å¿—æ‰“å°ã€äº‹åŠ¡ç®¡ç†ç­‰éƒ½å¯ä»¥æŠ½ç¦»ä¸ºåˆ‡é¢ï¼Œå¯ä»¥å£°æ˜åœ¨ç±»çš„æ–¹æ³•ä¸Šã€‚åƒ <code>@Transactional</code> æ³¨è§£ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ AOP åº”ç”¨ï¼Œå®ƒå°±æ˜¯é€šè¿‡ AOP æ¥å®ç°äº‹åŠ¡ç®¡ç†çš„ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ  <code>@Transactional</code> æ³¨è§£ï¼ŒSpring å°±ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ äº‹åŠ¡ç®¡ç†çš„é€»è¾‘ã€‚</p>
<p>â‘¡ Spring AOP æ˜¯åŸºäºä»£ç†çš„ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†æ¥å®ç° AOPã€‚</p>
<p>â‘¢ Spring AOP çš„ç»‡å…¥æ–¹å¼æ˜¯è¿è¡Œæ—¶ç»‡å…¥ï¼Œè€Œ AspectJ æ”¯æŒç¼–è¯‘æ—¶ç»‡å…¥ã€ç±»åŠ è½½æ—¶ç»‡å…¥ã€‚</p>
<h4 id="aopå’Œ-oop-çš„å…³ç³»"><a class="header" href="#aopå’Œ-oop-çš„å…³ç³»">AOPå’Œ OOP çš„å…³ç³»ï¼Ÿ</a></h4>
<p>AOP å’Œ OOP æ˜¯äº’è¡¥çš„ç¼–ç¨‹æ€æƒ³ï¼š</p>
<ol>
<li>OOP é€šè¿‡ç±»å’Œå¯¹è±¡å°è£…æ•°æ®å’Œè¡Œä¸ºï¼Œä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>AOP æä¾›äº†è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰ï¼‰çš„æœºåˆ¶ï¼Œå°†è¿™äº›é€»è¾‘é›†ä¸­ç®¡ç†ã€‚</li>
</ol>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ AOP çš„åŸç†ã€‚</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ä½ å¯¹ AOP å’Œ IoC çš„ç†è§£ã€‚</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Spring AOP çš„å®ç°åŸç†</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šä»‹ç» Spring IoC å’Œ AOP?</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŸé¢˜ï¼šSpringBootæ¡†æ¶çš„AOPã€IOC/DIï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 4 ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring AOPå‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring AOPçš„æ¦‚å¿µäº†è§£å—ï¼ŸAOPå’Œ OOP çš„å…³ç³»ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="20aopçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›"><a class="header" href="#20aopçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›">20.AOPçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</a></h3>
<p>AOP çš„ä½¿ç”¨åœºæ™¯æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚è¯´æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚</p>
<p>æˆ‘ä»¬åœ¨<a href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ä¸»è¦åˆ©ç”¨ AOP æ¥æ‰“å°æ¥å£çš„å…¥å‚å’Œå‡ºå‚æ—¥å¿—ã€æ‰§è¡Œæ—¶é—´ï¼Œæ–¹ä¾¿åæœŸ bug æº¯æºå’Œæ€§èƒ½è°ƒä¼˜ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240310180334.png" alt="æ²‰é»˜ç‹äºŒï¼šæŠ€æœ¯æ´¾æ•™ç¨‹" /></p>
<p>ç¬¬ä¸€æ­¥ï¼Œè‡ªå®šä¹‰æ³¨è§£ä½œä¸ºåˆ‡ç‚¹</p>
<pre><code class="language-java">@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface MdcDot {
    String bizCode() default "";
}
</code></pre>
<p>ç¬¬äºŒæ­¥ï¼Œé…ç½® AOP åˆ‡é¢ï¼š</p>
<ul>
<li><code>@Aspect</code>ï¼šæ ‡è¯†åˆ‡é¢</li>
<li><code>@Pointcut</code>ï¼šè®¾ç½®åˆ‡ç‚¹ï¼Œè¿™é‡Œä»¥è‡ªå®šä¹‰æ³¨è§£ä¸ºåˆ‡ç‚¹</li>
<li><code>@Around</code>ï¼šç¯ç»•åˆ‡ç‚¹ï¼Œæ‰“å°æ–¹æ³•ç­¾åå’Œæ‰§è¡Œæ—¶é—´</li>
</ul>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240310180741.png" alt="æŠ€æœ¯æ´¾é¡¹ç›®ï¼šé…ç½® AOP åˆ‡é¢" /></p>
<p>ç¬¬ä¸‰æ­¥ï¼Œåœ¨ä½¿ç”¨çš„åœ°æ–¹åŠ ä¸Šè‡ªå®šä¹‰æ³¨è§£</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240310181233.png" alt="æŠ€æœ¯æ´¾é¡¹ç›®ï¼šä½¿ç”¨æ³¨è§£" /></p>
<p>ç¬¬å››æ­¥ï¼Œå½“æ¥å£è¢«è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ‰§è¡Œæ—¥å¿—ã€‚</p>
<pre><code>2023-06-16 11:06:13,008 [http-nio-8080-exec-3] INFO |00000000.1686884772947.468581113|101|c.g.p.forum.core.mdc.MdcAspect.handle(MdcAspect.java:47) - æ–¹æ³•æ‰§è¡Œè€—æ—¶: com.github.paicoding.forum.web.front.article.rest.ArticleRestController#recommend = 47
</code></pre>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šAOPåº”ç”¨åœºæ™¯</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŸé¢˜ï¼šAOPçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šé¡¹ç›®ä¸­çš„AOPæ˜¯æ€ä¹ˆç”¨åˆ°çš„</li>
</ol>
</blockquote>
<h3 id="21è¯´è¯´-jdk-åŠ¨æ€ä»£ç†å’Œ-cglib-ä»£ç†"><a class="header" href="#21è¯´è¯´-jdk-åŠ¨æ€ä»£ç†å’Œ-cglib-ä»£ç†">21.è¯´è¯´ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†ï¼Ÿ</a></h3>
<p>AOP æ˜¯é€šè¿‡<a href="https://mp.weixin.qq.com/s/aZtfwik0weJN5JzYc-JxYg">åŠ¨æ€ä»£ç†</a>å®ç°çš„ï¼Œä»£ç†æ–¹å¼æœ‰ä¸¤ç§ï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†ã€‚</p>
<p>â‘ ã€JDK åŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£çš„ä»£ç†ï¼Œåªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ã€‚</p>
<p>ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†æ—¶ï¼ŒSpring AOP ä¼šåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¯¥ä»£ç†å¯¹è±¡å®ç°äº†ç›®æ ‡å¯¹è±¡æ‰€å®ç°çš„æ¥å£ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨å‰åæ’å…¥æ¨ªåˆ‡é€»è¾‘ã€‚</p>
<p>ä¼˜ç‚¹ï¼šåªéœ€ä¾èµ– JDK è‡ªå¸¦çš„ <code>java.lang.reflect.Proxy</code> ç±»ï¼Œä¸éœ€è¦é¢å¤–çš„åº“ï¼›ç¼ºç‚¹ï¼šåªèƒ½ä»£ç†æ¥å£ï¼Œä¸èƒ½ä»£ç†ç±»æœ¬èº«ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="language-java">public interface Service {
    void perform();
}

public class ServiceImpl implements Service {
    public void perform() {
        System.out.println("Performing service...");
    }
}

public class ServiceInvocationHandler implements InvocationHandler {
    private Object target;

    public ServiceInvocationHandler(Object target) {
        this.target = target;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println("Before method");
        Object result = method.invoke(target, args);
        System.out.println("After method");
        return result;
    }
}

public class Main {
    public static void main(String[] args) {
        Service service = new ServiceImpl();
        Service proxy = (Service) Proxy.newProxyInstance(
            service.getClass().getClassLoader(),
            service.getClass().getInterfaces(),
            new ServiceInvocationHandler(service)
        );
        proxy.perform();
    }
}
</code></pre>
<p>â‘¡ã€CGLIB åŠ¨æ€ä»£ç†æ˜¯åŸºäºç»§æ‰¿çš„ä»£ç†ï¼Œå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ã€‚</p>
<p>ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†æ—¶ï¼ŒSpring AOP ä¼šç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨å‰åæ’å…¥æ¨ªåˆ‡é€»è¾‘ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240321105653.png" alt="å›¾ç‰‡æ¥æºäºç½‘ç»œ" /></p>
<p>ä¼˜ç‚¹ï¼šå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ï¼Œçµæ´»æ€§æ›´é«˜ï¼›ç¼ºç‚¹ï¼šéœ€è¦ä¾èµ– CGLIB åº“ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡çš„å¼€é”€ç›¸å¯¹è¾ƒå¤§ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="language-java">public class Service {
    public void perform() {
        System.out.println("Performing service...");
    }
}

public class ServiceInterceptor implements MethodInterceptor {
    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        System.out.println("Before method");
        Object result = proxy.invokeSuper(obj, args);
        System.out.println("After method");
        return result;
    }
}

public class Main {
    public static void main(String[] args) {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(Service.class);
        enhancer.setCallback(new ServiceInterceptor());

        Service proxy = (Service) enhancer.create();
        proxy.perform();
    }
}
</code></pre>
<h4 id="é€‰æ‹©-cglib-è¿˜æ˜¯-jdk-åŠ¨æ€ä»£ç†"><a class="header" href="#é€‰æ‹©-cglib-è¿˜æ˜¯-jdk-åŠ¨æ€ä»£ç†">é€‰æ‹© CGLIB è¿˜æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼Ÿ</a></h4>
<ul>
<li>å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œåˆ™åªèƒ½ä½¿ç”¨ CGLIB ä»£ç†ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé€šå¸¸é¦–é€‰ JDK åŠ¨æ€ä»£ç†ã€‚</li>
<li>è™½ç„¶ CGLIB åœ¨ä»£ç†ç±»çš„ç”Ÿæˆè¿‡ç¨‹ä¸­å¯èƒ½æ¶ˆè€—æ›´å¤šèµ„æºï¼Œä½†åœ¨è¿è¡Œæ—¶å…·æœ‰è¾ƒé«˜çš„æ€§èƒ½ã€‚å¯¹äºæ€§èƒ½æ•æ„Ÿä¸”ä»£ç†å¯¹è±¡åˆ›å»ºé¢‘ç‡ä¸é«˜çš„åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ CGLIBã€‚</li>
<li>JDK åŠ¨æ€ä»£ç†æ˜¯ Java åŸç”Ÿæ”¯æŒçš„ï¼Œä¸éœ€è¦é¢å¤–å¼•å…¥åº“ã€‚è€Œ CGLIB éœ€è¦å°† CGLIB åº“ä½œä¸ºä¾èµ–åŠ å…¥é¡¹ç›®ä¸­ã€‚</li>
</ul>
<h4 id="ä½ ä¼šç”¨-jdk-åŠ¨æ€ä»£ç†å’Œ-cglib-å—"><a class="header" href="#ä½ ä¼šç”¨-jdk-åŠ¨æ€ä»£ç†å’Œ-cglib-å—">ä½ ä¼šç”¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB å—ï¼Ÿ</a></h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå°åœºæ™¯ï¼Œå®¢æœä¸­è½¬ï¼Œè§£å†³ç”¨æˆ·é—®é¢˜ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-c5c4b247-62dd-43a2-a043-da51c58f77c8.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç”¨æˆ·å‘å®¢æœæé—®é¢˜" /></p>
<p>â‘ ã€JDK åŠ¨æ€ä»£ç†å®ç°ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-65b14a3f-2653-463e-af77-a8875d3d635c.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJDKåŠ¨æ€ä»£ç†ç±»å›¾" /></p>
<p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ¥å£</p>
<pre><code class="language-java">public interface ISolver {
    void solve();
}
</code></pre>
<p>ç¬¬äºŒæ­¥ï¼Œå®ç°å¯¹åº”æ¥å£</p>
<pre><code class="language-java">public class Solver implements ISolver {
    @Override
    public void solve() {
        System.out.println("ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦");
    }
}
</code></pre>
<p>ç¬¬ä¸‰æ­¥ï¼ŒåŠ¨æ€ä»£ç†å·¥å‚:ProxyFactoryï¼Œç›´æ¥ç”¨åå°„æ–¹å¼ç”Ÿæˆä¸€ä¸ªç›®æ ‡å¯¹è±¡çš„ä»£ç†ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»æ–¹å¼é‡å†™ InvocationHandler æ–¹æ³•ã€‚</p>
<pre><code class="language-java">public class ProxyFactory {

    // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡
    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    // ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
    public Object getProxyInstance() {
        return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(),
                new InvocationHandler() {
                    @Override
                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                        System.out.println("è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ");

                        // è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•
                        Object returnValue = method.invoke(target, args);

                        System.out.println("é—®é¢˜å·²ç»è§£å†³å•¦ï¼");
                        return null;
                    }
                });
    }
}
</code></pre>
<p>ç¬¬äº”æ­¥ï¼Œå®¢æˆ·ç«¯ï¼šClientï¼Œç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•</p>
<pre><code class="language-java">public class Client {
    public static void main(String[] args) {
        //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜
        ISolver developer = new Solver();
        //ä»£ç†ï¼šå®¢æœå°å§å§
        ISolver csProxy = (ISolver) new ProxyFactory(developer).getProxyInstance();
        //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜
        csProxy.solve();
    }
}
</code></pre>
<p>â‘¡ã€CGLIB åŠ¨æ€ä»£ç†å®ç°ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-74da87af-20d1-4a5b-a212-3837a15f0bab.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šCGLIBåŠ¨æ€ä»£ç†ç±»å›¾" /></p>
<p>ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ç›®æ ‡ç±»ï¼ˆSolverï¼‰ï¼Œç›®æ ‡ç±» Solver å®šä¹‰äº†ä¸€ä¸ª solve æ–¹æ³•ï¼Œæ¨¡æ‹Ÿäº†è§£å†³é—®é¢˜çš„è¡Œä¸ºã€‚ç›®æ ‡ç±»ä¸éœ€è¦å®ç°ä»»ä½•æ¥å£ï¼Œè¿™ä¸ JDK åŠ¨æ€ä»£ç†çš„è¦æ±‚ä¸åŒã€‚</p>
<pre><code class="language-java">public class Solver {

    public void solve() {
        System.out.println("ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦");
    }
}
</code></pre>
<p>ç¬¬äºŒæ­¥ï¼šåŠ¨æ€ä»£ç†å·¥å‚ï¼ˆProxyFactoryï¼‰ï¼ŒProxyFactory ç±»å®ç°äº† MethodInterceptor æ¥å£ï¼Œè¿™æ˜¯ CGLIB æä¾›çš„ä¸€ä¸ªæ–¹æ³•æ‹¦æˆªæ¥å£ï¼Œç”¨äºå®šä¹‰æ–¹æ³•çš„æ‹¦æˆªé€»è¾‘ã€‚</p>
<pre><code class="language-java">public class ProxyFactory implements MethodInterceptor {

    //ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡
    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    //ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
    public Object getProxyInstance() {
        //å·¥å…·ç±»
        Enhancer en = new Enhancer();
        //è®¾ç½®çˆ¶ç±»
        en.setSuperclass(target.getClass());
        //è®¾ç½®å›è°ƒå‡½æ•°
        en.setCallback(this);
        //åˆ›å»ºå­ç±»å¯¹è±¡ä»£ç†
        return en.create();
    }

    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        System.out.println("è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ");
        // æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•
        Object returnValue = method.invoke(target, args);
        System.out.println("é—®é¢˜å·²ç»è§£å†³å•¦ï¼");
        return null;
    }

}
</code></pre>
<ul>
<li>ProxyFactory æ¥æ”¶ä¸€ä¸ª Object ç±»å‹çš„ targetï¼Œå³ç›®æ ‡å¯¹è±¡çš„å®ä¾‹ã€‚</li>
<li>ä½¿ç”¨ CGLIB çš„ Enhancer ç±»æ¥ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼ˆä»£ç†å¯¹è±¡ï¼‰ã€‚é€šè¿‡ setSuperclass è®¾ç½®ä»£ç†å¯¹è±¡çš„çˆ¶ç±»ä¸ºç›®æ ‡å¯¹è±¡çš„ç±»ï¼ŒsetCallback è®¾ç½®æ–¹æ³•æ‹¦æˆªå™¨ä¸ºå½“å‰å¯¹è±¡ï¼ˆthisï¼‰ï¼Œæœ€åè°ƒç”¨ create æ–¹æ³•ç”Ÿæˆå¹¶è¿”å›ä»£ç†å¯¹è±¡ã€‚</li>
<li>é‡å†™ MethodInterceptor æ¥å£çš„ intercept æ–¹æ³•ä»¥æä¾›æ–¹æ³•æ‹¦æˆªé€»è¾‘ã€‚åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ è‡ªå®šä¹‰é€»è¾‘ï¼Œç„¶åé€šè¿‡ method.invoke è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚</li>
</ul>
<p>ç¬¬ä¸‰æ­¥ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ä»£ç†ï¼Œé¦–å…ˆåˆ›å»ºç›®æ ‡å¯¹è±¡ï¼ˆSolver çš„å®ä¾‹ï¼‰ï¼Œç„¶åä½¿ç”¨ ProxyFactory åˆ›å»ºè¯¥ç›®æ ‡å¯¹è±¡çš„ä»£ç†ã€‚é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ solve æ–¹æ³•æ—¶ï¼Œä¼šå…ˆæ‰§è¡Œ intercept æ–¹æ³•ä¸­å®šä¹‰çš„é€»è¾‘ï¼Œç„¶åæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œæœ€åå†æ‰§è¡Œ intercept æ–¹æ³•ä¸­çš„åç»­é€»è¾‘ã€‚</p>
<pre><code class="language-java">public class Client {
    public static void main(String[] args) {
        //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜
        Solver developer = new Solver();
        //ä»£ç†ï¼šå®¢æœå°å§å§
        Solver csProxy = (Solver) new ProxyFactory(developer).getProxyInstance();
        //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜
        csProxy.solve();
    }
}
</code></pre>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¸†è½¯åŒå­¦ 3 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šcglib çš„åŸç†</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring AOP å®ç°åŸç†</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³é¢ç»åŒå­¦ F é¢è¯•åŸé¢˜ï¼šä¸¤ç§åŠ¨æ€ä»£ç†çš„åŒºåˆ«</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 8 Java åç«¯å®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šspringçš„aopæ˜¯å¦‚ä½•å®ç°çš„</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯äº‘æ™ºé¢ç»åŒå­¦ 20 äºŒé¢é¢è¯•åŸé¢˜ï¼šspring aopçš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 3 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šjavaçš„åå°„æœºåˆ¶ï¼Œåå°„çš„åº”ç”¨åœºæ™¯AOPçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œä¸åŠ¨æ€ä»£ç†å’Œåå°„æœ‰ä»€ä¹ˆåŒºåˆ«</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 12 Java æŠ€æœ¯é¢è¯•åŸé¢˜ï¼šä»£ç†ä»‹ç»ä¸€ä¸‹ï¼Œjdkå’Œcglibçš„åŒºåˆ«</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šSpring AOPçš„å®ç°åŸç†ï¼ŸJDKåŠ¨æ€ä»£ç†å’ŒCGLibåŠ¨æ€ä»£ç†çš„å„è‡ªå®ç°åŠå…¶åŒºåˆ«ï¼Ÿç°åœ¨éœ€è¦ç»Ÿè®¡æ–¹æ³•çš„å…·ä½“æ‰§è¡Œæ—¶é—´ï¼Œè¯´ä¸‹å¦‚ä½•ä½¿ç”¨AOPæ¥å®ç°ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŸé¢˜ï¼šäº†è§£AOPåº•å±‚æ˜¯æ€ä¹ˆåšçš„å—ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="22è¯´è¯´-spring-aop-å’Œ-aspectj-aop-åŒºåˆ«"><a class="header" href="#22è¯´è¯´-spring-aop-å’Œ-aspectj-aop-åŒºåˆ«">22.è¯´è¯´ Spring AOP å’Œ AspectJ AOP åŒºåˆ«?</a></h3>
<p>Spring AOP å±äº<code>è¿è¡Œæ—¶å¢å¼º</code>ï¼Œä¸»è¦å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>
<p>åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°ï¼Œé»˜è®¤å¦‚æœä½¿ç”¨æ¥å£çš„ï¼Œç”¨ JDK æä¾›çš„åŠ¨æ€ä»£ç†å®ç°ï¼Œå¦‚æœæ˜¯æ–¹æ³•åˆ™ä½¿ç”¨ CGLIB å®ç°</p>
</li>
<li>
<p>Spring AOP éœ€è¦ä¾èµ– IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ä¸”åªèƒ½ä½œç”¨äº Spring å®¹å™¨ï¼Œä½¿ç”¨çº¯ Java ä»£ç å®ç°</p>
</li>
<li>
<p>åœ¨æ€§èƒ½ä¸Šï¼Œç”±äº Spring AOP æ˜¯åŸºäº<strong>åŠ¨æ€ä»£ç†</strong>æ¥å®ç°çš„ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶éœ€è¦ç”Ÿæˆä»£ç†å®ä¾‹ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¸Šä¹Ÿä¼šå¢åŠ æ ˆçš„æ·±åº¦ï¼Œä½¿å¾— Spring AOP çš„æ€§èƒ½ä¸å¦‚ AspectJ çš„é‚£ä¹ˆå¥½ã€‚</p>
</li>
<li>
<p>Spring AOP è‡´åŠ›äºè§£å†³ä¼ä¸šçº§å¼€å‘ä¸­æœ€æ™®éçš„ AOP(æ–¹æ³•ç»‡å…¥)ã€‚</p>
</li>
</ol>
<p>AspectJ æ˜¯ä¸€ä¸ªæ˜“ç”¨çš„åŠŸèƒ½å¼ºå¤§çš„ AOP æ¡†æ¶ï¼Œå±äº<code>ç¼–è¯‘æ—¶å¢å¼º</code>ï¼Œ å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ•´åˆåˆ°å…¶å®ƒæ¡†æ¶ä¸­ï¼Œæ˜¯ AOP ç¼–ç¨‹çš„å®Œå…¨è§£å†³æ–¹æ¡ˆã€‚AspectJ éœ€è¦ç”¨åˆ°å•ç‹¬çš„ç¼–è¯‘å™¨ ajcã€‚</p>
<p>AspectJ å±äº<strong>é™æ€ç»‡å…¥</strong>ï¼Œé€šè¿‡ä¿®æ”¹ä»£ç æ¥å®ç°ï¼Œåœ¨å®é™…è¿è¡Œä¹‹å‰å°±å®Œæˆäº†ç»‡å…¥ï¼Œæ‰€ä»¥è¯´å®ƒç”Ÿæˆçš„ç±»æ˜¯æ²¡æœ‰é¢å¤–è¿è¡Œæ—¶å¼€é”€çš„ï¼Œä¸€èˆ¬æœ‰å¦‚ä¸‹å‡ ä¸ªç»‡å…¥çš„æ—¶æœºï¼š</p>
<ol>
<li>
<p>ç¼–è¯‘æœŸç»‡å…¥ï¼ˆCompile-time weavingï¼‰ï¼šå¦‚ç±» A ä½¿ç”¨ AspectJ æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œç±» B å¼•ç”¨äº†å®ƒï¼Œè¿™ä¸ªåœºæ™¯å°±éœ€è¦ç¼–è¯‘æœŸçš„æ—¶å€™å°±è¿›è¡Œç»‡å…¥ï¼Œå¦åˆ™æ²¡æ³•ç¼–è¯‘ç±» Bã€‚</p>
</li>
<li>
<p>ç¼–è¯‘åç»‡å…¥ï¼ˆPost-compile weavingï¼‰ï¼šä¹Ÿå°±æ˜¯å·²ç»ç”Ÿæˆäº† .class æ–‡ä»¶ï¼Œæˆ–å·²ç»æ‰“æˆ jar åŒ…äº†ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦å¢å¼ºå¤„ç†çš„è¯ï¼Œå°±è¦ç”¨åˆ°ç¼–è¯‘åç»‡å…¥ã€‚</p>
</li>
<li>
<p>ç±»åŠ è½½åç»‡å…¥ï¼ˆLoad-time weavingï¼‰ï¼šæŒ‡çš„æ˜¯åœ¨åŠ è½½ç±»çš„æ—¶å€™è¿›è¡Œç»‡å…¥ï¼Œè¦å®ç°è¿™ä¸ªæ—¶æœŸçš„ç»‡å…¥ï¼Œæœ‰å‡ ç§å¸¸è§çš„æ–¹æ³•</p>
</li>
</ol>
<p>æ•´ä½“å¯¹æ¯”å¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d1dbe9d9-c55f-4293-8622-d9759064d613.png" alt="Spring AOPå’ŒAspectJå¯¹æ¯”" /></p>
<h3 id="40è¯´è¯´-aop-å’Œåå°„çš„åŒºåˆ«è¡¥å……"><a class="header" href="#40è¯´è¯´-aop-å’Œåå°„çš„åŒºåˆ«è¡¥å……">40.è¯´è¯´ AOP å’Œåå°„çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰</a></h3>
<blockquote>
<p>2024 å¹´ 7 æœˆ 27 æ—¥å¢è¡¥ã€‚</p>
</blockquote>
<ol>
<li>åå°„ï¼šç”¨äºæ£€æŸ¥å’Œæ“ä½œç±»çš„æ–¹æ³•å’Œå­—æ®µï¼ŒåŠ¨æ€è°ƒç”¨æ–¹æ³•æˆ–è®¿é—®å­—æ®µã€‚åå°„æ˜¯ Java æä¾›çš„å†…ç½®æœºåˆ¶ï¼Œç›´æ¥æ“ä½œç±»å¯¹è±¡ã€‚</li>
<li>åŠ¨æ€ä»£ç†ï¼šé€šè¿‡ç”Ÿæˆä»£ç†ç±»æ¥æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œé€šå¸¸ç”¨äº AOP å®ç°ã€‚åŠ¨æ€ä»£ç†ä½¿ç”¨åå°„æ¥è°ƒç”¨è¢«ä»£ç†çš„æ–¹æ³•ã€‚</li>
</ol>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 9 é¢è¯•é¢˜ç›®åŸé¢˜ï¼šæŠ›å¼€Springï¼Œè®²è®²åå°„å’ŒåŠ¨æ€ä»£ç†ï¼Ÿé‚£ä¸‰ç§ä»£ç†æ¨¡å¼æ€ä¹ˆå®ç°çš„ï¼Ÿ</li>
</ol>
</blockquote>
<p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p>
<p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" /></p>
<h2 id="äº‹åŠ¡"><a class="header" href="#äº‹åŠ¡">äº‹åŠ¡</a></h2>
<p>Spring äº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼ŒSpring æ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚Spring åªæä¾›ç»Ÿä¸€äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œå…·ä½“å®ç°éƒ½æ˜¯ç”±å„æ•°æ®åº“è‡ªå·±å®ç°ï¼Œæ•°æ®åº“äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ˜¯é€šè¿‡æ•°æ®åº“è‡ªå·±çš„äº‹åŠ¡æœºåˆ¶å®ç°ã€‚</p>
<h3 id="23spring-äº‹åŠ¡çš„ç§ç±»"><a class="header" href="#23spring-äº‹åŠ¡çš„ç§ç±»">23.Spring äº‹åŠ¡çš„ç§ç±»ï¼Ÿ</a></h3>
<p>åœ¨ Spring ä¸­ï¼Œäº‹åŠ¡ç®¡ç†å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå£°æ˜å¼äº‹åŠ¡ç®¡ç†å’Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d3ee77fa-926d-4c39-91f8-a8b1544a9134.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringäº‹åŠ¡åˆ†ç±»" /></p>
<h4 id="ä»‹ç»ä¸€ä¸‹ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†"><a class="header" href="#ä»‹ç»ä¸€ä¸‹ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†">ä»‹ç»ä¸€ä¸‹ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼Ÿ</a></h4>
<p>ç¼–ç¨‹å¼äº‹åŠ¡å¯ä»¥ä½¿ç”¨ TransactionTemplate å’Œ PlatformTransactionManager æ¥å®ç°ï¼Œéœ€è¦æ˜¾å¼æ‰§è¡Œäº‹åŠ¡ã€‚å…è®¸æˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥æ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œï¼Œé€šè¿‡ç¼–ç¨‹æ–¹å¼æ˜ç¡®æŒ‡å®šäº‹åŠ¡çš„å¼€å§‹ã€æäº¤å’Œå›æ»šã€‚</p>
<pre><code class="language-java">public class AccountService {
    private TransactionTemplate transactionTemplate;

    public void setTransactionTemplate(TransactionTemplate transactionTemplate) {
        this.transactionTemplate = transactionTemplate;
    }

    public void transfer(final String out, final String in, final Double money) {
        transactionTemplate.execute(new TransactionCallbackWithoutResult() {
            @Override
            protected void doInTransactionWithoutResult(TransactionStatus status) {
                // è½¬å‡º
                accountDao.outMoney(out, money);
                // è½¬å…¥
                accountDao.inMoney(in, money);
            }
        });
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† TransactionTemplate æ¥å®ç°ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œé€šè¿‡ execute æ–¹æ³•æ¥æ‰§è¡Œäº‹åŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ–¹æ³•å†…éƒ¨å®ç°äº‹åŠ¡çš„æ§åˆ¶ã€‚</p>
<h4 id="ä»‹ç»ä¸€ä¸‹å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a class="header" href="#ä»‹ç»ä¸€ä¸‹å£°æ˜å¼äº‹åŠ¡ç®¡ç†">ä»‹ç»ä¸€ä¸‹å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Ÿ</a></h4>
<p>å£°æ˜å¼äº‹åŠ¡æ˜¯å»ºç«‹åœ¨ AOP ä¹‹ä¸Šçš„ã€‚å…¶æœ¬è´¨æ˜¯é€šè¿‡ AOP åŠŸèƒ½ï¼Œå¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œå°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•å¼€å§‹ä¹‹å‰å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œä¹‹åæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚</p>
<p>ç›¸æ¯”è¾ƒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¼˜ç‚¹æ˜¯ä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æºæ‚äº‹åŠ¡ç®¡ç†çš„ä»£ç ï¼ŒSpring æ¨èé€šè¿‡ @Transactional æ³¨è§£çš„æ–¹å¼æ¥å®ç°å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œä¹Ÿæ˜¯æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„ã€‚</p>
<p>ä¸è¶³çš„åœ°æ–¹æ˜¯ï¼Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†æœ€ç»†ç²’åº¦åªèƒ½ä½œç”¨åˆ°æ–¹æ³•çº§åˆ«ï¼Œæ— æ³•åƒç¼–ç¨‹å¼äº‹åŠ¡é‚£æ ·å¯ä»¥ä½œç”¨åˆ°ä»£ç å—çº§åˆ«ã€‚</p>
<pre><code class="language-java">@Service
public class AccountService {
    @Autowired
    private AccountDao accountDao;

    @Transactional
    public void transfer(String out, String in, Double money) {
        // è½¬å‡º
        accountDao.outMoney(out, money);
        // è½¬å…¥
        accountDao.inMoney(in, money);
    }
}
</code></pre>
<h4 id="è¯´è¯´ä¸¤è€…çš„åŒºåˆ«"><a class="header" href="#è¯´è¯´ä¸¤è€…çš„åŒºåˆ«">è¯´è¯´ä¸¤è€…çš„åŒºåˆ«ï¼Ÿ</a></h4>
<ul>
<li><strong>ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†</strong>ï¼šéœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼è°ƒç”¨äº‹åŠ¡ç®¡ç†çš„ API æ¥æ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œï¼Œæ¯”è¾ƒçµæ´»ï¼Œä½†æ˜¯ä»£ç ä¾µå…¥æ€§è¾ƒå¼ºï¼Œä¸å¤Ÿä¼˜é›…ã€‚</li>
<li><strong>å£°æ˜å¼äº‹åŠ¡ç®¡ç†</strong>ï¼šè¿™ç§æ–¹å¼ä½¿ç”¨ Spring çš„ AOP æ¥å£°æ˜äº‹åŠ¡ï¼Œå°†äº‹åŠ¡ç®¡ç†ä»£ç ä»ä¸šåŠ¡ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ã€‚ä¼˜ç‚¹æ˜¯ä»£ç ç®€æ´ï¼Œæ˜“äºç»´æŠ¤ã€‚ä½†ç¼ºç‚¹æ˜¯ä¸å¤Ÿçµæ´»ï¼Œåªèƒ½åœ¨é¢„å®šä¹‰çš„æ–¹æ³•ä¸Šä½¿ç”¨äº‹åŠ¡ã€‚</li>
</ul>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šSpring äº‹åŠ¡æ€ä¹ˆå®ç°çš„</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šSpring å¦‚ä½•ä¿è¯äº‹åŠ¡</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 12 Java æŠ€æœ¯é¢è¯•åŸé¢˜ï¼šSpringçš„äº‹åŠ¡ç”¨è¿‡å—ï¼Œåœ¨é¡¹ç›®é‡Œé¢æ€ä¹ˆä½¿ç”¨çš„</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è™¾çš®é¢ç»åŒå­¦ 13 ä¸€é¢é¢è¯•åŸé¢˜ï¼šspringäº‹åŠ¡</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šå¦‚ä½•ä½¿ç”¨springå®ç°äº‹åŠ¡</li>
</ol>
</blockquote>
<h3 id="24è¯´è¯´-spring-çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"><a class="header" href="#24è¯´è¯´-spring-çš„äº‹åŠ¡éš”ç¦»çº§åˆ«">24.è¯´è¯´ Spring çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿ</a></h3>
<p>å¥½ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–å¹¶å‘äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼ŒSpring éƒ½æ”¯æŒï¼Œå¹¶ä¸”æä¾›äº†å¯¹åº”çš„æœºåˆ¶æ¥é…ç½®å®ƒä»¬ï¼Œå®šä¹‰åœ¨ TransactionDefinition æ¥å£ä¸­ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240326082116.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯" /></p>
<p>â‘ ã€ISOLATION_DEFAULTï¼šä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ˆä½ ä»¬çˆ±å’‹å’‹æ»´ ğŸ˜ï¼‰ï¼ŒMySQL é»˜è®¤çš„æ˜¯å¯é‡å¤è¯»ï¼ŒOracle é»˜è®¤çš„è¯»å·²æäº¤ã€‚</p>
<p>â‘¡ã€ISOLATION_READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ï¼Œå…è®¸äº‹åŠ¡è¯»å–æœªè¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ”¹ã€‚è¿™æ˜¯éš”ç¦»çº§åˆ«æœ€ä½çš„è®¾ç½®ï¼Œå¯èƒ½ä¼šå¯¼è‡´â€œè„è¯»â€é—®é¢˜ã€‚</p>
<p>â‘¢ã€ISOLATION_READ_COMMITTEDï¼šè¯»å·²æäº¤ï¼Œç¡®ä¿äº‹åŠ¡åªèƒ½è¯»å–å·²ç»è¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ”¹ã€‚è¿™å¯ä»¥é˜²æ­¢â€œè„è¯»â€ï¼Œä½†ä»ç„¶å¯èƒ½å‘ç”Ÿâ€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€é—®é¢˜ã€‚</p>
<p>â‘£ã€ISOLATION_REPEATABLE_READï¼šå¯é‡å¤è¯»ï¼Œç¡®ä¿äº‹åŠ¡å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªå­—æ®µä¸­è¯»å–ç›¸åŒçš„å€¼ï¼Œå³åœ¨è¿™ä¸ªäº‹åŠ¡å†…ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•æ›´æ”¹è¿™ä¸ªå­—æ®µï¼Œä»è€Œé¿å…äº†â€œä¸å¯é‡å¤è¯»â€ï¼Œä½†ä»å¯èƒ½å‘ç”Ÿâ€œå¹»è¯»â€é—®é¢˜ã€‚</p>
<p>â‘¤ã€ISOLATION_SERIALIZABLEï¼šä¸²è¡ŒåŒ–ï¼Œè¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒå®Œå…¨éš”ç¦»äº†äº‹åŠ¡ï¼Œç¡®ä¿äº‹åŠ¡åºåˆ—åŒ–æ‰§è¡Œï¼Œä»¥æ­¤æ¥é¿å…â€œè„è¯»â€ã€â€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€é—®é¢˜ï¼Œä½†æ€§èƒ½å½±å“ä¹Ÿæœ€å¤§ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šSpring ä¸­çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³é¢ç»åŒå­¦ E ç¬¬äºŒä¸ªéƒ¨é—¨ Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šspring çš„éš”ç¦»æœºåˆ¶ï¼Œé»˜è®¤æ˜¯å“ªä¸€ç§</li>
</ol>
</blockquote>
<h3 id="25spring-çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶"><a class="header" href="#25spring-çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶">25.Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ</a></h3>
<p>äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶å®šä¹‰äº†æ–¹æ³•åœ¨è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶çš„äº‹åŠ¡è¡Œä¸ºï¼Œè¿™äº›è¡Œä¸ºå®šä¹‰äº†äº‹åŠ¡çš„è¾¹ç•Œå’Œäº‹åŠ¡ä¸Šä¸‹æ–‡å¦‚ä½•åœ¨æ–¹æ³•è°ƒç”¨é“¾ä¸­ä¼ æ’­ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a6e2a8dc-9771-4d8b-9d91-76ddee98af1a.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼š6ç§äº‹åŠ¡ä¼ æ’­æœºåˆ¶" /></p>
<p>Spring çš„é»˜è®¤ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAGATION_REQUIREDï¼Œå³å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</p>
<p>äº‹åŠ¡ä¼ æ’­æœºåˆ¶æ˜¯ä½¿ç”¨ <a href="https://javabetter.cn/thread/ThreadLocal.html">ThreadLocal</a> å®ç°çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè°ƒç”¨çš„æ–¹æ³•æ˜¯åœ¨æ–°çº¿ç¨‹ä¸­ï¼Œäº‹åŠ¡ä¼ æ’­ä¼šå¤±æ•ˆã€‚</p>
<pre><code class="language-java">@Transactional
public void parentMethod() {
    new Thread(() -&gt; childMethod()).start();
}

public void childMethod() {
    // è¿™é‡Œçš„æ“ä½œå°†ä¸ä¼šåœ¨ parentMethod çš„äº‹åŠ¡èŒƒå›´å†…æ‰§è¡Œ
}
</code></pre>
<p>Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAFATION_REQUIREDï¼Œå³å¦‚æœå¤šä¸ª <code>ServiceX#methodX()</code> éƒ½å·¥ä½œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ï¼Œä¸”ç¨‹åºä¸­å­˜åœ¨è¿™æ ·çš„è°ƒç”¨é“¾ <code>Service1#method1()-&gt;Service2#method2()-&gt;Service3#method3()</code>ï¼Œé‚£ä¹ˆè¿™ 3 ä¸ªæœåŠ¡ç±»çš„ 3 ä¸ªæ–¹æ³•éƒ½é€šè¿‡ Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶å·¥ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚</p>
<h4 id="protected-å’Œ-private-åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—"><a class="header" href="#protected-å’Œ-private-åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—">protected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—</a></h4>
<p>åœ¨ Spring ä¸­ï¼Œ<strong>åªæœ‰é€šè¿‡ Spring å®¹å™¨çš„ AOP ä»£ç†è°ƒç”¨çš„å…¬å¼€æ–¹æ³•ï¼ˆpublic methodï¼‰ä¸Šçš„<code>@Transactional</code>æ³¨è§£æ‰ä¼šç”Ÿæ•ˆ</strong>ã€‚</p>
<p>å¦‚æœåœ¨ protectedã€private æ–¹æ³•ä¸Šä½¿ç”¨<code>@Transactional</code>ï¼Œè¿™äº›äº‹åŠ¡æ³¨è§£å°†ä¸ä¼šç”Ÿæ•ˆï¼ŒåŸå› ï¼šSpring é»˜è®¤ä½¿ç”¨åŸºäº JDK çš„åŠ¨æ€ä»£ç†ï¼ˆå½“æ¥å£å­˜åœ¨æ—¶ï¼‰æˆ–åŸºäº CGLIB çš„ä»£ç†ï¼ˆå½“åªæœ‰ç±»æ—¶ï¼‰æ¥å®ç°äº‹åŠ¡ã€‚è¿™ä¸¤ç§ä»£ç†æœºåˆ¶éƒ½åªèƒ½ä»£ç†å…¬å¼€çš„æ–¹æ³•ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šäº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šäº‹åŠ¡ä¼ æ’­ï¼Œprotected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—,è¿˜æœ‰é‚£äº›ä¸ç”Ÿæ•ˆçš„æƒ…å†µ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šSpring ä¸­çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„oppo é¢ç»åŒå­¦ 8 åç«¯å¼€å‘ç§‹æ‹›ä¸€é¢é¢è¯•åŸé¢˜ï¼šè®²ä¸€ä¸‹Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šä»‹ç»äº‹åŠ¡ä¼ æ’­æ¨¡å‹</li>
</ol>
</blockquote>
<h3 id="26å£°æ˜å¼äº‹åŠ¡å®ç°åŸç†äº†è§£å—"><a class="header" href="#26å£°æ˜å¼äº‹åŠ¡å®ç°åŸç†äº†è§£å—">26.å£°æ˜å¼äº‹åŠ¡å®ç°åŸç†äº†è§£å—ï¼Ÿ</a></h3>
<p>Spring çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯é€šè¿‡ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰å’Œä»£ç†æœºåˆ¶å®ç°çš„ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œ<strong>åœ¨ Bean åˆå§‹åŒ–é˜¶æ®µåˆ›å»ºä»£ç†å¯¹è±¡</strong>ï¼š</p>
<p>Spring å®¹å™¨åœ¨åˆå§‹åŒ–å•ä¾‹ Bean çš„æ—¶å€™ï¼Œä¼šéå†æ‰€æœ‰çš„ BeanPostProcessor å®ç°ç±»ï¼Œå¹¶æ‰§è¡Œå…¶ postProcessAfterInitialization æ–¹æ³•ã€‚</p>
<p>åœ¨æ‰§è¡Œ postProcessAfterInitialization æ–¹æ³•æ—¶ä¼šéå†å®¹å™¨ä¸­æ‰€æœ‰çš„åˆ‡é¢ï¼ŒæŸ¥æ‰¾ä¸å½“å‰ Bean åŒ¹é…çš„åˆ‡é¢ï¼Œè¿™é‡Œä¼šè·å–äº‹åŠ¡çš„å±æ€§åˆ‡é¢ï¼Œä¹Ÿå°±æ˜¯ <code>@Transactional</code> æ³¨è§£åŠå…¶å±æ€§å€¼ã€‚</p>
<p>ç„¶åæ ¹æ®å¾—åˆ°çš„åˆ‡é¢åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†åˆ›å»ºä»£ç†ï¼Œå¦‚æœç›®æ ‡ç±»æ˜¯æ¥å£ï¼Œåˆ™ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™ä½¿ç”¨ Cglibã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œ<strong>åœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•æ—¶è¿›è¡Œäº‹åŠ¡å¢å¼ºæ“ä½œ</strong>ï¼š</p>
<p>å½“é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ Bean æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„ AOP å¢å¼ºæ‹¦æˆªå™¨ï¼Œå£°æ˜å¼äº‹åŠ¡æ˜¯ä¸€ç§ç¯ç»•å¢å¼ºï¼Œå¯¹åº”æ¥å£ä¸º<code>MethodInterceptor</code>ï¼Œäº‹åŠ¡å¢å¼ºå¯¹è¯¥æ¥å£çš„å®ç°ä¸º<code>TransactionInterceptor</code>ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-97493c7f-c596-4e98-a6a8-dab254d6d1ab.png" alt="å›¾ç‰‡æ¥æºç½‘æ˜“æŠ€æœ¯ä¸“æ " /></p>
<p>äº‹åŠ¡æ‹¦æˆªå™¨<code>TransactionInterceptor</code>åœ¨<code>invoke</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨çˆ¶ç±»<code>TransactionAspectSupport</code>çš„<code>invokeWithinTransaction</code>æ–¹æ³•è¿›è¡Œäº‹åŠ¡å¤„ç†ï¼ŒåŒ…æ‹¬å¼€å¯äº‹åŠ¡ã€äº‹åŠ¡æäº¤ã€å¼‚å¸¸å›æ»šç­‰ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šSpring äº‹åŠ¡æ€ä¹ˆå®ç°çš„</li>
</ol>
</blockquote>
<h3 id="27å£°æ˜å¼äº‹åŠ¡åœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆ"><a class="header" href="#27å£°æ˜å¼äº‹åŠ¡åœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆ">27.å£°æ˜å¼äº‹åŠ¡åœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ</a></h3>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-381e4ec9-a235-4cfa-9b4d-518095a7502a.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå£°æ˜å¼äº‹åŠ¡çš„å‡ ç§å¤±æ•ˆçš„æƒ…å†µ" /></p>
<h4 id="1transactional-åº”ç”¨åœ¨é-public-ä¿®é¥°çš„æ–¹æ³•ä¸Š"><a class="header" href="#1transactional-åº”ç”¨åœ¨é-public-ä¿®é¥°çš„æ–¹æ³•ä¸Š">1ã€@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š</a></h4>
<p>å¦‚æœ Transactional æ³¨è§£åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Šï¼ŒTransactional å°†ä¼šå¤±æ•ˆã€‚</p>
<p>æ˜¯å› ä¸ºåœ¨ Spring AOP ä»£ç†æ—¶ï¼ŒTransactionInterceptor ï¼ˆäº‹åŠ¡æ‹¦æˆªå™¨ï¼‰åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œæ‹¦æˆªï¼ŒDynamicAdvisedInterceptorï¼ˆCglibAopProxy çš„å†…éƒ¨ç±»ï¼‰çš„ intercept æ–¹æ³•æˆ– JdkDynamicAopProxy çš„ invoke æ–¹æ³•ä¼šé—´æ¥è°ƒç”¨ AbstractFallbackTransactionAttributeSource çš„ <strong>computeTransactionAttribute</strong>æ–¹æ³•ï¼Œè·å– Transactional æ³¨è§£çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚</p>
<pre><code class="language-java">protected TransactionAttribute computeTransactionAttribute(Method method,
    Class&lt;?&gt; targetClass) {
        // Don't allow no-public methods as required.
        if (allowPublicMethodsOnly() &amp;&amp; !Modifier.isPublic(method.getModifiers())) {
        return null;
    }
}
</code></pre>
<p>æ­¤æ–¹æ³•ä¼šæ£€æŸ¥ç›®æ ‡æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯å¦ä¸º publicï¼Œä¸æ˜¯ public åˆ™ä¸ä¼šè·å– @Transactional çš„å±æ€§é…ç½®ä¿¡æ¯ã€‚</p>
<h4 id="2transactional-æ³¨è§£å±æ€§-propagation-è®¾ç½®é”™è¯¯"><a class="header" href="#2transactional-æ³¨è§£å±æ€§-propagation-è®¾ç½®é”™è¯¯">2ã€@Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯</a></h4>
<ul>
<li>TransactionDefinition.PROPAGATION_SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼›é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨ä¸šåŠ¡é€»è¾‘å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„æƒ…å†µä¸‹ä½¿ç”¨ SUPPORTSã€‚</li>
<li>TransactionDefinition.PROPAGATION_NOT_SUPPORTEDï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·è¯¥äº‹åŠ¡ã€‚é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨éœ€è¦äº‹åŠ¡æ”¯æŒçš„æ“ä½œä¸­ä½¿ç”¨ NOT_SUPPORTEDã€‚</li>
<li>TransactionDefinition.PROPAGATION_NEVERï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨åº”è¯¥åœ¨äº‹åŠ¡ç¯å¢ƒä¸‹æ‰§è¡Œçš„æ“ä½œä¸­ä½¿ç”¨ NEVERã€‚</li>
</ul>
<h4 id="3transactional-æ³¨è§£å±æ€§-rollbackfor-è®¾ç½®é”™è¯¯"><a class="header" href="#3transactional-æ³¨è§£å±æ€§-rollbackfor-è®¾ç½®é”™è¯¯">3ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯</a></h4>
<p>rollbackFor ç”¨æ¥æŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ã€‚Spring é»˜è®¤æŠ›å‡ºæœªæ£€æŸ¥ unchecked å¼‚å¸¸ï¼ˆç»§æ‰¿è‡ª RuntimeException çš„å¼‚å¸¸ï¼‰æˆ–è€… Error æ‰å›æ»šäº‹åŠ¡ï¼Œå…¶ä»–å¼‚å¸¸ä¸ä¼šè§¦å‘å›æ»šäº‹åŠ¡ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-04053b02-3264-4d7f-b868-560a0333f08d.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringé»˜è®¤æ”¯æŒçš„å¼‚å¸¸å›æ»š" /></p>
<pre><code class="language-java">// å¸Œæœ›è‡ªå®šä¹‰çš„å¼‚å¸¸å¯ä»¥è¿›è¡Œå›æ»š
@Transactional(propagation= Propagation.REQUIRED,rollbackFor= MyException.class)
</code></pre>
<p>è‹¥åœ¨ç›®æ ‡æ–¹æ³•ä¸­æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ rollbackFor æŒ‡å®šçš„å¼‚å¸¸çš„å­ç±»ï¼Œäº‹åŠ¡åŒæ ·ä¼šå›æ»šã€‚</p>
<h4 id="4åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨å¯¼è‡´transactional-å¤±æ•ˆ"><a class="header" href="#4åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨å¯¼è‡´transactional-å¤±æ•ˆ">4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactional å¤±æ•ˆ</a></h4>
<p>å¼€å‘ä¸­é¿å…ä¸äº†ä¼šå¯¹åŒä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç±» Testï¼Œå®ƒçš„ä¸€ä¸ªæ–¹æ³• Aï¼ŒA è°ƒç”¨æœ¬ç±»çš„æ–¹æ³• Bï¼ˆä¸è®ºæ–¹æ³• B æ˜¯ç”¨ public è¿˜æ˜¯ private ä¿®é¥°ï¼‰ï¼Œä½†æ–¹æ³• A æ²¡æœ‰å£°æ˜æ³¨è§£äº‹åŠ¡ï¼Œè€Œ B æ–¹æ³•æœ‰ã€‚</p>
<p>åˆ™å¤–éƒ¨è°ƒç”¨æ–¹æ³• A ä¹‹åï¼Œæ–¹æ³• B çš„äº‹åŠ¡æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ã€‚è¿™ä¹Ÿæ˜¯ç»å¸¸çŠ¯é”™è¯¯çš„ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p>é‚£ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿå…¶å®è¿˜æ˜¯ç”± Spring AOP ä»£ç†é€ æˆçš„ï¼Œå› ä¸ºåªæœ‰äº‹åŠ¡æ–¹æ³•è¢«å½“å‰ç±»ä»¥å¤–çš„ä»£ç è°ƒç”¨æ—¶ï¼Œæ‰ä¼šç”± Spring ç”Ÿæˆçš„ä»£ç†å¯¹è±¡æ¥ç®¡ç†ã€‚</p>
<pre><code class="language-java"> //@Transactional
@GetMapping("/test")
private Integer A() throws Exception {
    CityInfoDict cityInfoDict = new CityInfoDict();
    cityInfoDict.setCityName("2");
    /**
     * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®
     */
    this.insertB();
    /**
     * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®
     */
    int insert = cityInfoDictMapper.insert(cityInfoDict);
    return insert;
}

@Transactional()
public Integer insertB() throws Exception {
    CityInfoDict cityInfoDict = new CityInfoDict();
    cityInfoDict.setCityName("3");
    cityInfoDict.setParentCityId(3);

    return cityInfoDictMapper.insert(cityInfoDict);
}
</code></pre>
<p>è¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„ä¸€ç§@Transactional æ³¨è§£å¤±æ•ˆåœºæ™¯ã€‚</p>
<pre><code class="language-java">@Transactional
private Integer A() throws Exception {
    int insert = 0;
    try {
        CityInfoDict cityInfoDict = new CityInfoDict();
        cityInfoDict.setCityName("2");
        cityInfoDict.setParentCityId(2);
        /**
         * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®
         */
        insert = cityInfoDictMapper.insert(cityInfoDict);
        /**
         * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®
        */
        b.insertB();
    } catch (Exception e) {
        e.printStackTrace();
    }
}
</code></pre>
<p>å¦‚æœ B æ–¹æ³•å†…éƒ¨æŠ›äº†å¼‚å¸¸ï¼Œè€Œ A æ–¹æ³•æ­¤æ—¶ try catch äº† B æ–¹æ³•çš„å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªäº‹åŠ¡å°±ä¸èƒ½æ­£å¸¸å›æ»šäº†ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
<pre><code class="language-java">org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only
</code></pre>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šäº‹åŠ¡ä¼ æ’­ï¼Œprotected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—,è¿˜æœ‰é‚£äº›ä¸ç”Ÿæ•ˆçš„æƒ…å†µ</li>
</ol>
</blockquote>
<p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p>
<p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" /></p>
<h2 id="mvc"><a class="header" href="#mvc">MVC</a></h2>
<h3 id="28spring-mvc-çš„æ ¸å¿ƒç»„ä»¶"><a class="header" href="#28spring-mvc-çš„æ ¸å¿ƒç»„ä»¶">28.Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ</a></h3>
<ol>
<li><strong>DispatcherServlet</strong>ï¼šå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„<strong>æ ¸å¿ƒ</strong>ï¼Œæ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œè¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œç›¸å½“äºæ€»æŒ‡æŒ¥ã€‚</li>
<li><strong>Handler</strong>ï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚</li>
<li><strong>HandlerMapping</strong>ï¼šDispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé€šè¿‡ HandlerMapping å°†ä¸åŒçš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚</li>
<li><strong>HandlerInterceptor</strong>ï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ã€‚</li>
<li><strong>HandlerExecutionChain</strong>ï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šHandler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–è®¾ç½®æ‹¦æˆªï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨ï¼‰ã€‚</li>
<li><strong>HandlerAdapter</strong>ï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° JavaBean ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç”± HandlerApater æ¥å®Œæˆï¼Œå¼€å‘è€…åªéœ€å°†æ³¨æ„åŠ›é›†ä¸­ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸Šï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚</li>
<li><strong>ModelAndView</strong>ï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚</li>
<li><strong>ViewResolver</strong>ï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcheServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£æä¸ºç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>
<h3 id="29spring-mvc-çš„å·¥ä½œæµç¨‹"><a class="header" href="#29spring-mvc-çš„å·¥ä½œæµç¨‹">29.Spring MVC çš„å·¥ä½œæµç¨‹ï¼Ÿ</a></h3>
<p>é¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒDispatcherServlet æ‹¦æˆªå¹¶é€šè¿‡ HandlerMapping æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨ã€‚</p>
<p>DispatcherServlet ä½¿ç”¨ HandlerAdapter è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•ï¼Œæ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ã€‚</p>
<p>ç„¶å DispatcherServlet é€šè¿‡ ViewResolver è§£æè§†å›¾ã€‚</p>
<p>æœ€åï¼ŒDispatcherServlet æ¸²æŸ“è§†å›¾å¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring MVCçš„å·¥ä½œæµç¨‹" /></p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240506102456.png" alt="å›¾ç‰‡æ¥æºäºç½‘ç»œï¼šSpringMVCå·¥ä½œæµç¨‹å›¾" /></p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240506103022.png" alt="_æœªæ¥å¯æœŸï¼šSpringMVCå·¥ä½œæµç¨‹å›¾" /></p>
<p>â‘ ã€<strong>å‘èµ·è¯·æ±‚</strong>ï¼šå®¢æˆ·ç«¯é€šè¿‡ HTTP åè®®å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</p>
<p>â‘¡ã€<strong>å‰ç«¯æ§åˆ¶å™¨</strong>ï¼šè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServletï¼Œå®ƒæ˜¯æ•´ä¸ªæµç¨‹çš„å…¥å£ç‚¹ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶å°†å…¶åˆ†å‘ç»™ç›¸åº”çš„å¤„ç†å™¨ã€‚</p>
<p>â‘¢ã€<strong>å¤„ç†å™¨æ˜ å°„</strong>ï¼šDispatcherServlet è°ƒç”¨ HandlerMapping æ¥ç¡®å®šå“ªä¸ª Controller åº”è¯¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚é€šå¸¸ä¼šæ ¹æ®è¯·æ±‚çš„ URL æ¥ç¡®å®šã€‚</p>
<p>â‘£ã€<strong>å¤„ç†å™¨é€‚é…å™¨</strong>ï¼šä¸€æ—¦æ‰¾åˆ°ç›®æ ‡ Controllerï¼ŒDispatcherServlet ä¼šä½¿ç”¨ HandlerAdapter æ¥è°ƒç”¨ Controller çš„å¤„ç†æ–¹æ³•ã€‚</p>
<p>â‘¤ã€<strong>æ‰§è¡Œå¤„ç†å™¨</strong>ï¼šController å¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œåè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ¨¡å‹æ•°æ®å’Œé€»è¾‘è§†å›¾åã€‚</p>
<p>â‘¥ã€<strong>è§†å›¾è§£æå™¨</strong>ï¼šDispatcherServlet æ¥æ”¶åˆ° ModelAndView åï¼Œä¼šä½¿ç”¨ ViewResolver æ¥è§£æè§†å›¾åç§°ï¼Œæ‰¾åˆ°å…·ä½“çš„è§†å›¾é¡µé¢ã€‚</p>
<p>â‘¦ã€<strong>æ¸²æŸ“è§†å›¾</strong>ï¼šè§†å›¾ä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“é¡µé¢ï¼Œç”Ÿæˆæœ€ç»ˆçš„é¡µé¢å†…å®¹ã€‚</p>
<p>â‘§ã€<strong>å“åº”ç»“æœ</strong>ï¼šDispatcherServlet å°†è§†å›¾ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><strong>Spring MVC</strong> è™½ç„¶æ•´ä½“æµç¨‹å¤æ‚ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­å¾ˆç®€å•ï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶ä¸éœ€è¦æˆ‘ä»¬å¼€å‘äººå‘˜åˆ›å»ºå’Œç®¡ç†ï¼ŒçœŸæ­£éœ€è¦å¤„ç†çš„åªæœ‰ <strong>Controller</strong> ã€<strong>View</strong> ã€<strong>Model</strong>ã€‚</p>
<p>åœ¨å‰åç«¯åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼Œæ­¥éª¤ â‘¥ã€â‘¦ã€â‘§ ä¼šç•¥æœ‰ä¸åŒï¼Œåç«¯é€šå¸¸åªéœ€è¦å¤„ç†æ•°æ®ï¼Œå¹¶å°† JSON æ ¼å¼çš„æ•°æ®è¿”å›ç»™å‰ç«¯å°±å¯ä»¥äº†ï¼Œè€Œä¸æ˜¯è¿”å›å®Œæ•´çš„è§†å›¾é¡µé¢ã€‚</p>
<h4 id="è¿™ä¸ª-handler-æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šä¸ºä»€ä¹ˆè¿˜éœ€è¦-handleradapter"><a class="header" href="#è¿™ä¸ª-handler-æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šä¸ºä»€ä¹ˆè¿˜éœ€è¦-handleradapter">è¿™ä¸ª Handler æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šï¼Ÿä¸ºä»€ä¹ˆè¿˜éœ€è¦ HandlerAdapter</a></h4>
<p>Handler ä¸€èˆ¬å°±æ˜¯æŒ‡ Controllerï¼ŒController æ˜¯ Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”ã€‚</p>
<p>Spring MVC å…è®¸ä½¿ç”¨å¤šç§ç±»å‹çš„å¤„ç†å™¨ã€‚ä¸ä»…ä»…æ˜¯æ ‡å‡†çš„<code>@Controller</code>æ³¨è§£çš„ç±»ï¼Œè¿˜å¯ä»¥æ˜¯å®ç°äº†ç‰¹å®šæ¥å£çš„å…¶ä»–ç±»ï¼ˆå¦‚ HttpRequestHandler æˆ– SimpleControllerHandlerAdapter ç­‰ï¼‰ã€‚è¿™äº›å¤„ç†å™¨å¯èƒ½æœ‰ä¸åŒçš„æ–¹æ³•ç­¾åå’Œäº¤äº’æ–¹å¼ã€‚</p>
<p>HandlerAdapter çš„ä¸»è¦èŒè´£å°±æ˜¯è°ƒç”¨ Handler çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸”é€‚é…ä¸åŒç±»å‹çš„å¤„ç†å™¨ã€‚HandlerAdapter ç¡®ä¿ DispatcherServlet å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼è°ƒç”¨ä¸åŒç±»å‹çš„å¤„ç†å™¨ï¼Œæ— éœ€å…³å¿ƒå…·ä½“çš„æ‰§è¡Œç»†èŠ‚ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´å‰ç«¯å‘èµ·è¯·æ±‚åˆ° SpringMVC çš„æ•´ä¸ªå¤„ç†æµç¨‹ã€‚</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å›½ä¼é¢è¯•åŸé¢˜ï¼šè¯´è¯´ SpringMVC çš„æµç¨‹å§</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åŒå­¦ 5 Java åç«¯é¢è¯•åŸé¢˜ï¼šspringMVC å·¥ä½œæµç¨‹ æˆ‘å¤§æ¦‚å°±æ˜¯æŒ‰é¢æ¸£é€†è¢­é‡Œç­”çš„ï¼Œç­”åˆ°ä¸€åŠæ‰“æ–­æˆ‘ï¼šç„¶åä¼šæœ‰ä¸ª Handlerï¼Œè¿™ä¸ª Handler æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šã€‚å‰é¢ Handler ä¸æ˜¯å·²ç»çŸ¥é“ controller äº†å—ï¼Œæˆ‘ç›´æ¥æ‰§è¡Œä¸å°±è¡Œäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ Adapter å‘¢ã€‚</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 8 é¢è¯•åŸé¢˜ï¼šSpringMVCæ¡†æ¶</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 17 åç«¯æŠ€æœ¯é¢è¯•åŸé¢˜ï¼šspringmvcæ‰§è¡Œæµç¨‹</li>
</ol>
</blockquote>
<h3 id="30springmvc-restful-é£æ ¼çš„æ¥å£çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢"><a class="header" href="#30springmvc-restful-é£æ ¼çš„æ¥å£çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢">30.SpringMVC Restful é£æ ¼çš„æ¥å£çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</a></h3>
<p>PS:è¿™æ˜¯ä¸€é“å…¨æ–°çš„å…«è‚¡ï¼Œæ¯•ç«Ÿ ModelAndView è¿™ç§æ–¹å¼åº”è¯¥æ²¡äººç”¨äº†å§ï¼Ÿç°åœ¨éƒ½æ˜¯å‰åç«¯åˆ†ç¦»æ¥å£ï¼Œå…«è‚¡ä¹Ÿè¯¥æ›´æ–°æ¢ä»£äº†ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ Restful æ¥å£ï¼Œå“åº”æ ¼å¼æ˜¯ jsonï¼Œè¿™å°±ç”¨åˆ°äº†ä¸€ä¸ªå¸¸ç”¨æ³¨è§£ï¼š<strong>@ResponseBody</strong></p>
<pre><code class="language-java">    @GetMapping("/user")
    @ResponseBody
    public User user(){
        return new User(1,"å¼ ä¸‰");
    }
</code></pre>
<p>åŠ å…¥äº†è¿™ä¸ªæ³¨è§£åï¼Œæ•´ä½“çš„æµç¨‹ä¸Šå’Œä½¿ç”¨ ModelAndView å¤§ä½“ä¸Šç›¸åŒï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šæœ‰ä¸€äº›ä¸åŒï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2da963a0-5da9-4b3a-aafd-fd8dbc7e1807.png" alt="Spring MVC Restfulè¯·æ±‚å“åº”ç¤ºæ„å›¾" /></p>
<ol>
<li>
<p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet</p>
</li>
<li>
<p>DispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚åä¼šè°ƒç”¨ HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨ã€‚ç”±æ­¤å¾—çŸ¥ï¼Œè¯¥è¯·æ±‚è¯¥ç”±å“ªä¸ª Controller æ¥å¤„ç†</p>
</li>
<li>
<p>DispatcherServlet è°ƒç”¨ HandlerAdapter å¤„ç†å™¨é€‚é…å™¨ï¼Œå‘Šè¯‰å¤„ç†å™¨é€‚é…å™¨åº”è¯¥è¦å»æ‰§è¡Œå“ªä¸ª Controller</p>
</li>
<li>
<p>Controller è¢«å°è£…æˆäº† ServletInvocableHandlerMethodï¼ŒHandlerAdapter å¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡Œ invokeAndHandle æ–¹æ³•ï¼Œå®Œæˆå¯¹ Controller çš„è¯·æ±‚å¤„ç†</p>
</li>
<li>
<p>HandlerAdapter æ‰§è¡Œå®Œå¯¹ Controller çš„è¯·æ±‚ï¼Œä¼šè°ƒç”¨ HandlerMethodReturnValueHandler å»å¤„ç†è¿”å›å€¼ï¼Œä¸»è¦çš„è¿‡ç¨‹ï¼š</p>
<p>5.1. è°ƒç”¨ RequestResponseBodyMethodProcessorï¼Œåˆ›å»º ServletServerHttpResponseï¼ˆSpring å¯¹åŸç”Ÿ ServerHttpResponse çš„å°è£…ï¼‰å®ä¾‹</p>
<p>5.2.ä½¿ç”¨ HttpMessageConverter çš„ write æ–¹æ³•ï¼Œå°†è¿”å›å€¼å†™å…¥ ServletServerHttpResponse çš„ OutputStream è¾“å‡ºæµä¸­</p>
<p>5.3.åœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ JsonGeneratorï¼ˆé»˜è®¤ä½¿ç”¨ Jackson æ¡†æ¶ï¼‰å¯¹è¿”å›å€¼è¿›è¡Œ Json åºåˆ—åŒ–</p>
</li>
<li>
<p>æ‰§è¡Œå®Œè¯·æ±‚åï¼Œè¿”å›çš„ ModealAndView ä¸º nullï¼ŒServletServerHttpResponse é‡Œä¹Ÿå·²ç»å†™å…¥äº†å“åº”ï¼Œæ‰€ä»¥ä¸ç”¨å…³å¿ƒ View çš„å¤„ç†</p>
</li>
</ol>
<p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p>
<p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" /></p>
<h2 id="spring-boot"><a class="header" href="#spring-boot">Spring Boot</a></h2>
<h3 id="31ä»‹ç»ä¸€ä¸‹-springbootæœ‰å“ªäº›ä¼˜ç‚¹"><a class="header" href="#31ä»‹ç»ä¸€ä¸‹-springbootæœ‰å“ªäº›ä¼˜ç‚¹">31.ä»‹ç»ä¸€ä¸‹ SpringBootï¼Œæœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</a></h3>
<p>Spring Boot æä¾›äº†ä¸€å¥—é»˜è®¤é…ç½®ï¼Œå®ƒé€šè¿‡çº¦å®šå¤§äºé…ç½®çš„ç†å¿µï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»º Spring é¡¹ç›®éª¨æ¶ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d9164ee6-5c86-4313-8fd9-efb9acfa5f0b.png" alt="SpringBootå›¾æ ‡" /></p>
<p>ä»¥å‰çš„ Spring å¼€å‘éœ€è¦é…ç½®å¤§é‡çš„ xml æ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦å¼•å…¥å¤§é‡çš„ç¬¬ä¸‰æ–¹ jar åŒ…ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨æ”¾åˆ° classpath ä¸‹ã€‚ç°åœ¨åªéœ€è¦å¼•å…¥ä¸€ä¸ª Starterï¼Œæˆ–è€…ä¸€ä¸ªæ³¨è§£ï¼Œå°±å¯ä»¥è½»æ¾æå®šã€‚</p>
<p>Spring Boot çš„ä¼˜ç‚¹éå¸¸å¤šï¼Œæ¯”å¦‚è¯´ï¼š</p>
<ol>
<li>Spring Boot å†…åµŒäº† Tomcatã€Jettyã€Undertow ç­‰å®¹å™¨ï¼Œç›´æ¥è¿è¡Œ jar åŒ…å°±å¯ä»¥å¯åŠ¨é¡¹ç›®ã€‚</li>
<li>Spring Boot å†…ç½®äº† Starter å’Œè‡ªåŠ¨è£…é…ï¼Œé¿å…ç¹ççš„æ‰‹åŠ¨é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®ä¸­æ·»åŠ äº† spring-boot-starter-webï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcat å’Œ Spring MVCã€‚</li>
<li>Spring Boot å†…ç½®äº† Actuator å’Œ DevToolsï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§ã€‚</li>
</ol>
<h4 id="spring-bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›"><a class="header" href="#spring-bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›">Spring Bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ</a></h4>
<ol>
<li><strong>@SpringBootApplication</strong>ï¼šSpring Boot åº”ç”¨çš„å…¥å£ï¼Œç”¨åœ¨å¯åŠ¨ç±»ä¸Šã€‚</li>
<li>è¿˜æœ‰ä¸€äº› Spring æ¡†æ¶æœ¬èº«çš„æ³¨è§£ï¼Œæ¯”å¦‚ <strong>@Component</strong>ã€<strong>@RestController</strong>ã€<strong>@Service</strong>ã€<strong>@ConfigurationProperties</strong>ã€<strong>@Transactional</strong> ç­‰ã€‚</li>
</ol>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸º OD é¢ç»ä¸­å‡ºç°è¿‡è¯¥é¢˜ï¼šè®²è®² Spring Boot çš„ç‰¹æ€§ã€‚</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringBootåŸºæœ¬åŸç†</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å›½ä¼é›¶ç¢é¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šSpringbootåŸºäºSpringçš„é…ç½®æœ‰å“ªå‡ ç§</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šspringbootå¸¸ç”¨æ³¨è§£</li>
</ol>
</blockquote>
<h3 id="32springboot-è‡ªåŠ¨é…ç½®åŸç†äº†è§£å—"><a class="header" href="#32springboot-è‡ªåŠ¨é…ç½®åŸç†äº†è§£å—">32.SpringBoot è‡ªåŠ¨é…ç½®åŸç†äº†è§£å—ï¼Ÿ</a></h3>
<p>åœ¨ Spring ä¸­ï¼Œè‡ªåŠ¨è£…é…æ˜¯æŒ‡å®¹å™¨åˆ©ç”¨åå°„æŠ€æœ¯ï¼Œæ ¹æ® Bean çš„ç±»å‹ã€åç§°ç­‰è‡ªåŠ¨æ³¨å…¥æ‰€éœ€çš„ä¾èµ–ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringBootè‡ªåŠ¨é…ç½®åŸç†" /></p>
<p>åœ¨ Spring Boot ä¸­ï¼Œå¼€å¯è‡ªåŠ¨è£…é…çš„æ³¨è§£æ˜¯<code>@EnableAutoConfiguration</code>ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240316121711.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼š@EnableAutoConfiguration æºç " /></p>
<p>Spring Boot ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ï¼Œç›´æ¥é€šè¿‡ <code>@SpringBootApplication</code> æ³¨è§£ä¸€æ­¥æå®šï¼Œè¯¥æ³¨è§£åŒ…å«äº† <code>@EnableAutoConfiguration</code> æ³¨è§£ã€‚</p>
<p>main ç±»å¯åŠ¨çš„æ—¶å€™ï¼ŒSpring Boot ä¼šé€šè¿‡åº•å±‚çš„<code>AutoConfigurationImportSelector</code> ç±»åŠ è½½è‡ªåŠ¨è£…é…ç±»ã€‚</p>
<pre><code class="language-java">@AutoConfigurationPackage //å°†mainåŒçº§çš„åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­
@Import({AutoConfigurationImportSelector.class}) //åŠ è½½è‡ªåŠ¨è£…é…ç±» xxxAutoconfiguration
public @interface EnableAutoConfiguration {
    String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration";

    Class&lt;?&gt;[] exclude() default {};

    String[] excludeName() default {};
}
</code></pre>
<p><code>AutoConfigurationImportSelector</code>å®ç°äº†<code>ImportSelector</code>æ¥å£ï¼Œè¯¥æ¥å£çš„ä½œç”¨æ˜¯æ”¶é›†éœ€è¦å¯¼å…¥çš„é…ç½®ç±»ï¼Œé…åˆ <code>@Import()</code> å°†ç›¸åº”çš„ç±»å¯¼å…¥åˆ° Spring å®¹å™¨ä¸­ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240316122134.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šAutoConfigurationImportSelectoræºç " /></p>
<p>è·å–æ³¨å…¥ç±»çš„æ–¹æ³•æ˜¯ <code>selectImports()</code>ï¼Œå®ƒå®é™…è°ƒç”¨çš„æ˜¯<code>getAutoConfigurationEntry()</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è·å–è‡ªåŠ¨è£…é…ç±»çš„å…³é”®ã€‚</p>
<pre><code class="language-java">protected AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) {
    // æ£€æŸ¥è‡ªåŠ¨é…ç½®æ˜¯å¦å¯ç”¨ã€‚å¦‚æœ@ConditionalOnClassç­‰æ¡ä»¶æ³¨è§£ä½¿å¾—è‡ªåŠ¨é…ç½®ä¸é€‚ç”¨äºå½“å‰ç¯å¢ƒï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„é…ç½®æ¡ç›®ã€‚
    if (!isEnabled(annotationMetadata)) {
        return EMPTY_ENTRY;
    }

    // è·å–å¯åŠ¨ç±»ä¸Šçš„@EnableAutoConfigurationæ³¨è§£çš„å±æ€§ï¼Œè¿™å¯èƒ½åŒ…æ‹¬å¯¹ç‰¹å®šè‡ªåŠ¨é…ç½®ç±»çš„æ’é™¤ã€‚
    AnnotationAttributes attributes = getAttributes(annotationMetadata);

    // ä»spring.factoriesä¸­è·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚è¿™æ˜¯é€šè¿‡åŠ è½½META-INF/spring.factoriesæ–‡ä»¶ä¸­å¯¹åº”çš„æ¡ç›®æ¥å®ç°çš„ã€‚
    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);

    // ç§»é™¤é…ç½®åˆ—è¡¨ä¸­çš„é‡å¤é¡¹ï¼Œç¡®ä¿æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»åªè¢«è€ƒè™‘ä¸€æ¬¡ã€‚
    configurations = removeDuplicates(configurations);

    // æ ¹æ®æ³¨è§£å±æ€§è§£æå‡ºéœ€è¦æ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»ã€‚
    Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);

    // æ£€æŸ¥æ’é™¤çš„ç±»æ˜¯å¦å­˜åœ¨äºå€™é€‰é…ç½®ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
    checkExcludedClasses(configurations, exclusions);

    // ä»å€™é€‰é…ç½®ä¸­ç§»é™¤æ’é™¤çš„ç±»ã€‚
    configurations.removeAll(exclusions);

    // åº”ç”¨è¿‡æ»¤å™¨è¿›ä¸€æ­¥ç­›é€‰è‡ªåŠ¨é…ç½®ç±»ã€‚è¿‡æ»¤å™¨å¯èƒ½åŸºäºæ¡ä»¶æ³¨è§£å¦‚@ConditionalOnBeanç­‰æ¥æ’é™¤ç‰¹å®šçš„é…ç½®ç±»ã€‚
    configurations = getConfigurationClassFilter().filter(configurations);

    // è§¦å‘è‡ªåŠ¨é…ç½®å¯¼å…¥äº‹ä»¶ï¼Œå…è®¸ç›‘å¬å™¨å¯¹è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¿›è¡Œå¹²é¢„ã€‚
    fireAutoConfigurationImportEvents(configurations, exclusions);

    // åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æœ€ç»ˆç¡®å®šçš„è‡ªåŠ¨é…ç½®ç±»å’Œæ’é™¤çš„é…ç½®ç±»çš„AutoConfigurationEntryå¯¹è±¡ã€‚
    return new AutoConfigurationEntry(configurations, exclusions);
}
</code></pre>
<p>æ€»ç»“ï¼šSpring Boot çš„è‡ªåŠ¨è£…é…åŸç†ä¾èµ–äº Spring æ¡†æ¶çš„ä¾èµ–æ³¨å…¥å’Œæ¡ä»¶æ³¨å†Œï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼ŒSpring Boot èƒ½å¤Ÿæ™ºèƒ½åœ°é…ç½® beanï¼Œå¹¶ä¸”åªæœ‰å½“è¿™äº› bean å®é™…éœ€è¦æ—¶æ‰ä¼šè¢«åˆ›å»ºå’Œé…ç½®ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šSpringBoot å¯åŠ¨æ—¶ä¸ºä»€ä¹ˆèƒ½å¤Ÿè‡ªåŠ¨è£…é…</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring Boot å¦‚ä½•åšåˆ°å¯åŠ¨çš„æ—¶å€™æ³¨å…¥ä¸€äº› bean</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 3 Java æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡ŒåŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šspring boot çš„è‡ªåŠ¨è£…é…</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringBootå¦‚ä½•å®ç°è‡ªåŠ¨è£…é…</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ OPPO é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šè‡ªåŠ¨é…ç½®æ€ä¹ˆå®ç°çš„ï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="33å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª-springboot-srarter"><a class="header" href="#33å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª-springboot-srarter">33.å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª SpringBoot Srarter?</a></h3>
<p>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Spring Boot Starterï¼Œéœ€è¦è¿™å‡ æ­¥ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Maven é¡¹ç›®ï¼Œä¾‹å¦‚å‘½åä¸º my-spring-boot-starterã€‚åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–å’Œé…ç½®ï¼š</p>
<pre><code class="language-xml">&lt;properties&gt;
    &lt;spring.boot.version&gt;2.3.1.RELEASE&lt;/spring.boot.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;
        &lt;version&gt;${spring.boot.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;version&gt;${spring.boot.version}&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p>ç¬¬äºŒæ­¥ï¼Œåœ¨ <code>src/main/java</code> ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯”å¦‚ MyServiceAutoConfiguration.javaï¼šï¼ˆé€šå¸¸æ˜¯ autoconfigure åŒ…ä¸‹ï¼‰ã€‚</p>
<pre><code class="language-java">@Configuration
@EnableConfigurationProperties(MyStarterProperties.class)
public class MyServiceAutoConfiguration {

    @Bean
    @ConditionalOnMissingBean
    public MyService myService(MyStarterProperties properties) {
        return new MyService(properties.getMessage());
    }
}
</code></pre>
<p>ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªé…ç½®å±æ€§ç±» MyStarterProperties.javaï¼š</p>
<pre><code class="language-java">@ConfigurationProperties(prefix = "mystarter")
public class MyStarterProperties {
    private String message = "äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ä¸é”™å•Š!";

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}
</code></pre>
<p>ç¬¬å››æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ç±» MyService.javaï¼š</p>
<pre><code class="language-java">public class MyService {
    private final String message;

    public MyService(String message) {
        this.message = message;
    }

    public String getMessage() {
        return message;
    }
}
</code></pre>
<p>ç¬¬äº”æ­¥ï¼Œé…ç½® spring.factoriesï¼Œåœ¨ <code>src/main/resources/META-INF</code> ç›®å½•ä¸‹åˆ›å»º spring.factories æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ï¼š</p>
<pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.itwanger.mystarter.autoconfigure.MyServiceAutoConfiguration
</code></pre>
<p>ç¬¬å…­æ­¥ï¼Œä½¿ç”¨ Maven æ‰“åŒ…è¿™ä¸ªé¡¹ç›®ï¼š</p>
<pre><code class="language-shell">mvn clean install
</code></pre>
<p>ç¬¬ä¸ƒæ­¥ï¼Œåœ¨å…¶ä»–çš„ Spring Boot é¡¹ç›®ä¸­ï¼Œé€šè¿‡ Maven æ¥æ·»åŠ è¿™ä¸ªè‡ªå®šä¹‰çš„ Starter ä¾èµ–ï¼Œå¹¶é€šè¿‡ application.properties é…ç½®æ¬¢è¿æ¶ˆæ¯ï¼š</p>
<pre><code class="language-xml">mystarter.message=javabetter.cn
</code></pre>
<p>ç„¶åå°±å¯ä»¥åœ¨ Spring Boot é¡¹ç›®ä¸­æ³¨å…¥ MyStarterProperties æ¥ä½¿ç”¨å®ƒã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240409114642.png" alt="" /></p>
<p>å¯åŠ¨é¡¹ç›®ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <code>localhost:8081/hello</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°æ¬¢è¿æ¶ˆæ¯äº†ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240409114610.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯" /></p>
<h4 id="spring-boot-starter-çš„åŸç†äº†è§£å—"><a class="header" href="#spring-boot-starter-çš„åŸç†äº†è§£å—">Spring Boot Starter çš„åŸç†äº†è§£å—ï¼Ÿ</a></h4>
<p>Spring Boot Starter ä¸»è¦é€šè¿‡èµ·æ­¥ä¾èµ–å’Œè‡ªåŠ¨é…ç½®æœºåˆ¶æ¥ç®€åŒ–é¡¹ç›®çš„æ„å»ºå’Œé…ç½®è¿‡ç¨‹ã€‚</p>
<p>èµ·æ­¥ä¾èµ–æ˜¯ Spring Boot æä¾›çš„ä¸€ç»„é¢„å®šä¹‰ä¾èµ–é¡¹ï¼Œå®ƒä»¬å°†ä¸€ç»„ç›¸å…³çš„åº“å’Œæ¨¡å—æ‰“åŒ…åœ¨ä¸€èµ·ã€‚æ¯”å¦‚ <code>spring-boot-starter-web</code> å°±åŒ…å«äº† Spring MVCã€Tomcat å’Œ Jackson ç­‰ä¾èµ–ã€‚</p>
<p>è‡ªåŠ¨é…ç½®æœºåˆ¶æ˜¯ Spring Boot çš„æ ¸å¿ƒç‰¹æ€§ï¼Œé€šè¿‡è‡ªåŠ¨æ‰«æç±»è·¯å¾„ä¸‹çš„ç±»ã€èµ„æºæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºå’Œé…ç½®åº”ç”¨ç¨‹åºæ‰€éœ€çš„ Bean å’Œç»„ä»¶ã€‚</p>
<p>æ¯”å¦‚æœ‰äº† <code>spring-boot-starter-web</code>ï¼Œæˆ‘ä»¬å¼€å‘è€…å°±ä¸éœ€è¦å†æ‰‹åŠ¨é…ç½® Tomcatã€Spring MVC ç­‰ï¼ŒSpring Boot ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆè¿™äº›å·¥ä½œã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ å°è£…è¿‡ springboot starter å—ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯äº‘æ™ºé¢ç»åŒå­¦ 20 äºŒé¢é¢è¯•åŸé¢˜ï¼šSpring Boot Starter çš„åŸç†äº†è§£å—ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šä¸ºä»€ä¹ˆä½¿ç”¨SpringBootï¼ŸSpringBootè‡ªåŠ¨è£…é…çš„åŸç†åŠæµç¨‹ï¼Ÿ@Importçš„ä½œç”¨ï¼Ÿå¦‚æœæƒ³è®©SpringBootå¯¹è‡ªå®šä¹‰çš„jaråŒ…è¿›è¡Œè‡ªåŠ¨é…ç½®çš„è¯ï¼Œéœ€è¦æ€ä¹ˆåšï¼Ÿ</li>
</ol>
</blockquote>
<h3 id="34spring-boot-å¯åŠ¨åŸç†äº†è§£å—"><a class="header" href="#34spring-boot-å¯åŠ¨åŸç†äº†è§£å—">34.Spring Boot å¯åŠ¨åŸç†äº†è§£å—ï¼Ÿ</a></h3>
<p>Spring Boot çš„å¯åŠ¨ç”± SpringApplication ç±»è´Ÿè´£ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»º SpringApplication å®ä¾‹ï¼Œè´Ÿè´£åº”ç”¨çš„å¯åŠ¨å’Œåˆå§‹åŒ–ï¼›</li>
<li>ç¬¬äºŒæ­¥ï¼Œä» application.yml ä¸­åŠ è½½é…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡ï¼›</li>
<li>ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä¸Šä¸‹æ–‡ç¯å¢ƒ ApplicationContextï¼Œå¹¶åŠ è½½ Beanï¼Œå®Œæˆä¾èµ–æ³¨å…¥ï¼›</li>
<li>ç¬¬å››æ­¥ï¼Œå¯åŠ¨å†…åµŒçš„ Web å®¹å™¨ã€‚</li>
<li>ç¬¬äº”æ­¥ï¼Œå‘å¸ƒå¯åŠ¨å®Œæˆäº‹ä»¶ ApplicationReadyEventï¼Œå¹¶è°ƒç”¨ ApplicationRunner çš„ run æ–¹æ³•å®Œæˆå¯åŠ¨åçš„é€»è¾‘ã€‚</li>
</ul>
<p>å…³é”®çš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public ConfigurableApplicationContext run(String... args) {
    // 1. åˆ›å»ºå¯åŠ¨æ—¶çš„ç›‘å¬å™¨å¹¶è§¦å‘å¯åŠ¨äº‹ä»¶
    SpringApplicationRunListeners listeners = getRunListeners(args);
    listeners.starting();

    // 2. å‡†å¤‡è¿è¡Œç¯å¢ƒ
    ConfigurableEnvironment environment = prepareEnvironment(listeners);
    configureIgnoreBeanInfo(environment);

    // 3. åˆ›å»ºä¸Šä¸‹æ–‡
    ConfigurableApplicationContext context = createApplicationContext();

    try {
        // 4. å‡†å¤‡ä¸Šä¸‹æ–‡
        prepareContext(context, environment, listeners, args);

        // 5. åˆ·æ–°ä¸Šä¸‹æ–‡ï¼Œå®Œæˆ Bean åˆå§‹åŒ–å’Œè£…é…
        refreshContext(context);

        // 6. è°ƒç”¨è¿è¡Œå™¨
        afterRefresh(context, args);

        // 7. è§¦å‘å¯åŠ¨å®Œæˆäº‹ä»¶
        listeners.started(context);
    } catch (Exception ex) {
        handleRunFailure(context, ex, listeners);
    }

    return context;
}
</code></pre>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-68744556-a1ba-4e1f-a092-1582875f0da6.png" alt="SpringBoot å¯åŠ¨å¤§è‡´æµç¨‹-å›¾ç‰‡æ¥æºç½‘ç»œ" /></p>
<p>ä»¥<a href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸ºä¾‹ã€‚åœ¨å¯åŠ¨ç±» QuickForumApplication ä¸­ï¼Œmain æ–¹æ³•ä¼šè°ƒç”¨ <code>SpringApplication.run()</code> å¯åŠ¨é¡¹ç›®ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240422090338.png" alt="æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®æºç ï¼šå¯åŠ¨ç±»" /></p>
<p>è¯¥æ–¹æ³•è´Ÿè´£ Spring åº”ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆApplicationContextï¼‰å‡†å¤‡ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>æ‰«æé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¾èµ–é¡¹</li>
<li>åˆå§‹åŒ–å’ŒåŠ è½½ Bean å®šä¹‰</li>
<li>å¯åŠ¨å†…åµŒçš„ Web å®¹å™¨ç­‰</li>
<li>å‘å¸ƒå¯åŠ¨å®Œæˆäº‹ä»¶</li>
</ul>
<h4 id="äº†è§£springbootapplication-æ³¨è§£å—"><a class="header" href="#äº†è§£springbootapplication-æ³¨è§£å—">äº†è§£@SpringBootApplication æ³¨è§£å—ï¼Ÿ</a></h4>
<p><code>@SpringBootApplication</code>æ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ï¼Œç»å¸¸ç”¨äºä¸»ç±»ä¸Šï¼Œä½œä¸ºé¡¹ç›®å¯åŠ¨å…¥å£çš„æ ‡è¯†ã€‚å®ƒæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼š</p>
<ul>
<li><code>@SpringBootConfiguration</code>ï¼šç»§æ‰¿è‡ª <code>@Configuration</code>ï¼Œæ ‡æ³¨è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç›¸å½“äºä¸€ä¸ª Spring é…ç½®æ–‡ä»¶ã€‚</li>
<li><code>@EnableAutoConfiguration</code>ï¼šå‘Šè¯‰ Spring Boot æ ¹æ® pom.xml ä¸­æ·»åŠ çš„ä¾èµ–è‡ªåŠ¨é…ç½®é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ spring-boot-starter-web ä¾èµ–è¢«æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcat å’Œ Spring MVCã€‚</li>
<li><code>@ComponentScan</code>ï¼šæ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹è¢«<code>@Component</code>ã€<code>@Service</code>ã€<code>@Controller</code>ã€<code>@Repository</code> æ³¨è§£æ ‡è®°çš„ç±»ï¼Œå¹¶æ³¨å†Œä¸º Spring Beanã€‚</li>
</ul>
<pre><code class="language-java">@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>
<h4 id="ä¸ºä»€ä¹ˆ-spring-boot-åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ°-main-æ–¹æ³•ä¸Šçš„springbootapplication-æ³¨è§£"><a class="header" href="#ä¸ºä»€ä¹ˆ-spring-boot-åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ°-main-æ–¹æ³•ä¸Šçš„springbootapplication-æ³¨è§£">ä¸ºä»€ä¹ˆ Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ° main æ–¹æ³•ä¸Šçš„@SpringBootApplication æ³¨è§£ï¼Ÿ</a></h4>
<p>Spring Boot åœ¨å¯åŠ¨æ—¶èƒ½å¤Ÿæ‰¾åˆ°ä¸»ç±»ä¸Šçš„<code>@SpringBootApplication</code>æ³¨è§£ï¼Œæ˜¯å› ä¸ºå®ƒåˆ©ç”¨äº† Java çš„åå°„æœºåˆ¶å’Œç±»åŠ è½½æœºåˆ¶ï¼Œç»“åˆ Spring æ¡†æ¶å†…éƒ¨çš„ä¸€ç³»åˆ—å¤„ç†æµç¨‹ã€‚</p>
<p>å½“è¿è¡Œä¸€ä¸ª Spring Boot ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šè°ƒç”¨ä¸»ç±»ä¸­çš„<code>main</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œ<code>SpringApplication.run()</code>ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-java">@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }
}
</code></pre>
<p><code>SpringApplication.run(Class&lt;?&gt; primarySource, String... args)</code>æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ä¸»åº”ç”¨ç±»ï¼ˆå³åŒ…å«<code>main</code>æ–¹æ³•çš„ç±»ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯å‘½ä»¤è¡Œå‚æ•°ã€‚<code>primarySource</code>å‚æ•°æä¾›äº†ä¸€ä¸ªèµ·ç‚¹ï¼ŒSpring Boot é€šè¿‡å®ƒæ¥åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ã€‚</p>
<p>Spring Boot åˆ©ç”¨ Java åå°„æœºåˆ¶æ¥è¯»å–ä¼ é€’ç»™<code>run</code>æ–¹æ³•çš„ç±»ï¼ˆ<code>MyApplication.class</code>ï¼‰ã€‚å®ƒä¼šæ£€æŸ¥è¿™ä¸ªç±»ä¸Šçš„æ³¨è§£ï¼ŒåŒ…æ‹¬<code>@SpringBootApplication</code>ã€‚</p>
<h4 id="spring-boot-é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆ"><a class="header" href="#spring-boot-é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆ">Spring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ</a></h4>
<p>Spring Boot çš„é»˜è®¤åŒ…æ‰«æè·¯å¾„æ˜¯ä»¥å¯åŠ¨ç±» <code>@SpringBootApplication</code> æ³¨è§£æ‰€åœ¨çš„åŒ…ä¸ºæ ¹ç›®å½•çš„ï¼Œå³é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚</p>
<p>æ¯”å¦‚è¯´åœ¨<a href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ï¼Œå¯åŠ¨ç±»<code>QuickForumApplication</code>æ‰€åœ¨çš„åŒ…æ˜¯<code>com.github.paicoding.forum.web</code>ï¼Œé‚£ä¹ˆ Spring Boot é»˜è®¤ä¼šæ‰«æ<code>com.github.paicoding.forum.web</code>åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240327105552.png" alt="æ²‰é»˜ç‹äºŒï¼šæŠ€æœ¯æ´¾é¡¹ç›®æˆªå›¾" /></p>
<p><code>@SpringBootApplication</code> æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œå®ƒé‡Œé¢çš„<code>@ComponentScan</code>æ³¨è§£å¯ä»¥æŒ‡å®šè¦æ‰«æçš„åŒ…è·¯å¾„ï¼Œé»˜è®¤æ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚</p>
<pre><code class="language-java">@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication {
}
</code></pre>
<p>æ¯”å¦‚è¯´å¸¦æœ‰ <code>@Component</code>ã€<code>@Service</code>ã€<code>@Controller</code>ã€<code>@Repository</code> ç­‰æ³¨è§£çš„ç±»éƒ½ä¼šè¢« Spring Boot æ‰«æåˆ°ï¼Œå¹¶æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚</p>
<p>å¦‚æœéœ€è¦è‡ªå®šä¹‰åŒ…æ‰«æè·¯å¾„ï¼Œå¯ä»¥åœ¨<code>@SpringBootApplication</code>æ³¨è§£ä¸Šæ·»åŠ <code>@ComponentScan</code>æ³¨è§£ï¼ŒæŒ‡å®šè¦æ‰«æçš„åŒ…è·¯å¾„ã€‚</p>
<pre><code class="language-java">@SpringBootApplication
@ComponentScan(basePackages = {"com.github.paicoding.forum"})
public class QuickForumApplication {
    public static void main(String[] args) {
        SpringApplication.run(QuickForumApplication.class, args);
    }
}
</code></pre>
<p>è¿™ç§æ–¹å¼ä¼šè¦†ç›–é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„ï¼Œåªæ‰«æ<code>com.github.paicoding.forum</code>åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šä¸ºä»€ä¹ˆ Spring Boot å¯åŠ¨æ—¶èƒ½æ‰¾åˆ° Main ç±»ä¸Šé¢çš„æ³¨è§£</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼š@SpringBootApplication æ³¨è§£äº†è§£å—ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å›½ä¼é›¶ç¢é¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šSpringbootçš„å·¥ä½œåŸç†ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpringBootå¯åŠ¨æµç¨‹ï¼ˆå¿˜äº†ï¼‰</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å“”å“©å“”å“©åŒå­¦ 1 äºŒé¢é¢è¯•åŸé¢˜ï¼šspringBootå¯åŠ¨æœºåˆ¶ï¼Œå¯åŠ¨ä¹‹ååšäº†å“ªäº›æ­¥éª¤</li>
</ol>
</blockquote>
<h3 id="36springboot-å’Œ-springmvc-çš„åŒºåˆ«è¡¥å……"><a class="header" href="#36springboot-å’Œ-springmvc-çš„åŒºåˆ«è¡¥å……">36.SpringBoot å’Œ SpringMVC çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰</a></h3>
<blockquote>
<p>2024 å¹´ 04 æœˆ 04 æ—¥å¢è¡¥</p>
</blockquote>
<p>Spring MVC æ˜¯åŸºäº Spring æ¡†æ¶çš„ä¸€ä¸ªæ¨¡å—ï¼Œæä¾›äº†ä¸€ç§ Model-View-Controllerï¼ˆæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰çš„å¼€å‘æ¨¡å¼ã€‚</p>
<p>Spring Boot æ—¨åœ¨ç®€åŒ– Spring åº”ç”¨çš„é…ç½®å’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œæä¾›äº†å¤§é‡çš„è‡ªåŠ¨é…ç½®é€‰é¡¹ï¼Œä»¥åŠè¿è¡Œæ—¶ç¯å¢ƒçš„å†…åµŒ Web æœåŠ¡å™¨ï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ª SpringMVC çš„ Web é¡¹ç›®ã€‚</p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šSpringBoot å’Œ SpringMVC çš„åŒºåˆ«</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpringBootä¸SpringMVCåŒºåˆ«ï¼ˆä¸ä¼šï¼‰</li>
</ol>
</blockquote>
<h3 id="38spring-boot-å’Œ-spring-æœ‰ä»€ä¹ˆåŒºåˆ«è¡¥å……"><a class="header" href="#38spring-boot-å’Œ-spring-æœ‰ä»€ä¹ˆåŒºåˆ«è¡¥å……">38.Spring Boot å’Œ Spring æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰</a></h3>
<blockquote>
<p>2024 å¹´ 07 æœˆ 09 æ—¥æ–°å¢</p>
</blockquote>
<p>Spring Boot æ˜¯ Spring Framework çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†ä¸€å¥—å¿«é€Ÿé…ç½®å’Œå¼€å‘çš„æœºåˆ¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»º Spring é¡¹ç›®çš„éª¨æ¶ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ã€‚</p>
<div class="table-wrapper"><table><thead><tr><th>ç‰¹æ€§</th><th>Spring Framework</th><th>Spring Boot</th></tr></thead><tbody>
<tr><td><strong>ç›®çš„</strong></td><td>æä¾›ä¼ä¸šçº§çš„å¼€å‘å·¥å…·å’Œåº“</td><td>ç®€åŒ– Spring åº”ç”¨çš„å¼€å‘ã€é…ç½®å’Œéƒ¨ç½²</td></tr>
<tr><td><strong>é…ç½®æ–¹å¼</strong></td><td>ä¸»è¦é€šè¿‡ XML å’Œæ³¨è§£ç­‰æ‰‹åŠ¨é…ç½®</td><td>æä¾›å¼€ç®±å³ç”¨çš„è‡ªåŠ¨é…ç½®</td></tr>
<tr><td><strong>å¯åŠ¨å’Œè¿è¡Œ</strong></td><td>éœ€è¦æ‰“æˆ war åŒ…åˆ° Tomcat ç­‰å®¹å™¨ä¸‹è¿è¡Œ</td><td>å·²åµŒå…¥ Tomcat ç­‰å®¹å™¨ï¼Œæ‰“åŒ…æˆ JAR æ–‡ä»¶ç›´æ¥è¿è¡Œ</td></tr>
<tr><td><strong>ä¾èµ–ç®¡ç†</strong></td><td>æ‰‹åŠ¨æ·»åŠ å’Œç®¡ç†ä¾èµ–</td><td>ä½¿ç”¨ <code>spring-boot-starter</code> ç®€åŒ–ä¾èµ–ç®¡ç†</td></tr>
</tbody></table>
</div>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³åŒå­¦ F é¢è¯•åŸé¢˜ï¼šSpring Boot å’Œ Spring çš„åŒºåˆ«</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ OPPO é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹Springå’ŒSpringbootä¹‹é—´æœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ</li>
</ol>
</blockquote>
<h2 id="spring-cloud"><a class="header" href="#spring-cloud">Spring Cloud</a></h2>
<h3 id="35å¯¹-springcloud-äº†è§£å¤šå°‘"><a class="header" href="#35å¯¹-springcloud-äº†è§£å¤šå°‘">35.å¯¹ SpringCloud äº†è§£å¤šå°‘ï¼Ÿ</a></h3>
<p>Spring Cloud æ˜¯ä¸€ä¸ªåŸºäº Spring Bootï¼Œæä¾›æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„çš„å·¥å…·é›†ã€‚ç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¦‚é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-92ab53d5-f303-4fc5-bd26-e62cefe374b3.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Cloud Netfilxæ ¸å¿ƒç»„ä»¶" /></p>
<h4 id="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"><a class="header" href="#ä»€ä¹ˆæ˜¯å¾®æœåŠ¡">ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ</a></h4>
<ol>
<li>2014 å¹´ <strong>Martin Fowler</strong> æå‡ºçš„ä¸€ç§æ–°çš„æ¶æ„å½¢å¼ã€‚å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§<strong>æ¶æ„æ¨¡å¼</strong>ï¼Œæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’åè°ƒï¼Œäº’ç›¸é…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨å…¶ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶(å¦‚ HTTP æˆ– Dubbo)äº’ç›¸åä½œï¼Œæ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“çš„ä¸šåŠ¡è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬ç«‹çš„éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦å¤–ï¼Œåº”å°½é‡é¿å…ç»Ÿä¸€çš„ï¼Œé›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„ä¸€ä¸ªæœåŠ¡è€Œè¨€ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©åˆé€‚çš„è¯­è¨€ã€å·¥å…·(å¦‚ Maven)å¯¹å…¶è¿›è¡Œæ„å»ºã€‚</li>
<li>å¾®æœåŠ¡åŒ–çš„æ ¸å¿ƒå°±æ˜¯å°†ä¼ ç»Ÿçš„ä¸€ç«™å¼åº”ç”¨ï¼Œæ ¹æ®ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æœåŠ¡ï¼Œå½»åº•åœ°å»è€¦åˆï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½çš„æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡åšä¸€ä»¶äº‹æƒ…ï¼Œä»æŠ€æœ¯è§’åº¦çœ‹å°±æ˜¯ä¸€ç§å°è€Œç‹¬ç«‹çš„å¤„ç†è¿‡ç¨‹ï¼Œç±»ä¼¼è¿›ç¨‹çš„æ¦‚å¿µï¼Œèƒ½å¤Ÿè‡ªè¡Œå•ç‹¬å¯åŠ¨æˆ–é”€æ¯ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ã€‚</li>
</ol>
<h4 id="å¾®æœåŠ¡æ¶æ„ä¸»è¦è¦è§£å†³å“ªäº›é—®é¢˜"><a class="header" href="#å¾®æœåŠ¡æ¶æ„ä¸»è¦è¦è§£å†³å“ªäº›é—®é¢˜">å¾®æœåŠ¡æ¶æ„ä¸»è¦è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ</a></h4>
<ol>
<li>æœåŠ¡å¾ˆå¤šï¼Œå®¢æˆ·ç«¯æ€ä¹ˆè®¿é—®ï¼Œå¦‚ä½•æä¾›å¯¹å¤–ç½‘å…³?</li>
<li>è¿™ä¹ˆå¤šæœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´å¦‚ä½•é€šä¿¡? HTTP è¿˜æ˜¯ RPC?</li>
<li>è¿™ä¹ˆå¤šæœåŠ¡ï¼Œå¦‚ä½•æ²»ç†? æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ã€‚</li>
<li>æœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿç†”æ–­æœºåˆ¶ã€‚</li>
</ol>
<h4 id="æœ‰å“ªäº›ä¸»æµå¾®æœåŠ¡æ¡†æ¶"><a class="header" href="#æœ‰å“ªäº›ä¸»æµå¾®æœåŠ¡æ¡†æ¶">æœ‰å“ªäº›ä¸»æµå¾®æœåŠ¡æ¡†æ¶ï¼Ÿ</a></h4>
<ol>
<li>Spring Cloud Netflix</li>
<li>Spring Cloud Alibaba</li>
<li>SpringBoot + Dubbo + ZooKeeper</li>
</ol>
<h4 id="springcloud-æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶"><a class="header" href="#springcloud-æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶">SpringCloud æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶ï¼Ÿ</a></h4>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2b988a72-0739-4fed-b271-eaf12589444f.png" alt="SpringCloud" /></p>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªåŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šSpringCloud äº†è§£å¤šå°‘ï¼Ÿ</li>
</ol>
</blockquote>
<h2 id="è¡¥å……"><a class="header" href="#è¡¥å……">è¡¥å……</a></h2>
<h3 id="37springtask-äº†è§£å—"><a class="header" href="#37springtask-äº†è§£å—">37.SpringTask äº†è§£å—ï¼Ÿ</a></h3>
<p>SpringTask æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªè½»é‡çº§çš„ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬å¼€å‘è€…é€šè¿‡ç®€å•çš„æ³¨è§£æ¥é…ç½®å’Œç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚</p>
<p>â‘ ã€<code>@Scheduled</code>ï¼šæœ€å¸¸ç”¨çš„æ³¨è§£ï¼Œç”¨äºæ ‡è®°æ–¹æ³•ä¸ºè®¡åˆ’ä»»åŠ¡çš„æ‰§è¡Œç‚¹ã€‚<a href="https://javabetter.cn/zhishixingqiu/paicoding.html">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ï¼Œå°±ä½¿ç”¨è¯¥æ³¨è§£æ¥å®šæ—¶åˆ·æ–° sitemap.xmlï¼š</p>
<pre><code class="language-java">@Scheduled(cron = "0 15 5 * * ?")
public void autoRefreshCache() {
    log.info("å¼€å§‹åˆ·æ–°sitemap.xmlçš„urlåœ°å€ï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜!");
    refreshSitemap();
    log.info("åˆ·æ–°å®Œæˆï¼");
}
</code></pre>
<p><code>@Scheduled</code> æ³¨è§£æ”¯æŒå¤šç§è°ƒåº¦é€‰é¡¹ï¼Œå¦‚ fixedRateã€fixedDelay å’Œ cron è¡¨è¾¾å¼ã€‚</p>
<p>â‘¡ã€<code>@EnableScheduling</code>ï¼šç”¨äºå¼€å¯å®šæ—¶ä»»åŠ¡çš„æ”¯æŒã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20240422094511.png" alt="æŠ€æœ¯æ´¾çš„å¯åŠ¨ç±»å°±æœ‰è¯¥æ³¨è§£çš„å½±å­" /></p>
<h4 id="ç”¨springtaskèµ„æºå ç”¨å¤ªé«˜æœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³è¡¥å……"><a class="header" href="#ç”¨springtaskèµ„æºå ç”¨å¤ªé«˜æœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³è¡¥å……">ç”¨SpringTaskèµ„æºå ç”¨å¤ªé«˜ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³ï¼Ÿï¼ˆè¡¥å……ï¼‰</a></h4>
<blockquote>
<p>2024å¹´05æœˆ27æ—¥æ–°å¢</p>
</blockquote>
<p><strong>ç¬¬ä¸€ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œå¦‚ RabbitMQã€Kafkaã€RocketMQ ç­‰ï¼Œå°†ä»»åŠ¡æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±æ¶ˆè´¹è€…å¼‚æ­¥å¤„ç†è¿™äº›ä»»åŠ¡ã€‚</p>
<p>â‘ ã€åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œå°†è®¢å•è¶…æ—¶æ£€æŸ¥ä»»åŠ¡æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆå³è®¢å•è¶…æ—¶æ—¶é—´ï¼‰ã€‚</p>
<pre><code class="language-java">@Service
public class OrderService {
    @Autowired
    private RabbitTemplate rabbitTemplate;

    public void createOrder(Order order) {
        // åˆ›å»ºè®¢å•é€»è¾‘
        // ...
        
        // å‘é€å»¶è¿Ÿæ¶ˆæ¯
        rabbitTemplate.convertAndSend("orderExchange", "orderTimeoutQueue", order, message -&gt; {
            message.getMessageProperties().setExpiration("600000"); // è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆ10åˆ†é’Ÿï¼‰
            return message;
        });
    }
}
</code></pre>
<p>â‘¡ã€ä½¿ç”¨æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“æ¶ˆè´¹åˆ°è¶…æ—¶ä»»åŠ¡æ—¶ï¼Œæ‰§è¡Œè®¢å•è¶…æ—¶å¤„ç†é€»è¾‘ã€‚</p>
<pre><code class="language-java">@Service
public class OrderTimeoutConsumer {

    @RabbitListener(queues = "orderTimeoutQueue")
    public void handleOrderTimeout(Order order) {
        // å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘
        // ...
    }
}
</code></pre>
<p><strong>ç¬¬äºŒï¼Œä½¿ç”¨æ•°æ®åº“è°ƒåº¦å™¨ï¼ˆå¦‚ Quartzï¼‰</strong>ã€‚</p>
<p>â‘ ã€åˆ›å»ºä¸€ä¸ª Quartz ä»»åŠ¡ç±»ï¼Œå¤„ç†è®¢å•è¶…æ—¶é€»è¾‘ã€‚</p>
<pre><code class="language-java">public class OrderTimeoutJob implements Job {
    @Override
    public void execute(JobExecutionContext context) throws JobExecutionException {
        // è·å–è®¢å•ä¿¡æ¯
        Order order = (Order) context.getJobDetail().getJobDataMap().get("order");

        // å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘
        // ...
    }
}
</code></pre>
<p>â‘¡ã€åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œè°ƒåº¦ä¸€ä¸ª Quartz ä»»åŠ¡ï¼Œè®¾ç½®ä»»åŠ¡çš„è§¦å‘æ—¶é—´ä¸ºè®¢å•è¶…æ—¶æ—¶é—´ã€‚</p>
<pre><code class="language-java">@Service
public class OrderService {
    @Autowired
    private Scheduler scheduler;

    public void createOrder(Order order) {
        // åˆ›å»ºè®¢å•é€»è¾‘
        // ...

        // è°ƒåº¦ Quartz ä»»åŠ¡
        JobDetail jobDetail = JobBuilder.newJob(OrderTimeoutJob.class)
                .usingJobData("order", order)
                .build();

        Trigger trigger = TriggerBuilder.newTrigger()
                .startAt(new Date(System.currentTimeMillis() + 600000)) // è®¾ç½®è§¦å‘æ—¶é—´ï¼ˆ10åˆ†é’Ÿåï¼‰
                .build();

        try {
            scheduler.scheduleJob(jobDetail, trigger);
        } catch (SchedulerException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šSpringTask äº†è§£å—ï¼Ÿ</li>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œé¢ç»åŒå­¦ 1 é—²é±¼åç«¯ä¸€é¢çš„åŸé¢˜ï¼šè®¢å•è¶…æ—¶ï¼Œç”¨springtaskèµ„æºå ç”¨å¤ªé«˜ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³?</li>
</ol>
</blockquote>
<h3 id="41spring-cache-äº†è§£å—"><a class="header" href="#41spring-cache-äº†è§£å—">41.Spring Cache äº†è§£å—ï¼Ÿ</a></h3>
<p>Spring Cache æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªç¼“å­˜æŠ½è±¡ï¼Œå®ƒé€šè¿‡ç»Ÿä¸€çš„æ¥å£æ¥æ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisã€Caffeine ç­‰ï¼‰ã€‚</p>
<p>å®ƒé€šè¿‡æ³¨è§£ï¼ˆå¦‚ <code>@Cacheable</code>ã€<code>@CachePut</code>ã€<code>@CacheEvict</code>ï¼‰æ¥å®ç°ç¼“å­˜ç®¡ç†ï¼Œæå¤§ç®€åŒ–äº†ä»£ç å®ç°ã€‚</p>
<ul>
<li>@Cacheableï¼šç¼“å­˜æ–¹æ³•çš„è¿”å›å€¼ã€‚</li>
<li>@CachePutï¼šç”¨äºæ›´æ–°ç¼“å­˜ï¼Œæ¯æ¬¡è°ƒç”¨æ–¹æ³•éƒ½ä¼šå°†ç»“æœé‡æ–°å†™å…¥ç¼“å­˜ã€‚</li>
<li>@CacheEvictï¼šç”¨äºåˆ é™¤ç¼“å­˜ã€‚</li>
</ul>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241031111306.png" alt="äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šSpring Cache" /></p>
<h4 id="spring-cache-å’Œ-redis-æœ‰ä»€ä¹ˆåŒºåˆ«"><a class="header" href="#spring-cache-å’Œ-redis-æœ‰ä»€ä¹ˆåŒºåˆ«">Spring Cache å’Œ Redis æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></h4>
<ol>
<li><strong>Spring Cache</strong> æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªç¼“å­˜æŠ½è±¡ï¼Œå®ƒé€šè¿‡æ³¨è§£æ¥å®ç°ç¼“å­˜ç®¡ç†ï¼Œæ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisã€Caffeine ç­‰ï¼‰ã€‚</li>
<li><strong>Redis</strong> æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ˆå¦‚ Stringã€Hashã€Listã€Setã€ZSetï¼‰ï¼Œè¿˜æ”¯æŒæŒä¹…åŒ–ã€é›†ç¾¤ã€ä¸»ä»å¤åˆ¶ç­‰ã€‚</li>
</ol>
<p>Spring Cache é€‚åˆç”¨äºå•æœºã€è½»é‡çº§å’ŒçŸ­æ—¶ç¼“å­˜åœºæ™¯ï¼Œèƒ½å¤Ÿé€šè¿‡æ³¨è§£è½»æ¾æ§åˆ¶ç¼“å­˜ç®¡ç†ã€‚</p>
<p>Redis æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„å’Œé«˜å¹¶å‘è®¿é—®ï¼Œé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿå’Œé«˜å¹¶å‘åœºæ™¯ï¼Œå¯ä»¥æä¾›æ•°æ®æŒä¹…åŒ–å’Œå¤šç§æ·˜æ±°ç­–ç•¥ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼ŒSpring Cache å’Œ Redis å¯ä»¥ç»“åˆä½¿ç”¨ï¼ŒSpring Cache æä¾›ç®¡ç†ç¼“å­˜çš„æ³¨è§£ï¼Œè€Œ Redis åˆ™ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜çš„å®ç°ï¼Œæä¾›å…±äº«ç¼“å­˜æ”¯æŒã€‚</p>
<h4 id="æœ‰äº†-redis-ä¸ºä»€ä¹ˆè¿˜éœ€è¦-spring-cache"><a class="header" href="#æœ‰äº†-redis-ä¸ºä»€ä¹ˆè¿˜éœ€è¦-spring-cache">æœ‰äº† Redis ä¸ºä»€ä¹ˆè¿˜éœ€è¦ Spring Cacheï¼Ÿ</a></h4>
<p>è™½ç„¶ Redis éå¸¸å¼ºå¤§ï¼Œä½† Spring Cache æä¾›äº†ä¸€å±‚ç¼“å­˜æŠ½è±¡ï¼Œç®€åŒ–äº†ç¼“å­˜çš„ç®¡ç†ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ–¹æ³•ä¸Šé€šè¿‡æ³¨è§£æ¥å®ç°ç¼“å­˜é€»è¾‘ï¼Œå‡å°‘äº†æ‰‹åŠ¨æ“ä½œ Redis çš„ä»£ç é‡ã€‚</p>
<p>Spring Cache è¿˜èƒ½çµæ´»åˆ‡æ¢åº•å±‚ç¼“å­˜å®ç°ã€‚æ­¤å¤–ï¼ŒSpring Cache æ”¯æŒäº‹åŠ¡æ€§ç¼“å­˜å’Œæ¡ä»¶ç¼“å­˜ï¼Œä¾¿äºåœ¨å¤æ‚åœºæ™¯ä¸­ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<h4 id="è¯´è¯´spring-cache-çš„åº•å±‚åŸç†"><a class="header" href="#è¯´è¯´spring-cache-çš„åº•å±‚åŸç†">è¯´è¯´Spring Cache çš„åº•å±‚åŸç†ï¼Ÿ</a></h4>
<p>Spring Cache æ˜¯åŸºäº AOP å’Œç¼“å­˜æŠ½è±¡å±‚å®ç°çš„ã€‚å®ƒé€šè¿‡ AOP æ‹¦æˆªè¢« @Cacheableã€@CachePut å’Œ @CacheEvict æ³¨è§£çš„æ–¹æ³•ï¼Œåœ¨æ–¹æ³•è°ƒç”¨å‰åè‡ªåŠ¨æ‰§è¡Œç¼“å­˜é€»è¾‘ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/spring-20241031113743.png" alt="é“¿ç„¶æ¶æ„ï¼šSpring Cache æ¶æ„" /></p>
<p>å…¶æä¾›çš„ CacheManager å’Œ Cache ç­‰æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“çš„ç¼“å­˜å®ç°ï¼Œå› æ­¤å¯ä»¥çµæ´»åœ°é›†æˆ Redisã€Caffeine ç­‰å¤šç§ç¼“å­˜ã€‚</p>
<ul>
<li>ConcurrentMapCacheManagerï¼šåŸºäº Java ConcurrentMap çš„æœ¬åœ°ç¼“å­˜å®ç°ã€‚</li>
<li>RedisCacheManagerï¼šåŸºäº Redis çš„åˆ†å¸ƒå¼ç¼“å­˜å®ç°ã€‚</li>
<li>CaffeineCacheManagerï¼šåŸºäº Caffeine çš„ç¼“å­˜å®ç°ã€‚</li>
</ul>
<blockquote>
<ol>
<li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢åŒå­¦ 9 ä¸€é¢é¢è¯•åŸé¢˜ï¼šä»‹ç»ä¸€ä¸‹springcache å’Œredisï¼ŸSpring cacheå’Œredisä¹‹é—´çš„å„åº”ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿæœ‰äº†redisä¸ºä»€ä¹ˆè¿˜è¦ç”¨springcaheï¼Ÿspringcache åº•å±‚åŸç†ï¼ŒåŸºäºä»€ä¹ˆå®ç°çš„ï¼Ÿ</li>
</ol>
</blockquote>
<hr />
<p>å›¾æ–‡è¯¦è§£ 41 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/EQge6DmgIqYITM3mAxkatg">è½¬è½½é“¾æ¥</a>ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/Y17S85ntHm_MLTZMJdtjQQ">åŸæ–‡é“¾æ¥</a>ã€‚</p>
<p><em>æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸ</em>ã€‚</p>
<p><strong>ç³»åˆ—å†…å®¹</strong>ï¼š</p>
<ul>
<li><a href="https://javabetter.cn/sidebar/sanfene/javase.html">é¢æ¸£é€†è¢­ Java SE ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/javathread.html">é¢æ¸£é€†è¢­ Java é›†åˆæ¡†æ¶ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/collection.html">é¢æ¸£é€†è¢­ Java å¹¶å‘ç¼–ç¨‹ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/jvm.html">é¢æ¸£é€†è¢­ JVM ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/spring.html">é¢æ¸£é€†è¢­ Spring ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/redis.html">é¢æ¸£é€†è¢­ Redis ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/mybatis.html">é¢æ¸£é€†è¢­ MyBatis ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/mysql.html">é¢æ¸£é€†è¢­ MySQL ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/os.html">é¢æ¸£é€†è¢­æ“ä½œç³»ç»Ÿç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/network.html">é¢æ¸£é€†è¢­è®¡ç®—æœºç½‘ç»œç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/rocketmq.html">é¢æ¸£é€†è¢­ RocketMQ ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/fenbushi.html">é¢æ¸£é€†è¢­åˆ†å¸ƒå¼ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/weifuwu.html">é¢æ¸£é€†è¢­å¾®æœåŠ¡ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/shejimoshi.html">é¢æ¸£é€†è¢­è®¾è®¡æ¨¡å¼ç¯‡ ğŸ‘</a></li>
<li><a href="https://javabetter.cn/sidebar/sanfene/linux.html">é¢æ¸£é€†è¢­ Linux ç¯‡ ğŸ‘</a></li>
</ul>
<hr />
<p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p>
<p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="weifuwu.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="protobuff.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="weifuwu.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="protobuff.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/pagetoc.js"></script>


    </div>
    </body>
</html>
